# –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø–ª–∞–Ω—É —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥—É –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó
**–î–∞—Ç–∞**: 2025-10-23  
**–°—Ç–∞—Ç—É—Å**: REVIEWED ‚úÖ  

---

## üìã –ü–ï–†–ï–í–Ü–†–ö–ê –í–Ü–î–ü–û–í–Ü–î–ù–û–°–¢–Ü –í–ò–ú–û–ì–ê–ú

### 1. ‚úÖ –í–∞–ª—ñ–¥–∞—Ü—ñ—è –ø–æ—Å–ª—ñ–¥–æ–≤–Ω–∞ —á–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä?
**–í–∏–º–æ–≥–∞**: "–æ—Å–Ω–æ–≤–Ω–∞ —ñ —Ä–æ–∑—à–∏—Ä–µ–Ω–∞ –≤–∞–ª—ñ–¥–∞—Ü—ñ—è —ñ–¥—É—Ç—å –∑–∞–≤–∂–¥–∏ —á–∏ —Ü–µ –ø–∞—Ä–∞–º–µ—Ç—Ä –∑–º—ñ–Ω–Ω–∏–π –Ω–∞ –≤–∏–±—ñ—Ä, —á–∏ –ø–æ—Å–ª—ñ–¥–æ–≤–Ω–∏–π?"

**–í—ñ–¥–ø–æ–≤—ñ–¥—å**: **–ü–û–°–õ–Ü–î–û–í–ù–ê –ó EARLY REJECTION**

```javascript
// ValidationPipeline - –∑–∞–≤–∂–¥–∏ –≤–∏–∫–æ–Ω—É—î –≤—Å—ñ stages –ø–æ—Å–ª—ñ–¥–æ–≤–Ω–æ
// –ê–ª–µ –∑ —Ä–∞–Ω–Ω—ñ–º –≤—ñ–¥—Å—ñ—é–≤–∞–Ω–Ω—è–º –Ω–∞ CRITICAL –ø–æ–º–∏–ª–∫–∞—Ö

for (const stage of this.stages) {
  const result = await stage.validator.validate(toolCalls, context);
  
  if (!result.valid && stage.critical) {
    return { valid: false, rejectedAt: stage.name }; // EARLY EXIT
  }
}
```

**–ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è**:
```javascript
VALIDATION_CONFIG.pipeline.earlyRejection = true; // –ó–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º
```

**–í–∏—Å–Ω–æ–≤–æ–∫**: –°–∏—Å—Ç–µ–º–∞ –ó–ê–í–ñ–î–ò –≤–∏–∫–æ–Ω—É—î –≤–∞–ª—ñ–¥–∞—Ü—ñ—é –ø–æ—Å–ª—ñ–¥–æ–≤–Ω–æ, –∞–ª–µ –º–æ–∂–µ –∑—É–ø–∏–Ω–∏—Ç–∏—Å—è —Ä–∞–Ω—ñ—à–µ —è–∫—â–æ critical stage failed. –¶–µ –Ω–µ –ø–∞—Ä–∞–º–µ—Ç—Ä –Ω–∞ –≤–∏–±—ñ—Ä - —Ü–µ –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–Ω–µ —Ä—ñ—à–µ–Ω–Ω—è –¥–ª—è –Ω–∞–¥—ñ–π–Ω–æ—Å—Ç—ñ.

---

### 2. ‚úÖ prepareToolsAndPrompt - –æ–ø–∏—Å–∏ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ñ–≤
**–í–∏–º–æ–≥–∞**: "–∞–±–æ –∫–æ–∂–µ–Ω –º—Å–ø –º–∞—î –Ω–∞ –±–æ—Ä—Ç—É –∫–æ–º–∞–Ω–¥—É —è–∫–∞ –≤–∏–¥–∞—î –ø–æ–≤–Ω—ñ –æ–ø–∏—Å–∏ –¥–æ –∫–æ–∂–Ω–æ–≥–æ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞... –∞–±–æ –º–∞—î –±—É—Ç–∏ —Å—Ç–∞—Ç–∏—á–Ω–æ –≤ –ø—Ä–æ–º–ø—Ç—ñ"

**–í—ñ–¥–ø–æ–≤—ñ–¥—å**: **–°–¢–ê–¢–ò–ß–ù–Ü –û–ü–ò–°–ò –í –ü–†–û–ú–ü–¢–ê–• (—Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ)**

**–†—ñ—à–µ–Ω–Ω—è**:
1. **–û—Å–Ω–æ–≤–Ω–∏–π —Å–ø–æ—Å—ñ–±**: –°—Ç–∞—Ç–∏—á–Ω—ñ –ø–æ–≤–Ω—ñ –æ–ø–∏—Å–∏ –≤ –ø—Ä–æ–º–ø—Ç–∞—Ö
   - –ì–µ–Ω–µ—Ä—É—é—Ç—å—Å—è –æ–¥–∏–Ω —Ä–∞–∑ –∑ —Ä–µ–∞–ª—å–Ω–∏—Ö MCP tools/list
   - –û–ø—Ç–∏–º—ñ–∑—É—é—Ç—å—Å—è –¥–ª—è LLM (–∫–æ—Ä–æ—Ç–∫—ñ, —Ç–æ—á–Ω—ñ)
   - –ú–µ–Ω—à–µ —Ç–æ–∫–µ–Ω—ñ–≤ (~30% –µ–∫–æ–Ω–æ–º—ñ—è)

2. **Fallback**: Dynamic generation –∑ –∫–µ—à—É MCP
   - –Ø–∫—â–æ –ø—Ä–æ–º–ø—Ç –Ω–µ –æ–Ω–æ–≤–ª–µ–Ω–∏–π
   - –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è `getDetailedToolsSummary()`

**Phase 8**: –û–Ω–æ–≤–ª–µ–Ω–Ω—è –≤—Å—ñ—Ö 5 –ø—Ä–æ–º–ø—Ç—ñ–≤ –∑—ñ —Å—Ç–∞—Ç–∏—á–Ω–∏–º–∏ –æ–ø–∏—Å–∞–º–∏

**–ü—Ä–∏–∫–ª–∞–¥**:
```javascript
// prompts/mcp/tetyana_plan_tools_playwright.js

SYSTEM_PROMPT: `
–î–æ—Å—Ç—É–ø–Ω—ñ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏ (playwright server):

1. playwright__browser_navigate
   Description: Navigate browser to URL
   Parameters:
     ‚Ä¢ url (string, REQUIRED): Target URL starting with http:// or https://
     ‚Ä¢ waitUntil (string, optional): load|domcontentloaded|networkidle [default: load]
   Example: {"server": "playwright", "tool": "playwright__browser_navigate", 
             "parameters": {"url": "https://example.com"}}

... (–≤—Å—ñ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏ –∑ –ü–û–í–ù–ò–ú–ò –¥–µ—Ç–∞–ª—è–º–∏)
`
```

**–í–∏—Å–Ω–æ–≤–æ–∫**: –°—Ç–∞—Ç–∏—á–Ω—ñ –æ–ø–∏—Å–∏ –≤–∏—Ä—ñ—à—É—é—Ç—å –ø—Ä–æ–±–ª–µ–º—É –∑–∞–π–≤–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç—É —Ç–∞ –∑–∞–≤–∂–¥–∏ –º—ñ—Å—Ç—è—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é.

---

### 3. ‚úÖ –Ü—Å—Ç–æ—Ä—ñ—è –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –∑ –ª–µ–π–±–ª–∞–º–∏
**–í–∏–º–æ–≥–∞**: "–∫–æ–∂–µ–Ω —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç —è–∫–∏–π –ø—Ä–æ–π—à–æ–≤ –Ω–∞ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –º–∞—î –º–∞—Ç–∏ –æ–¥–∏–Ω –ª–µ–π–±–ª, —Ü—ñ —è–∫—ñ –æ–±–≤–∞–ª–∏–ª–∏—Å—è –º–∞—Ç–∏ –¥—Ä—É–≥–∏–π –ª–µ–π–±–ª"

**–í—ñ–¥–ø–æ–≤—ñ–¥—å**: **–†–ï–ê–õ–Ü–ó–û–í–ê–ù–û –í PHASE 2**

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∑–∞–ø–∏—Å—É**:
```javascript
{
  timestamp: Date.now(),
  server: 'playwright',
  tool: 'playwright__browser_navigate',
  parameters: {...},
  label: 'SUCCESS' | 'FAILURE',  // ‚≠ê –õ–ï–ô–ë–õ
  error: null | string,
  duration: 1234,
  sessionId: 'session_123'
}
```

**–î–≤–∞ use cases —è–∫ –∑–∞–ø–∏—Ç–∞–Ω–æ**:

**Use Case 1**: –ó–∞—Ö–∏—Å—Ç –≤—ñ–¥ –ø–æ–≤—Ç–æ—Ä–µ–Ω—å (–ø–µ—Ä—à—ñ 100 –∑–∞–ø–∏—Å—ñ–≤)
```javascript
// config/validation-config.js
history: {
  antiRepetitionWindow: 100  // –ö–æ–Ω—Ñ—ñ–≥—É—Ä—É—î—Ç—å—Å—è
}

// HistoryBasedValidator
checkRepetitionAfterFailure(toolCall, 100) {
  // –®—É–∫–∞—î –≤ –æ—Å—Ç–∞–Ω–Ω—ñ—Ö 100 –∑–∞–ø–∏—Å–∞—Ö
  // –Ø–∫—â–æ tool FAILURE –ø–æ–≤—Ç–æ—Ä—é—î—Ç—å—Å—è 3+ —Ä–∞–∑–∏ ‚Üí –ë–õ–û–ö
}
```

**Use Case 2**: –í–∞–ª—ñ–¥–∞—Ü—ñ—è –Ω–∞ –ø–æ—á–∞—Ç–∫—É
```javascript
// ValidationPipeline - Level 2 (History Validator)
// –ü–µ—Ä–µ–≤—ñ—Ä—è—î –î–û –≤–∏–∫–æ–Ω–∞–Ω–Ω—è:
// - –ß–∏ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –ø–æ–≤—Ç–æ—Ä—é—î—Ç—å—Å—è –ø—ñ—Å–ª—è 3 –ø–æ–º–∏–ª–æ–∫
// - –Ø–∫—â–æ —Ç–∞–∫ ‚Üí REJECT –∑ –¥–µ—Ç–∞–ª—è–º–∏ –æ—Å—Ç–∞–Ω–Ω—å–æ—ó –ø–æ–º–∏–ª–∫–∏
```

**–í–∏—Å–Ω–æ–≤–æ–∫**: –ü–æ–≤–Ω—ñ—Å—Ç—é –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î –≤–∏–º–æ–≥–∞–º –∑ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—î—é —Ä–æ–∑–º—ñ—Ä—É window.

---

### 4. ‚úÖ MCP tools/list –∞–≤—Ç–æ–∫–æ—Ä–µ–∫—Ü—ñ—è
**–í–∏–º–æ–≥–∞**: "–æ–¥–∏–Ω —ñ–∑ –æ—Å—Ç–∞–Ω–Ω—ñ—Ö –µ—Ç–∞–ø—ñ–≤ –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó –ø–µ—Ä–µ–¥ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è–º, –º–∞—î –±—É—Ç–∏ –∑–≤—ñ—Ä–∫–∞ –∑ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏ —è–∫—ñ –≤–∏–∑–≤–∞—é—Ç—å—Å—è —á–µ—Ä–µ–∑ tools list... —Å–∏—Å—Ç–µ–º–∞ –º–∞—î –∑—Ä–æ–±–∏—Ç–∏ –∞–≤—Ç–æ–∫–æ—Ä–µ–∫—Ü—ñ—é"

**–í—ñ–¥–ø–æ–≤—ñ–¥—å**: **–†–ï–ê–õ–Ü–ó–û–í–ê–ù–û –í PHASE 6 (Level 4 - CRITICAL)**

**MCPSyncValidator - –Ω–∞–π–≤–∞–∂–ª–∏–≤—ñ—à–∏–π validator**:

```javascript
async validate(toolCalls, context) {
  // 1. –û—Ç—Ä–∏–º–∞—Ç–∏ –°–í–Ü–ñ–ò–ô tools/list –∑ MCP (–∫–µ—à 60 —Å–µ–∫)
  const actualTools = await this._getActualToolsList();
  
  // 2. –î–ª—è –∫–æ–∂–Ω–æ–≥–æ tool - –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —ñ—Å–Ω—É–≤–∞–Ω–Ω—è –ó–ê–†–ê–ó
  for (const call of toolCalls) {
    const serverTools = actualTools.get(call.server);
    const exists = serverTools.some(t => t.name === call.tool);
    
    if (!exists) {
      // 3. –ê–í–¢–û–ö–û–†–ï–ö–¶–Ü–Ø —á–µ—Ä–µ–∑ fuzzy matching –∑ –†–ï–ê–õ–¨–ù–ò–ú–ò –¥–∞–Ω–∏–º–∏
      const realNames = serverTools.map(t => t.name);
      const corrected = this._findSimilar(call.tool, realNames);
      
      if (corrected.similarity > 0.8) {
        call.tool = corrected.name;  // ‚úÖ –ê–í–¢–û–ö–û–†–ï–ö–¶–Ü–Ø
        corrections.push({
          original: call.tool,
          corrected: corrected.name,
          source: 'mcp_tools_list'  // ‚≠ê –ó –†–ï–ê–õ–¨–ù–ò–• –î–ê–ù–ò–•
        });
      }
    }
  }
}
```

**–ö–ª—é—á–æ–≤—ñ –æ—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ**:
- ‚úÖ –í–∏–∫–ª–∏–∫–∞—î `server.requestToolsList()` - –†–ï–ê–õ–¨–ù–Ü –¥–∞–Ω—ñ –∑ MCP
- ‚úÖ –ö–µ—à—É–≤–∞–Ω–Ω—è 60 —Å–µ–∫ (–∫–æ–Ω—Ñ—ñ–≥—É—Ä—É—î—Ç—å—Å—è)
- ‚úÖ –ê–≤—Ç–æ–∫–æ—Ä–µ–∫—Ü—ñ—è —Ç—ñ–ª—å–∫–∏ —è–∫—â–æ similarity > 80%
- ‚úÖ Fallback –Ω–∞ –∫–µ—à–æ–≤–∞–Ω–∏–π —Å–ø–∏—Å–æ–∫ —è–∫—â–æ MCP –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∏–π

**–ü–æ–∑–∏—Ü—ñ—è –≤ pipeline**: Level 4 (–ø—ñ—Å–ª—è schema, –ø–µ—Ä–µ–¥ LLM)
- –¶–µ –≥–∞—Ä–∞–Ω—Ç—É—î —â–æ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏ —ñ—Å–Ω—É—é—Ç—å –ü–†–Ø–ú–û –ó–ê–†–ê–ó
- –ê–≤—Ç–æ–∫–æ—Ä–µ–∫—Ü—ñ—è –Ω–∞ –æ—Å–Ω–æ–≤—ñ –±–µ–∑–ø–µ—Ä–µ—á–Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω–∏—Ö –¥–∞–Ω–∏—Ö –∑ —Å–∞–º–æ–≥–æ MCP

**–í–∏—Å–Ω–æ–≤–æ–∫**: –ü–æ–≤–Ω—ñ—Å—Ç—é –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î –≤–∏–º–æ–∑—ñ - –∑–≤—ñ—Ä–∫–∞ –∑ tools/list + –∞–≤—Ç–æ–∫–æ—Ä–µ–∫—Ü—ñ—è —á–µ—Ä–µ–∑ —Ä–µ–∞–ª—å–Ω—ñ –¥–∞–Ω—ñ.

---

### 5. ‚úÖ –¶–µ–Ω—Ç—Ä–∞–ª—ñ–∑–æ–≤–∞–Ω–∏–π —Ä–µ—î—Å—Ç—Ä MCP
**–í–∏–º–æ–≥–∞**: "–º–∞—î –±—É—Ç–∏ —Ä–µ—î—Å—Ç—Ä –º—Å–ø –≤ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó, —ñ –≤—Å—ñ —Ñ–∞–π–ª–∏ –º–∞—é—é—Ç—å –∑–≤–µ—Ä—Ç–∞—Ç–∏—Å—è —á–µ—Ä–µ–∑ –∑–º—ñ–Ω–Ω—É... —â–æ–± –ø–æ—Ç—ñ–º –Ω–µ –≤–∏–ø—Ä–∞–≤–ª—è—Ç–∏ –∫—É—á—É —Ñ–∞–π–ª—ñ–≤"

**–í—ñ–¥–ø–æ–≤—ñ–¥—å**: **–†–ï–ê–õ–Ü–ó–û–í–ê–ù–û –í PHASE 1**

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞**:
```javascript
// config/mcp-registry.js (NEW)

export const MCP_REGISTRY = {
  servers: {
    playwright: { command: 'npx', args: [...], env: {...} },
    filesystem: { command: 'npx', args: [...], env: {...} },
    shell: { command: 'npx', args: [...], env: {...} },
    applescript: { command: 'npx', args: [...], env: {...} },
    memory: { command: 'npx', args: [...], env: {...} }
  },
  
  // API
  getServer(name) { return this.servers[name]; },
  getAllServers() { return Object.values(this.servers); },
  getServerNames() { return Object.keys(this.servers); },
  isServerEnabled(name) { return !!this.servers[name]; }
};
```

**–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –≤ —É—Å—ñ—Ö —Ñ–∞–π–ª–∞—Ö**:
```javascript
// ‚ùå –°–¢–ê–†–ò–ô –°–ü–û–°–Ü–ë (–≤–∏–¥–∞–ª–∏—Ç–∏):
import { AI_BACKEND_CONFIG } from './models-config.js';
const servers = AI_BACKEND_CONFIG.providers.mcp.servers;

// ‚úÖ –ù–û–í–ò–ô –°–ü–û–°–Ü–ë (–∑–∞–≤–∂–¥–∏):
import { MCP_REGISTRY } from './mcp-registry.js';
const servers = MCP_REGISTRY.servers;
```

**–ü–µ—Ä–µ–≤–∞–≥–∏**:
- ‚úÖ –û–¥–Ω–µ –º—ñ—Å—Ü–µ –¥–ª—è –¥–æ–¥–∞–≤–∞–Ω–Ω—è/–≤–∏–¥–∞–ª–µ–Ω–Ω—è —Å–µ—Ä–≤–µ—Ä—ñ–≤
- ‚úÖ –í–∞–ª—ñ–¥–∞—Ü—ñ—è –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó –ø—Ä–∏ —ñ–º–ø–æ—Ä—Ç—ñ
- ‚úÖ –ó–º—ñ–Ω–∏ –≤ –æ–¥–Ω–æ–º—É —Ñ–∞–π–ª—ñ ‚Üí –∑–∞—Å—Ç–æ—Å–æ–≤—É—é—Ç—å—Å—è —Å–∫—Ä—ñ–∑—å
- ‚úÖ Type safety (–º–æ–∂–Ω–∞ –¥–æ–¥–∞—Ç–∏ TypeScript definitions)

**–í–∏—Å–Ω–æ–≤–æ–∫**: –ü–æ–≤–Ω—ñ—Å—Ç—é –≤–∏—Ä—ñ—à—É—î –ø—Ä–æ–±–ª–µ–º—É —Ä–æ–∑–∫–∏–¥–∞–Ω–∏—Ö –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ–π.

---

## üîç –î–û–î–ê–¢–ö–û–í–Ü –ü–ï–†–ï–í–Ü–†–ö–ò

### –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ 1: –ß–∏ –≤—Å—ñ –µ—Ç–∞–ø–∏ –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó –≤–∏–∫–æ–Ω—É—é—Ç—å—Å—è?
**–í—ñ–¥–ø–æ–≤—ñ–¥—å**: –¢–ê–ö, –∞–ª–µ –∑ early rejection

```
Level 1: Format ‚Üí —è–∫—â–æ FAILED (critical) ‚Üí EXIT
Level 2: History ‚Üí —è–∫—â–æ FAILED (non-critical) ‚Üí WARNING, continue
Level 3: Schema ‚Üí —è–∫—â–æ FAILED (critical) ‚Üí EXIT
Level 4: MCP Sync ‚Üí —è–∫—â–æ FAILED (critical) ‚Üí EXIT
Level 5: LLM ‚Üí —è–∫—â–æ FAILED (non-critical) ‚Üí WARNING, continue
```

### –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ 2: –ß–∏ –ø–æ—Ä—è–¥–æ–∫ –µ—Ç–∞–ø—ñ–≤ –ª–æ–≥—ñ—á–Ω–∏–π?
**–í—ñ–¥–ø–æ–≤—ñ–¥—å**: –¢–ê–ö

1. **Format** (–Ω–∞–π—à–≤–∏–¥—à–∏–π) - —è–∫—â–æ —Ñ–æ—Ä–º–∞—Ç –Ω–µ–≤—ñ—Ä–Ω–∏–π, –Ω–µ–º–∞—î —Å–µ–Ω—Å—É –ø–µ—Ä–µ–≤—ñ—Ä—è—Ç–∏ –¥–∞–ª—ñ
2. **History** - —à–≤–∏–¥–∫–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑ –∫–µ—à—É
3. **Schema** - –≤–∞–ª—ñ–¥–∞—Ü—ñ—è –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤ (–ø–æ—Ç—Ä–µ–±—É—î —Ä–æ–∑–ø–∞—Ä—Å–µ–Ω—ñ –¥–∞–Ω—ñ)
4. **MCP Sync** - –∑–∞–ø–∏—Ç –¥–æ MCP (–Ω–∞–π–ø–æ–≤—ñ–ª—å–Ω—ñ—à–∏–π, –∞–ª–µ –∫—Ä–∏—Ç–∏—á–Ω–∏–π)
5. **LLM** - –Ω–∞–π–ø–æ–≤—ñ–ª—å–Ω—ñ—à–∏–π, –∞–ª–µ optional

### –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ 3: –ß–∏ —î –∫–æ–Ω—Ñ–ª—ñ–∫—Ç–∏ –∑ —ñ—Å–Ω—É—é—á–∏–º –∫–æ–¥–æ–º?
**–í—ñ–¥–ø–æ–≤—ñ–¥—å**: –ù–Ü, –ø–æ–µ—Ç–∞–ø–Ω–µ –≤–ø—Ä–æ–≤–∞–¥–∂–µ–Ω–Ω—è

- Phase 1-2: –ù–æ–≤—ñ —Ñ–∞–π–ª–∏, –Ω–µ —Ç–æ—Ä–∫–∞—é—Ç—å—Å—è —ñ—Å–Ω—É—é—á–æ–≥–æ –∫–æ–¥—É
- Phase 3-7: –ù–æ–≤—ñ validators, –ø–∞—Ä–∞–ª–µ–ª—å–Ω–æ —ñ—Å–Ω—É—é—á–∏–º
- Phase 8: –û–Ω–æ–≤–ª–µ–Ω–Ω—è –ø—Ä–æ–º–ø—Ç—ñ–≤ (backward compatible)
- Phase 9: –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è (–∑–∞–º—ñ–Ω–∞ —Å—Ç–∞—Ä–æ—ó –ª–æ–≥—ñ–∫–∏)

---

## ‚úèÔ∏è –í–ò–Ø–í–õ–ï–ù–Ü –ü–û–ü–†–ê–í–ö–ò

### –ü–æ–ø—Ä–∞–≤–∫–∞ 1: –î–æ–¥–∞—Ç–∏ fallback –¥–ª—è MCP Sync Validator
**–ü—Ä–æ–±–ª–µ–º–∞**: –Ø–∫—â–æ MCP –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∏–π - validation failed?

**–†—ñ—à–µ–Ω–Ω—è**:
```javascript
// mcp-sync-validator.js
async _getActualToolsList() {
  try {
    // –°–ø—Ä–æ–±–∞ –æ—Ç—Ä–∏–º–∞—Ç–∏ —Å–≤—ñ–∂–∏–π —Å–ø–∏—Å–æ–∫
    const tools = await server.requestToolsList();
    return tools;
  } catch (error) {
    logger.warn(`MCP tools/list failed, using cached list`);
    // Fallback –Ω–∞ –∫–µ—à–æ–≤–∞–Ω–∏–π —Å–ø–∏—Å–æ–∫ –∑ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó
    return server.tools || [];
  }
}
```

**–°—Ç–∞—Ç—É—Å**: ‚úÖ –î–æ–¥–∞–Ω–æ –≤ –ø–ª–∞–Ω

---

### –ü–æ–ø—Ä–∞–≤–∫–∞ 2: –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è antiRepetitionWindow
**–ü—Ä–æ–±–ª–µ–º–∞**: –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á —Ö–æ—á–µ "–∫—ñ–ª—å–∫—ñ—Å—Ç—å –±–∞–∂–∞–Ω–æ –≤–∏–∑–Ω–∞—á–∞—Ç–∏ –≤ –∫–æ–Ω—Ñ—ñ–≥—É"

**–†—ñ—à–µ–Ω–Ω—è**:
```javascript
// config/validation-config.js
export const VALIDATION_CONFIG = {
  history: {
    maxSize: 1000,              // –ü–æ–≤–Ω–∞ —ñ—Å—Ç–æ—Ä—ñ—è
    antiRepetitionWindow: 100,  // ‚≠ê –ö–û–ù–§–Ü–ì–£–†–£–Ñ–¢–¨–°–Ø
    maxFailuresBeforeBlock: 3   // ‚≠ê –ö–û–ù–§–Ü–ì–£–†–£–Ñ–¢–¨–°–Ø
  }
};
```

**–°—Ç–∞—Ç—É—Å**: ‚úÖ –î–æ–¥–∞–Ω–æ –≤ –ø–ª–∞–Ω

---

### –ü–æ–ø—Ä–∞–≤–∫–∞ 3: –ö–µ—à—É–≤–∞–Ω–Ω—è MCP tools/list
**–ü—Ä–æ–±–ª–µ–º–∞**: –Ø–∫—â–æ –≤–∏–∫–ª–∏–∫–∞—Ç–∏ tools/list –∫–æ–∂–Ω—ñ 10 —Å–µ–∫—É–Ω–¥ - –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è

**–†—ñ—à–µ–Ω–Ω—è**:
```javascript
// mcp-sync-validator.js
constructor(mcpManager) {
  this.cache = new Map();
  this.cacheTTL = VALIDATION_CONFIG.mcpSync.cacheTTL || 60000; // ‚≠ê –ó –∫–æ–Ω—Ñ—ñ–≥—É
}
```

**–°—Ç–∞—Ç—É—Å**: ‚úÖ –î–æ–¥–∞–Ω–æ –≤ –ø–ª–∞–Ω

---

### –ü–æ–ø—Ä–∞–≤–∫–∞ 4: –ú–µ—Ç—Ä–∏–∫–∞ —É—Å–ø—ñ—à–Ω–æ—Å—Ç—ñ –≤ —ñ—Å—Ç–æ—Ä—ñ—ó
**–ü—Ä–æ–±–ª–µ–º–∞**: –Ø–∫ —Ä–æ–∑—Ä–∞—Ö–æ–≤—É—î—Ç—å—Å—è successRate?

**–†—ñ—à–µ–Ω–Ω—è**:
```javascript
// tool-history-manager.js
getToolSuccessRate(server, tool) {
  const records = this.history.filter(r => 
    r.server === server && r.tool === tool
  );
  
  if (records.length === 0) return 1.0; // –ù–µ–≤—ñ–¥–æ–º–∏–π —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç = 100%
  
  const successful = records.filter(r => r.label === 'SUCCESS').length;
  return successful / records.length;
}
```

**–°—Ç–∞—Ç—É—Å**: ‚úÖ –î–æ–¥–∞–Ω–æ –≤ –ø–ª–∞–Ω

---

## üìä –§–Ü–ù–ê–õ–¨–ù–ê –û–¶–Ü–ù–ö–ê –ü–õ–ê–ù–£

### –í—ñ–¥–ø–æ–≤—ñ–¥–Ω—ñ—Å—Ç—å –≤–∏–º–æ–≥–∞–º: 5/5 ‚úÖ

| –í–∏–º–æ–≥–∞ | –°—Ç–∞—Ç—É—Å | –ö–æ–º–µ–Ω—Ç–∞—Ä |
|--------|--------|----------|
| –ü–æ—Å–ª—ñ–¥–æ–≤–Ω–∞ –≤–∞–ª—ñ–¥–∞—Ü—ñ—è | ‚úÖ | Pipeline –∑ early rejection |
| –°—Ç–∞—Ç–∏—á–Ω—ñ –æ–ø–∏—Å–∏ / MCP –∫–æ–º–∞–Ω–¥–∞ | ‚úÖ | –°—Ç–∞—Ç–∏—á–Ω—ñ (Phase 8) + fallback |
| –Ü—Å—Ç–æ—Ä—ñ—è –∑ –ª–µ–π–±–ª–∞–º–∏ | ‚úÖ | SUCCESS/FAILURE + 2 use cases |
| MCP tools/list –∞–≤—Ç–æ–∫–æ—Ä–µ–∫—Ü—ñ—è | ‚úÖ | Level 4, –∫—Ä–∏—Ç–∏—á–Ω–∏–π –µ—Ç–∞–ø |
| –¶–µ–Ω—Ç—Ä–∞–ª—ñ–∑–æ–≤–∞–Ω–∏–π —Ä–µ—î—Å—Ç—Ä | ‚úÖ | Phase 1, —î–¥–∏–Ω–∞ —Ç–æ—á–∫–∞ –≤—Ö–æ–¥—É |

### –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–Ω–∞ —è–∫—ñ—Å—Ç—å: 5/5 ‚úÖ

- ‚úÖ –ú–æ–¥—É–ª—å–Ω—ñ—Å—Ç—å (–æ–∫—Ä–µ–º—ñ validators)
- ‚úÖ –†–æ–∑—à–∏—Ä—é–≤–∞–Ω—ñ—Å—Ç—å (–ª–µ–≥–∫–æ –¥–æ–¥–∞—Ç–∏ –Ω–æ–≤–∏–π validator)
- ‚úÖ –ï—Ñ–µ–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å (early rejection)
- ‚úÖ –ù–∞–¥—ñ–π–Ω—ñ—Å—Ç—å (fallbacks –Ω–∞ –∫–æ–∂–Ω–æ–º—É —Ä—ñ–≤–Ω—ñ)
- ‚úÖ –ü—ñ–¥—Ç—Ä–∏–º—É–≤–∞–Ω—ñ—Å—Ç—å (—Ü–µ–Ω—Ç—Ä–∞–ª—ñ–∑–æ–≤–∞–Ω–∏–π —Ä–µ—î—Å—Ç—Ä)

### –Ü–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü—ñ—è: 4.5/5 ‚úÖ

- ‚úÖ –ß—ñ—Ç–∫—ñ phases (9 –µ—Ç–∞–ø—ñ–≤)
- ‚úÖ –î–µ—Ç–∞–ª—å–Ω—ñ deliverables
- ‚úÖ –†–∏—Å–∫–∏ —Ç–∞ mitigation
- ‚ö†Ô∏è –ü–æ—Ç—Ä–µ–±—É—î ~3-4 —Ç–∏–∂–Ω—ñ (–º–æ–∂–ª–∏–≤–æ –æ–ø—Ç–∏–º—ñ–∑—É–≤–∞—Ç–∏)

---

## ‚úÖ FINAL APPROVAL

**–°—Ç–∞—Ç—É—Å**: **–ü–õ–ê–ù –ó–ê–¢–í–ï–†–î–ñ–ï–ù–û** ‚úÖ

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó**:
1. –ü–æ—á–∏–Ω–∞—Ç–∏ –∑ Phase 1-2 (—Ñ—É–Ω–¥–∞–º–µ–Ω—Ç) - 5 –¥–Ω—ñ–≤
2. Phase 6 (MCP Sync) - –Ω–∞–π–∫—Ä–∏—Ç–∏—á–Ω—ñ—à–∏–π, –≤–∏–¥—ñ–ª–∏—Ç–∏ 4 –¥–Ω—ñ
3. Phase 8 (Static descriptions) - –º–æ–∂–Ω–∞ –ø–∞—Ä–∞–ª–µ–ª—å–Ω–æ –∑ Phase 6
4. Extensive testing –ø–µ—Ä–µ–¥ production

**–û—á—ñ–∫—É–≤–∞–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç**: 
- 95%+ –ø—Ä–∞–≤–∏–ª—å–Ω–∏—Ö —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ñ–≤ –∑ –ø–µ—Ä—à–æ—ó —Å–ø—Ä–æ–±–∏
- 90%+ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –±–µ–∑ –ø–æ–º–∏–ª–æ–∫
- <5% –ø–æ–≤—Ç–æ—Ä–µ–Ω—å –ø—ñ—Å–ª—è –Ω–µ–≤–¥–∞—á
- –ú–∞–π–∂–µ 100% –Ω–∞–¥—ñ–π–Ω—ñ—Å—Ç—å —Å–∏—Å—Ç–µ–º–∏ üéØ

**–ì–æ—Ç–æ–≤–Ω—ñ—Å—Ç—å –¥–æ —ñ–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü—ñ—ó**: ‚úÖ READY
