# –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó –∑ –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥—É - Workflow System

**–î–∞—Ç–∞**: 20 –ª–∏—Å—Ç–æ–ø–∞–¥–∞ 2025  
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ  
**–ü—Ä—ñ–æ—Ä–∏—Ç–µ—Ç**: üî¥ –ö–†–ò–¢–ò–ß–ù–ò–ô  

---

## üìã –†–µ–∑—é–º–µ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ–π

### –í–∏—è–≤–ª–µ–Ω—ñ –ü—Ä–æ–±–ª–µ–º–∏

| #   | –ü—Ä–æ–±–ª–µ–º–∞                      | –§–∞–π–ª—ñ–≤ | –†—è–¥–∫—ñ–≤ | –ü—Ä—ñ–æ—Ä–∏—Ç–µ—Ç        | –ß–∞—Å      |
| --- | ----------------------------- | ------ | ------ | ---------------- | -------- |
| 1   | –î—É–±–ª—é–≤–∞–Ω–Ω—è –º–µ—Ç–æ–¥—ñ–≤ execute()  | 34     | 1,700  | üî¥ –ö–†–ò–¢–ò–ß–ù–ò–ô      | 6-8 –≥–æ–¥  |
| 2   | –ù–∞–¥–ª–∏—à–∫–æ–≤–µ –ª–æ–≥—É–≤–∞–Ω–Ω—è          | 47     | 1,300  | üü† –í–ê–ñ–õ–ò–í–ò–ô       | 4-6 –≥–æ–¥  |
| 3   | MCPTodoManager (legacy)       | 1      | 3,941  | üî¥ –ö–†–ò–¢–ò–ß–ù–ò–ô      | 2-3 –≥–æ–¥  |
| 4   | Disabled Nexus –∫–æ–¥            | 1      | 20     | üî¥ –ö–†–ò–¢–ò–ß–ù–ò–ô      | 0.5 –≥–æ–¥  |
| 5   | –°–∫–ª–∞–¥–Ω–∞ –ª–æ–≥—ñ–∫–∞ executor-v3.js | 1      | 1,551  | üü† –í–ê–ñ–õ–ò–í–ò–ô       | 8-10 –≥–æ–¥ |
| 6   | –û–±—Ä–æ–±–∫–∞ –ø–æ–º–∏–ª–æ–∫ (–¥—É–±–ª—é–≤–∞–Ω–Ω—è)  | 47     | 470    | üü† –í–ê–ñ–õ–ò–í–ò–ô       | 4-6 –≥–æ–¥  |
| 7   | –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è ID (–¥—É–±–ª—é–≤–∞–Ω–Ω—è)     | 15     | 45     | üü° –†–ï–ö–û–ú–ï–ù–î–û–í–ê–ù–ò–ô | 1-2 –≥–æ–¥  |
| 8   | –ù–µ–≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞–Ω—ñ –º–µ—Ç–æ–¥–∏      | ~10    | ~500   | üü† –í–ê–ñ–õ–ò–í–ò–ô       | 2-3 –≥–æ–¥  |

### –ó–∞–≥–∞–ª—å–Ω–∞ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

- **–í—Å—å–æ–≥–æ –ø—Ä–æ–±–ª–µ–º**: 8
- **–í—Å—å–æ–≥–æ —Ñ–∞–π–ª—ñ–≤**: 47
- **–í—Å—å–æ–≥–æ —Ä—è–¥–∫—ñ–≤ –∫–æ–¥—É**: ~9,527
- **–ú–æ–∂–Ω–∞ –≤–∏–¥–∞–ª–∏—Ç–∏**: ~4,761 —Ä—è–¥–∫—ñ–≤ (-50%)
- **–ú–æ–∂–Ω–∞ –æ–ø—Ç–∏–º—ñ–∑—É–≤–∞—Ç–∏**: ~4,766 —Ä—è–¥–∫—ñ–≤ (-50%)
- **–ó–∞–≥–∞–ª—å–Ω–∏–π —á–∞—Å —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥—É**: 27-38 –≥–æ–¥–∏–Ω (3-5 —Ç–∏–∂–Ω—ñ–≤)

---

## üéØ –ü—Ä—ñ–æ—Ä–∏—Ç–∏–∑–æ–≤–∞–Ω—ñ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó

### –†—ñ–≤–µ–Ω—å 1: –ö–†–ò–¢–ò–ß–ù–ò–ô (–í–∏–∫–æ–Ω–∞—Ç–∏ –ù–ï–ì–ê–ô–ù–û)

#### 1.1 –í–∏–¥–∞–ª–∏—Ç–∏ MCPTodoManager

**–ü—Ä–∏—á–∏–Ω–∞**: –ó–∞–º—ñ–Ω–µ–Ω–∞ –Ω–∞ WorkflowEngine, –Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è  
**–§–∞–π–ª**: `orchestrator/workflow/mcp-todo-manager.js`  
**–†–æ–∑–º—ñ—Ä**: 3,941 —Ä—è–¥–∫—ñ–≤  
**–ß–∞—Å**: 2-3 –≥–æ–¥–∏–Ω–∏  

**–î—ñ—ó**:
```bash
# 1. –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –ø–æ—Å–∏–ª–∞–Ω–Ω—è
grep -r "MCPTodoManager" orchestrator/ --exclude-dir=node_modules

# 2. –í–∏–¥–∞–ª–∏—Ç–∏ —Ñ–∞–π–ª
rm orchestrator/workflow/mcp-todo-manager.js

# 3. –û–Ω–æ–≤–∏—Ç–∏ git
git rm orchestrator/workflow/mcp-todo-manager.js
git commit -m "Remove legacy MCPTodoManager (replaced by WorkflowEngine)"

# 4. –ó–∞–ø—É—Å—Ç–∏—Ç–∏ —Ç–µ—Å—Ç–∏
npm test
```

**–û—á—ñ–∫—É–≤–∞–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç**: -3,941 —Ä—è–¥–∫—ñ–≤ –∫–æ–¥—É

---

#### 1.2 –í–∏–¥–∞–ª–∏—Ç–∏ Disabled Nexus –ö–æ–¥

**–ü—Ä–∏—á–∏–Ω–∞**: –ó–∞–∫–æ–º–µ–Ω—Ç–æ–≤–∞–Ω–∏–π, –∫–æ–Ω—Ñ–ª—ñ–∫—Ç—É—î –∑ devSelfAnalysisProcessor  
**–§–∞–π–ª**: `orchestrator/workflow/executor-v3.js` (—Ä—è–¥–∫–∏ 915-934)  
**–†–æ–∑–º—ñ—Ä**: 20 —Ä—è–¥–∫—ñ–≤  
**–ß–∞—Å**: 0.5 –≥–æ–¥–∏–Ω–∏  

**–î—ñ—ó**:
```javascript
// –í–ò–î–ê–õ–ò–¢–ò –†–Ø–î–ö–ò 915-934:
/*
// ===============================================
// NEXUS CONTEXT-AWARE ACTIVATION (DISABLED 02.11.2025)
// ...
const nexusActivator = await container.resolve('nexusContextActivator');
// ...
*/

// –ó–ê–õ–ò–®–ò–¢–ò –¢–Ü–õ–¨–ö–ò:
// –Ø–∫—â–æ Nexus –Ω–µ –ø–æ—Ç—Ä—ñ–±–µ–Ω - –ø—Ä–æ–¥–æ–≤–∂—É—î–º–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏–π workflow
// Resolve processors from DI Container
const modeProcessor = container.resolve('modeSelectionProcessor');
```

**–û—á—ñ–∫—É–≤–∞–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç**: -20 —Ä—è–¥–∫—ñ–≤ –∫–æ–¥—É

---

#### 1.3 –í–∏–¥–∞–ª–∏—Ç–∏ –°—Ç–∞—Ä–∏–π state-machine.js

**–ü—Ä–∏—á–∏–Ω–∞**: –ó–∞–º—ñ–Ω–µ–Ω–∞ –Ω–∞ WorkflowStateMachine, –Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è  
**–§–∞–π–ª**: `orchestrator/workflow/state-machine.js`  
**–†–æ–∑–º—ñ—Ä**: ~200 —Ä—è–¥–∫—ñ–≤  
**–ß–∞—Å**: 0.5 –≥–æ–¥–∏–Ω–∏  

**–î—ñ—ó**:
```bash
# 1. –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –ø–æ—Å–∏–ª–∞–Ω–Ω—è
grep -r "from.*state-machine.js\|require.*state-machine.js" orchestrator/

# 2. –í–∏–¥–∞–ª–∏—Ç–∏ —Ñ–∞–π–ª
rm orchestrator/workflow/state-machine.js

# 3. –û–Ω–æ–≤–∏—Ç–∏ git
git rm orchestrator/workflow/state-machine.js
git commit -m "Remove legacy state-machine.js (replaced by WorkflowStateMachine)"
```

**–û—á—ñ–∫—É–≤–∞–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç**: -200 —Ä—è–¥–∫—ñ–≤ –∫–æ–¥—É

---

### –†—ñ–≤–µ–Ω—å 2: –í–ê–ñ–õ–ò–í–ò–ô (–í–∏–∫–æ–Ω–∞—Ç–∏ –Ω–∞ —Ü—å–æ–º—É —Ç–∏–∂–Ω—ñ)

#### 2.1 –°—Ç–≤–æ—Ä–∏—Ç–∏ ExecutorBase –¥–ª—è –í–∏–¥–∞–ª–µ–Ω–Ω—è –î—É–±–ª—é–≤–∞–Ω–Ω—è

**–ü—Ä–∏—á–∏–Ω–∞**: 34 –º–µ—Ç–æ–¥–∏ execute() –∑ –æ–¥–Ω–∞–∫–æ–≤–æ—é —Å—Ç—Ä—É–∫—Ç—É—Ä–æ—é  
**–§–∞–π–ª—ñ–≤**: 34  
**–î—É–±–ª—é–≤–∞–Ω–Ω—è**: 1,700 —Ä—è–¥–∫—ñ–≤  
**–ß–∞—Å**: 6-8 –≥–æ–¥–∏–Ω  

**–î—ñ—ó**:

1. **–°—Ç–≤–æ—Ä–∏—Ç–∏ –±–∞–∑–æ–≤–∏–π –∫–ª–∞—Å**:
```javascript
// orchestrator/workflow/core/executor-base.js
export class ExecutorBase {
    constructor(options = {}) {
        this.logger = options.logger || console;
        this.componentName = options.componentName || this.constructor.name;
    }

    _generateExecutionId() {
        return `exec_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
    }

    async executeWithMetrics(operation, context = {}) {
        const executionId = this._generateExecutionId();
        const startTime = Date.now();

        this.logger.system(this.componentName, 
            `[${executionId}] Starting execution`, 
            context
        );

        try {
            const result = await operation();
            const duration = Date.now() - startTime;

            this.logger.system(this.componentName,
                `[${executionId}] Completed`,
                { duration, success: true }
            );

            return { success: true, result, duration, executionId };

        } catch (error) {
            const duration = Date.now() - startTime;

            this.logger.error(this.componentName,
                `[${executionId}] Failed`,
                { error: error.message, stack: error.stack, duration }
            );

            throw error;
        }
    }

    async executeWithRetries(operation, options = {}) {
        const { maxAttempts = 3, delayMs = 1000, context = {} } = options;
        const executionId = this._generateExecutionId();

        for (let attempt = 1; attempt <= maxAttempts; attempt++) {
            try {
                return await operation();
            } catch (error) {
                if (attempt === maxAttempts) throw error;
                await new Promise(resolve => setTimeout(resolve, delayMs));
            }
        }
    }

    _validateContext(context, requiredFields = []) {
        if (!context || typeof context !== 'object') {
            throw new Error('Context must be an object');
        }
        for (const field of requiredFields) {
            if (!(field in context)) {
                throw new Error(`Context missing required field: ${field}`);
            }
        }
    }

    _handleError(error, operation, context = {}) {
        this.logger.error(this.componentName,
            `Error in ${operation}`,
            { error: error.message, stack: error.stack, ...context }
        );
        throw error;
    }
}
```

2. **–û–Ω–æ–≤–∏—Ç–∏ 34 —Ñ–∞–π–ª–∏ –¥–ª—è —É—Å–ø–∞–¥–∫—É–≤–∞–Ω–Ω—è**:
```javascript
// –ü—Ä–∏–∫–ª–∞–¥: orchestrator/workflow/core/todo-executor.js
import { ExecutorBase } from './executor-base.js';

export class TodoExecutor extends ExecutorBase {
    constructor(options = {}) {
        super({ ...options, componentName: 'todo-executor' });
        this.toolPlanner = options.toolPlanner;
        this.toolExecutor = options.toolExecutor;
        this.verificationEngine = options.verificationEngine;
    }

    async execute(todo, session, options = {}) {
        return this.executeWithMetrics(async () => {
            this._validateContext(session, ['id']);
            
            const results = { itemsProcessed: 0, itemsFailed: 0, items: [] };

            for (let i = 0; i < todo.items.length; i++) {
                const item = todo.items[i];
                try {
                    const itemResult = await this._executeItemWithRetries(item, todo, session);
                    results.items.push(itemResult);
                    if (itemResult.status === 'completed') results.itemsProcessed++;
                } catch (error) {
                    this._handleError(error, `execute item ${i}`, { itemId: item.id });
                    results.itemsFailed++;
                }
            }

            return results;
        }, { todoItemCount: todo.items.length });
    }

    async _executeItemWithRetries(item, todo, session) {
        return this.executeWithRetries(
            async () => this._executeItem(item, todo, session),
            { maxAttempts: item.max_attempts || 3, delayMs: 1000 }
        );
    }

    async _executeItem(item, todo, session) {
        // ... –æ—Å–Ω–æ–≤–Ω–∞ –ª–æ–≥—ñ–∫–∞ ...
    }
}
```

3. **–û–Ω–æ–≤–∏—Ç–∏ –≤—Å—ñ 34 —Ñ–∞–π–ª–∏**:
   - `core/todo-builder.js`
   - `core/workflow-engine.js`
   - `execution/mcp-executor.js`
   - `execution/tool-executor.js`
   - `execution/fallback-handler.js`
   - `hybrid/hybrid-executor.js`
   - `hybrid/worker-pool.js`
   - `hybrid/execution-tracker.js`
   - `hybrid/recipe-processor.js`
   - `hybrid/stream-notifier.js`
   - `hybrid/verification-adapter.js`
   - `planning/tool-planner.js`
   - `planning/dependency-resolver.js`
   - `planning/adaptive-planner.js`
   - `verification/verification-engine.js`
   - `verification/mcp-verifier.js`
   - `verification/llm-verifier.js`
   - `verification/adaptive-verifier.js`
   - `stages/base-processor.js`
   - `stages/mode-selection-processor.js`
   - `stages/dev-self-analysis-processor.js`
   - `stages/atlas-todo-planning-processor.js`
   - `stages/tetyana-plan-tools-processor.js`
   - `stages/tetyana-execute-tools-processor.js`
   - `stages/grisha-verify-item-processor.js`
   - `stages/atlas-replan-todo-processor.js`
   - `stages/mcp-final-summary-processor.js`
   - `stages/server-selection-processor.js`
   - `stages/chat-memory-eligibility-processor.js`
   - `stages/grisha-verification-eligibility-processor.js`
   - `stages/router-classifier-processor.js`
   - `stages/intent-detector.js`
   - `state-machine/WorkflowStateMachine.js`
   - `chat-memory-coordinator.js`

**–û—á—ñ–∫—É–≤–∞–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç**: -1,550 —Ä—è–¥–∫—ñ–≤ –∫–æ–¥—É (-91% –¥—É–±–ª—é–≤–∞–Ω–Ω—è)

---

#### 2.2 –ö–æ–Ω—Å–æ–ª—ñ–¥—É–≤–∞—Ç–∏ –õ–æ–≥—É–≤–∞–Ω–Ω—è

**–ü—Ä–∏—á–∏–Ω–∞**: 649 –æ–ø–µ—Ä–∞—Ü—ñ–π –ª–æ–≥—É–≤–∞–Ω–Ω—è –∑ –æ–¥–Ω–∞–∫–æ–≤–∏–º –ø–∞—Ç—Ç–µ—Ä–Ω–æ–º  
**–§–∞–π–ª—ñ–≤**: 47  
**–ß–∞—Å**: 4-6 –≥–æ–¥–∏–Ω  

**–î—ñ—ó**:

1. **–°—Ç–≤–æ—Ä–∏—Ç–∏ logging middleware**:
```javascript
// orchestrator/workflow/utils/logging-middleware.js
export function logExecution(componentName, options = {}) {
    const { logArgs = false, logResult = true, logDuration = true } = options;

    return function(target, propertyKey, descriptor) {
        const originalMethod = descriptor.value;

        descriptor.value = async function(...args) {
            const executionId = this._generateExecutionId?.() || 
                               `exec_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
            const startTime = Date.now();

            this.logger?.system?.(componentName,
                `[${executionId}] Starting ${propertyKey}`,
                logArgs ? { args: args.map(a => typeof a === 'object' ? Object.keys(a) : a) } : {}
            );

            try {
                const result = await originalMethod.apply(this, args);
                const duration = Date.now() - startTime;

                const resultContext = { success: true };
                if (logDuration) resultContext.duration = duration;
                if (logResult && result) resultContext.resultKeys = Object.keys(result);

                this.logger?.system?.(componentName,
                    `[${executionId}] Completed ${propertyKey}`,
                    resultContext
                );

                return result;

            } catch (error) {
                const duration = Date.now() - startTime;

                this.logger?.error?.(componentName,
                    `[${executionId}] Failed ${propertyKey}`,
                    { error: error.message, duration, stack: error.stack }
                );

                throw error;
            }
        };

        return descriptor;
    };
}
```

2. **–ó–∞–º—ñ–Ω–∏—Ç–∏ –ª–æ–≥—É–≤–∞–Ω–Ω—è –≤ 47 —Ñ–∞–π–ª–∞—Ö**:
```javascript
// –ü—Ä–∏–∫–ª–∞–¥: stages/grisha-verify-item-processor.js
import { logExecution } from '../utils/logging-middleware.js';

export class GrishaVerifyItemProcessor {
    @logExecution('grisha-verify', { logDuration: true })
    async execute(context) {
        // ... –∫–æ–¥ –±–µ–∑ –ª–æ–≥—É–≤–∞–Ω–Ω—è ...
        return result;
    }

    @logExecution('grisha-verify', { logArgs: true })
    async verifyItem(item) {
        // ... –∫–æ–¥ ...
        return verification;
    }
}
```

**–û—á—ñ–∫—É–≤–∞–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç**: -300 —Ä—è–¥–∫—ñ–≤ –∫–æ–¥—É (-55% –ª–æ–≥—É–≤–∞–Ω–Ω—è)

---

#### 2.3 –°–ø—Ä–æ—Å—Ç–∏—Ç–∏ executor-v3.js

**–ü—Ä–∏—á–∏–Ω–∞**: 1,551 —Ä—è–¥–∫—ñ–≤ –∑ —Å–∫–ª–∞–¥–Ω–æ—é –ª–æ–≥—ñ–∫–æ—é –≤–∏–±–æ—Ä—É —Ä–µ–∂–∏–º—É  
**–§–∞–π–ª**: `orchestrator/workflow/executor-v3.js`  
**–ß–∞—Å**: 8-10 –≥–æ–¥–∏–Ω  

**–î—ñ—ó**:

1. **–†–æ–∑–¥—ñ–ª–∏—Ç–∏ –Ω–∞ 3 —Ñ–∞–π–ª–∏ –∑–∞ —Ä–µ–∂–∏–º–∞–º–∏**:

```javascript
// orchestrator/workflow/modes/hybrid-mode-executor.js
export class HybridModeExecutor {
    constructor(config) {
        this.config = config;
        this.logger = config.logger;
    }

    async execute(userMessage, context) {
        // –õ–æ–≥—ñ–∫–∞ hybrid —Ä–µ–∂–∏–º—É
    }
}

// orchestrator/workflow/modes/optimized-mode-executor.js
export class OptimizedModeExecutor {
    constructor(config) {
        this.config = config;
        this.logger = config.logger;
    }

    async execute(userMessage, context) {
        // –õ–æ–≥—ñ–∫–∞ optimized —Ä–µ–∂–∏–º—É
    }
}

// orchestrator/workflow/modes/standard-mode-executor.js
export class StandardModeExecutor {
    constructor(config) {
        this.config = config;
        this.logger = config.logger;
    }

    async execute(userMessage, context) {
        // –õ–æ–≥—ñ–∫–∞ standard —Ä–µ–∂–∏–º—É
    }
}
```

2. **–°—Ç–≤–æ—Ä–∏—Ç–∏ —Ñ–∞–±—Ä–∏–∫—É —Ä–µ–∂–∏–º—ñ–≤**:
```javascript
// orchestrator/workflow/modes/mode-executor-factory.js
export class ModeExecutorFactory {
    static createExecutor(mode, config) {
        switch(mode) {
            case 'hybrid':
                return new HybridModeExecutor(config);
            case 'optimized':
                return new OptimizedModeExecutor(config);
            default:
                return new StandardModeExecutor(config);
        }
    }
}
```

3. **–°–ø—Ä–æ—Å—Ç–∏—Ç–∏ executor-v3.js**:
```javascript
// orchestrator/workflow/executor-v3.js (—Å–ø—Ä–æ—â–µ–Ω–∞ –≤–µ—Ä—Å—ñ—è)
import { ModeExecutorFactory } from './modes/mode-executor-factory.js';

export async function executeWorkflow(userMessage, options) {
    const { logger, container, res } = options;
    
    const workflowConfig = container.resolve('config').ENV_CONFIG?.workflow || {};
    const engineMode = workflowConfig.engineMode || 'state_machine';

    logger.system('executor', `Using mode: ${engineMode}`);

    const executor = ModeExecutorFactory.createExecutor(engineMode, {
        logger,
        container,
        res,
        ...options
    });

    return executor.execute(userMessage, {
        session: options.session,
        container,
        logger
    });
}
```

**–û—á—ñ–∫—É–≤–∞–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç**: -1,000 —Ä—è–¥–∫—ñ–≤ –∫–æ–¥—É (-65% —Å–∫–ª–∞–¥–Ω–æ—Å—Ç—ñ)

---

### –†—ñ–≤–µ–Ω—å 3: –†–ï–ö–û–ú–ï–ù–î–û–í–ê–ù–ò–ô (–í–∏–∫–æ–Ω–∞—Ç–∏ –Ω–∞—Å—Ç—É–ø–Ω–æ–≥–æ —Ç–∏–∂–Ω—è)

#### 3.1 –ö–æ–Ω—Å–æ–ª—ñ–¥—É–≤–∞—Ç–∏ –û–±—Ä–æ–±–∫—É –ü–æ–º–∏–ª–æ–∫

**–ü—Ä–∏—á–∏–Ω–∞**: 47 –æ–¥–Ω–∞–∫–æ–≤–∏—Ö –±–ª–æ–∫—ñ–≤ try-catch  
**–ß–∞—Å**: 4-6 –≥–æ–¥–∏–Ω  

**–î—ñ—ó**:
```javascript
// orchestrator/workflow/utils/error-handler.js
export class ErrorHandler {
    static async handle(operation, options = {}) {
        const { logger, componentName = 'unknown', operationName = 'operation', throwError = true, context = {} } = options;

        try {
            return await operation();
        } catch (error) {
            logger?.error?.(componentName, `${operationName} failed`, {
                error: error.message,
                stack: error.stack,
                ...context
            });

            if (throwError) throw error;
            return { success: false, error: error.message };
        }
    }

    static async handleWithRetry(operation, options = {}) {
        const { maxAttempts = 3, delayMs = 1000, logger, componentName = 'unknown', operationName = 'operation', context = {} } = options;

        for (let attempt = 1; attempt <= maxAttempts; attempt++) {
            try {
                return await operation();
            } catch (error) {
                if (attempt === maxAttempts) {
                    logger?.error?.(componentName, `${operationName} failed after ${maxAttempts} attempts`, { error: error.message, ...context });
                    throw error;
                }

                logger?.warn?.(componentName, `${operationName} attempt ${attempt} failed, retrying`, { error: error.message });
                await new Promise(resolve => setTimeout(resolve, delayMs));
            }
        }
    }
}
```

**–û—á—ñ–∫—É–≤–∞–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç**: -350 —Ä—è–¥–∫—ñ–≤ –∫–æ–¥—É (-74% –¥—É–±–ª—é–≤–∞–Ω–Ω—è)

---

#### 3.2 –ö–æ–Ω—Å–æ–ª—ñ–¥—É–≤–∞—Ç–∏ –ì–µ–Ω–µ—Ä–∞—Ü—ñ—é ID

**–ü—Ä–∏—á–∏–Ω–∞**: 15 –æ–¥–Ω–∞–∫–æ–≤–∏—Ö –º–µ—Ç–æ–¥—ñ–≤ –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó ID  
**–ß–∞—Å**: 1-2 –≥–æ–¥–∏–Ω–∏  

**–î—ñ—ó**:
```javascript
// orchestrator/workflow/utils/id-generator.js
export class IdGenerator {
    static generateExecutionId() {
        return `exec_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
    }

    static generateWorkflowId() {
        return `wf_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
    }

    static generateItemId() {
        return `item_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
    }

    static generateSessionId() {
        return `session_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
    }
}
```

**–û—á—ñ–∫—É–≤–∞–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç**: -30 —Ä—è–¥–∫—ñ–≤ –∫–æ–¥—É (-67% –¥—É–±–ª—é–≤–∞–Ω–Ω—è)

---

#### 3.3 –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Ç–∞ –í–∏–¥–∞–ª–∏—Ç–∏ –ù–µ–≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞–Ω—ñ –ú–µ—Ç–æ–¥–∏

**–ü—Ä–∏—á–∏–Ω–∞**: –ü–æ—Ç–µ–Ω—Ü—ñ–π–Ω—ñ –Ω–µ–≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞–Ω—ñ –º–µ—Ç–æ–¥–∏  
**–ß–∞—Å**: 2-3 –≥–æ–¥–∏–Ω–∏  

**–î—ñ—ó**:
```bash
# 1. –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –∫–æ–∂–µ–Ω –º–µ—Ç–æ–¥
grep -r "getStatus" orchestrator/ --exclude-dir=node_modules
grep -r "_generateItems" orchestrator/ --exclude-dir=node_modules
grep -r "_enhanceCriteria" orchestrator/ --exclude-dir=node_modules

# 2. –í–∏–¥–∞–ª–∏—Ç–∏ –Ω–µ–≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞–Ω—ñ
# 3. –û–Ω–æ–≤–∏—Ç–∏ —Ç–µ—Å—Ç–∏
npm test
```

**–û—á—ñ–∫—É–≤–∞–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç**: -100-200 —Ä—è–¥–∫—ñ–≤ –∫–æ–¥—É

---

## üìä –ü–ª–∞–Ω –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥—É –ø–æ –§–∞–∑–∞–º

### –§–∞–∑–∞ 1: –í–∏–¥–∞–ª–µ–Ω–Ω—è –ú–µ—Ä—Ç–≤–æ–≥–æ –ö–æ–¥—É (1-2 –¥–Ω—ñ)

**–ó–∞–≤–¥–∞–Ω–Ω—è**:
1. –í–∏–¥–∞–ª–∏—Ç–∏ MCPTodoManager (3,941 —Ä—è–¥–∫—ñ–≤)
2. –í–∏–¥–∞–ª–∏—Ç–∏ disabled Nexus –∫–æ–¥ (20 —Ä—è–¥–∫—ñ–≤)
3. –í–∏–¥–∞–ª–∏—Ç–∏ state-machine.js (200 —Ä—è–¥–∫—ñ–≤)

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: -4,161 —Ä—è–¥–∫—ñ–≤ –∫–æ–¥—É (-28%)

**–ö–æ–Ω—Ç—Ä–æ–ª—å–Ω–∏–π —Å–ø–∏—Å–æ–∫**:
- [ ] –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –ø–æ—Å–∏–ª–∞–Ω–Ω—è
- [ ] –í–∏–¥–∞–ª–∏—Ç–∏ —Ñ–∞–π–ª–∏
- [ ] –ó–∞–ø—É—Å—Ç–∏—Ç–∏ —Ç–µ—Å—Ç–∏
- [ ] –û–Ω–æ–≤–∏—Ç–∏ git

---

### –§–∞–∑–∞ 2: –í–∏–¥–∞–ª–µ–Ω–Ω—è –î—É–±–ª—é–≤–∞–Ω–Ω—è (3-4 –¥–Ω—ñ)

**–ó–∞–≤–¥–∞–Ω–Ω—è**:
1. –°—Ç–≤–æ—Ä–∏—Ç–∏ ExecutorBase (150 —Ä—è–¥–∫—ñ–≤)
2. –û–Ω–æ–≤–∏—Ç–∏ 34 —Ñ–∞–π–ª–∏ –¥–ª—è —É—Å–ø–∞–¥–∫—É–≤–∞–Ω–Ω—è
3. –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: -1,550 —Ä—è–¥–∫—ñ–≤ –∫–æ–¥—É (-91% –¥—É–±–ª—é–≤–∞–Ω–Ω—è)

**–ö–æ–Ω—Ç—Ä–æ–ª—å–Ω–∏–π —Å–ø–∏—Å–æ–∫**:
- [ ] –°—Ç–≤–æ—Ä–∏—Ç–∏ ExecutorBase
- [ ] –û–Ω–æ–≤–∏—Ç–∏ 34 —Ñ–∞–π–ª–∏
- [ ] –ó–∞–ø—É—Å—Ç–∏—Ç–∏ —Ç–µ—Å—Ç–∏
- [ ] –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ—Å—Ç—å

---

### –§–∞–∑–∞ 3: –ö–æ–Ω—Å–æ–ª—ñ–¥–∞—Ü—ñ—è –õ–æ–≥—É–≤–∞–Ω–Ω—è (2-3 –¥–Ω—ñ)

**–ó–∞–≤–¥–∞–Ω–Ω—è**:
1. –°—Ç–≤–æ—Ä–∏—Ç–∏ logging middleware (100 —Ä—è–¥–∫—ñ–≤)
2. –ó–∞–º—ñ–Ω–∏—Ç–∏ 649 –æ–ø–µ—Ä–∞—Ü—ñ–π –ª–æ–≥—É–≤–∞–Ω–Ω—è
3. –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: -300 —Ä—è–¥–∫—ñ–≤ –∫–æ–¥—É (-55% –ª–æ–≥—É–≤–∞–Ω–Ω—è)

**–ö–æ–Ω—Ç—Ä–æ–ª—å–Ω–∏–π —Å–ø–∏—Å–æ–∫**:
- [ ] –°—Ç–≤–æ—Ä–∏—Ç–∏ middleware
- [ ] –û–Ω–æ–≤–∏—Ç–∏ 47 —Ñ–∞–π–ª—ñ–≤
- [ ] –ó–∞–ø—É—Å—Ç–∏—Ç–∏ —Ç–µ—Å—Ç–∏
- [ ] –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –ª–æ–≥–∏

---

### –§–∞–∑–∞ 4: –°–ø—Ä–æ—â–µ–Ω–Ω—è executor-v3.js (3-4 –¥–Ω—ñ)

**–ó–∞–≤–¥–∞–Ω–Ω—è**:
1. –†–æ–∑–¥—ñ–ª–∏—Ç–∏ –Ω–∞ 3 —Ñ–∞–π–ª–∏ –∑–∞ —Ä–µ–∂–∏–º–∞–º–∏
2. –°—Ç–≤–æ—Ä–∏—Ç–∏ —Ñ–∞–±—Ä–∏–∫—É —Ä–µ–∂–∏–º—ñ–≤
3. –°–ø—Ä–æ—Å—Ç–∏—Ç–∏ executor-v3.js
4. –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: -1,000 —Ä—è–¥–∫—ñ–≤ –∫–æ–¥—É (-65% —Å–∫–ª–∞–¥–Ω–æ—Å—Ç—ñ)

**–ö–æ–Ω—Ç—Ä–æ–ª—å–Ω–∏–π —Å–ø–∏—Å–æ–∫**:
- [ ] –†–æ–∑–¥—ñ–ª–∏—Ç–∏ –Ω–∞ 3 —Ñ–∞–π–ª–∏
- [ ] –°—Ç–≤–æ—Ä–∏—Ç–∏ —Ñ–∞–±—Ä–∏–∫—É
- [ ] –°–ø—Ä–æ—Å—Ç–∏—Ç–∏ executor-v3.js
- [ ] –ó–∞–ø—É—Å—Ç–∏—Ç–∏ —Ç–µ—Å—Ç–∏

---

### –§–∞–∑–∞ 5: –î–æ–¥–∞—Ç–∫–æ–≤–∞ –û–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è (2-3 –¥–Ω—ñ)

**–ó–∞–≤–¥–∞–Ω–Ω—è**:
1. –ö–æ–Ω—Å–æ–ª—ñ–¥—É–≤–∞—Ç–∏ –æ–±—Ä–æ–±–∫—É –ø–æ–º–∏–ª–æ–∫
2. –ö–æ–Ω—Å–æ–ª—ñ–¥—É–≤–∞—Ç–∏ –≥–µ–Ω–µ—Ä–∞—Ü—ñ—é ID
3. –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –Ω–µ–≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞–Ω—ñ –º–µ—Ç–æ–¥–∏
4. –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: -380 —Ä—è–¥–∫—ñ–≤ –∫–æ–¥—É (-76% –¥—É–±–ª—é–≤–∞–Ω–Ω—è)

**–ö–æ–Ω—Ç—Ä–æ–ª—å–Ω–∏–π —Å–ø–∏—Å–æ–∫**:
- [ ] –°—Ç–≤–æ—Ä–∏—Ç–∏ error handler
- [ ] –°—Ç–≤–æ—Ä–∏—Ç–∏ id generator
- [ ] –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –º–µ—Ç–æ–¥–∏
- [ ] –ó–∞–ø—É—Å—Ç–∏—Ç–∏ —Ç–µ—Å—Ç–∏

---

### –§–∞–∑–∞ 6: –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è —Ç–∞ –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è (2-3 –¥–Ω—ñ)

**–ó–∞–≤–¥–∞–Ω–Ω—è**:
1. –ù–∞–ø–∏—Å–∞—Ç–∏ –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–Ω—É –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—é
2. –°—Ç–≤–æ—Ä–∏—Ç–∏ –¥—ñ–∞–≥—Ä–∞–º–∏ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π
3. –ù–∞–ø–∏—Å–∞—Ç–∏ —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ–π–Ω—ñ —Ç–µ—Å—Ç–∏
4. –û–Ω–æ–≤–∏—Ç–∏ README

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: +100% —Ä–æ–∑—É–º—ñ–Ω–Ω—è –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∏

**–ö–æ–Ω—Ç—Ä–æ–ª—å–Ω–∏–π —Å–ø–∏—Å–æ–∫**:
- [ ] –ù–∞–ø–∏—Å–∞—Ç–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—é
- [ ] –°—Ç–≤–æ—Ä–∏—Ç–∏ –¥—ñ–∞–≥—Ä–∞–º–∏
- [ ] –ù–∞–ø–∏—Å–∞—Ç–∏ —Ç–µ—Å—Ç–∏
- [ ] –û–Ω–æ–≤–∏—Ç–∏ README

---

## üìà –û—á—ñ–∫—É–≤–∞–Ω—ñ –†–µ–∑—É–ª—å—Ç–∞—Ç–∏

### –ö—ñ–ª—å–∫—ñ—Å–Ω—ñ

| –ú–µ—Ç—Ä–∏–∫–∞            | –ü–æ—Ç–æ—á–Ω–æ   | –ü—ñ—Å–ª—è   | –ü–æ–ª—ñ–ø—à–µ–Ω–Ω—è |
| ------------------ | --------- | ------- | ---------- |
| –†—è–¥–∫—ñ–≤ –∫–æ–¥—É        | ~15,000   | ~8,000  | -45%       |
| –§–∞–π–ª—ñ–≤             | 47        | 35-40   | -15%       |
| –î—É–±–ª—é–≤–∞–Ω–Ω—è         | 34 –º–µ—Ç–æ–¥–∏ | 0       | -100%      |
| –õ–æ–≥—É–≤–∞–Ω–Ω—è –æ–ø–µ—Ä–∞—Ü—ñ–π | 649       | 200-300 | -55%       |
| –ú–µ—Ä—Ç–≤–∏–π –∫–æ–¥        | ~4,761    | 0       | -100%      |
| –û–±—Ä–æ–±–∫–∞ –ø–æ–º–∏–ª–æ–∫    | 47        | 1       | -98%       |
| –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è ID       | 15        | 1       | -93%       |

### –Ø–∫—ñ—Å–Ω—ñ

- ‚úÖ –õ–µ–≥—à–µ —Ä–æ–∑—É–º—ñ—Ç–∏ –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä—É
- ‚úÖ –õ–µ–≥—à–µ –ø—ñ–¥—Ç—Ä–∏–º—É–≤–∞—Ç–∏ –∫–æ–¥
- ‚úÖ –õ–µ–≥—à–µ –∑–º—ñ–Ω—é–≤–∞—Ç–∏ –ø–æ–≤–µ–¥—ñ–Ω–∫—É –≥–ª–æ–±–∞–ª—å–Ω–æ
- ‚úÖ –ú–µ–Ω—à–µ –ø–æ–º–∏–ª–æ–∫ –ø—Ä–∏ –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—ñ –∫–æ–¥—É
- ‚úÖ –ö—Ä–∞—â–∞ —á–∏—Ç–∞—î–º—ñ—Å—Ç—å
- ‚úÖ –ß–∏—Å—Ç—ñ—à–∏–π git —ñ—Å—Ç–æ—Ä—ñ—è

---

## üöÄ –ü–æ—Ä—è–¥–æ–∫ –í–∏–∫–æ–Ω–∞–Ω–Ω—è

### –¢–∏–∂–¥–µ–Ω—å 1

- **–î–µ–Ω—å 1-2**: –í–∏–¥–∞–ª–∏—Ç–∏ –º–µ—Ä—Ç–≤–∏–π –∫–æ–¥ (–§–∞–∑–∞ 1)
- **–î–µ–Ω—å 3-4**: –°—Ç–≤–æ—Ä–∏—Ç–∏ ExecutorBase (–§–∞–∑–∞ 2)
- **–î–µ–Ω—å 5**: –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è —Ç–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞

### –¢–∏–∂–¥–µ–Ω—å 2

- **–î–µ–Ω—å 1-2**: –ö–æ–Ω—Å–æ–ª—ñ–¥—É–≤–∞—Ç–∏ –ª–æ–≥—É–≤–∞–Ω–Ω—è (–§–∞–∑–∞ 3)
- **–î–µ–Ω—å 3-4**: –°–ø—Ä–æ—Å—Ç–∏—Ç–∏ executor-v3.js (–§–∞–∑–∞ 4)
- **–î–µ–Ω—å 5**: –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è —Ç–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞

### –¢–∏–∂–¥–µ–Ω—å 3

- **–î–µ–Ω—å 1-2**: –î–æ–¥–∞—Ç–∫–æ–≤–∞ –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è (–§–∞–∑–∞ 5)
- **–î–µ–Ω—å 3-4**: –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è —Ç–∞ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è (–§–∞–∑–∞ 6)
- **–î–µ–Ω—å 5**: –§—ñ–Ω–∞–ª—å–Ω–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ç–∞ —Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è

---

## üìã –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω–∏–π –°–ø–∏—Å–æ–∫

### –ü–µ—Ä–µ–¥ –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–æ–º

- [ ] –ü—Ä–æ—á–∏—Ç–∞—Ç–∏ –≤—Å—ñ –∑–≤—ñ—Ç–∏ –∞–Ω–∞–ª—ñ–∑—É
- [ ] –û–±–≥–æ–≤–æ—Ä–∏—Ç–∏ –∑ –∫–æ–º–∞–Ω–¥–æ—é
- [ ] –°—Ç–≤–æ—Ä–∏—Ç–∏ –≥—ñ–ª–∫—É –¥–ª—è —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥—É
- [ ] –ü—ñ–¥–≥–æ—Ç—É–≤–∞—Ç–∏ —Ç–µ—Å—Ç–æ–≤—É –±–∞–∑—É

### –ü—ñ–¥ —á–∞—Å –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥—É

- [ ] –í–∏–∫–æ–Ω—É–≤–∞—Ç–∏ —Ñ–∞–∑–∏ –ø–æ—Å–ª—ñ–¥–æ–≤–Ω–æ
- [ ] –ó–∞–ø—É—Å–∫–∞—Ç–∏ —Ç–µ—Å—Ç–∏ –ø—ñ—Å–ª—è –∫–æ–∂–Ω–æ—ó —Ñ–∞–∑–∏
- [ ] –î–æ–∫—É–º–µ–Ω—Ç—É–≤–∞—Ç–∏ –∑–º—ñ–Ω–∏
- [ ] –ö–æ–º—ñ—Ç–∏—Ç–∏ —á–∞—Å—Ç–æ

### –ü—ñ—Å–ª—è –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥—É

- [ ] –ó–∞–ø—É—Å—Ç–∏—Ç–∏ –≤—Å—ñ —Ç–µ—Å—Ç–∏
- [ ] –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ—Å—Ç—å
- [ ] –û–Ω–æ–≤–∏—Ç–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—é
- [ ] –†–æ–∑–≥–æ—Ä–Ω—É—Ç–∏ –Ω–∞ production
- [ ] –ú–æ–Ω—ñ—Ç–æ—Ä–∏—Ç–∏ –º–µ—Ç—Ä–∏–∫–∏

---

## üìû –ö–æ–Ω—Ç–∞–∫—Ç–∏

**–ê–Ω–∞–ª—ñ–∑ –ø—Ä–æ–≤–µ–¥–µ–Ω–æ**: MCP Codemap System  
**–î–∞—Ç–∞**: 20 –ª–∏—Å—Ç–æ–ø–∞–¥–∞ 2025  
**–í–µ—Ä—Å—ñ—è –∑–≤—ñ—Ç—É**: 1.0  

---

*–¶–µ–π –∑–≤—ñ—Ç –±—É–≤ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–∏–π –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é MCP Codemap Analysis System*
