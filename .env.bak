# ===================================
# ATLAS v5.0 - Environment Configuration
# ===================================
# Last Updated: 2025-11-03 (Rate Limit Protection + Fallback Models)


# === SYSTEM ===
NODE_ENV=production
BUILD_NUMBER=dev
LOG_LEVEL=info
FORCE_FREE_PORTS=true


# === LLM API CONFIGURATION ===
LLM_API_ENDPOINT=http://localhost:4000/v1/chat/completions
LLM_API_FALLBACK_ENDPOINT=
LLM_API_USE_FALLBACK=true
LLM_API_TIMEOUT=600000  # FIXED 2025-11-08: 10 min (was 1 min) - support slow Ollama models


# === AI BACKEND CONFIGURATION ===
AI_BACKEND_MODE=mcp
AI_BACKEND_PRIMARY=mcp
AI_BACKEND_DISABLE_FALLBACK=false
CASCADE_ENABLED=true


# === AI MODEL CONFIGURATION ===
AI_MODEL_CLASSIFICATION=openai/gpt-4o-mini
AI_TEMP_CLASSIFICATION=0.05
AI_MODEL_CHAT=atlas-gpt-4o-mini
AI_TEMP_CHAT=0.7
AI_MODEL_ANALYSIS=atlas-gpt-4o-mini
AI_TEMP_ANALYSIS=0.2
AI_MODEL_TTS_OPT=atlas-phi-4-mini-instruct
AI_TEMP_TTS_OPT=0.15


# === MCP MODEL CONFIGURATION ===
# UPDATED 2025-11-03: Rate limit protection з Mistral fallbacks

MCP_MODEL_MODE_SELECTION=atlas-gpt-4o-mini
MCP_MODEL_MODE_SELECTION_FALLBACK=openai/gpt-4o-mini
MCP_TEMP_MODE_SELECTION=0.05

MCP_MODEL_BACKEND_SELECTION=atlas-gpt-4o-mini
MCP_MODEL_BACKEND_SELECTION_FALLBACK=openai/gpt-4o-mini
MCP_TEMP_BACKEND_SELECTION=0.05

MCP_MODEL_CONTEXT_ENRICHMENT=atlas-gpt-4o-mini
MCP_MODEL_CONTEXT_ENRICHMENT_FALLBACK=ext-mistral-codestral-2405
MCP_TEMP_CONTEXT_ENRICHMENT=0.3

MCP_MODEL_TODO_PLANNING=atlas-gpt-4o-mini
MCP_MODEL_TODO_PLANNING_FALLBACK=openai/gpt-4o-mini
MCP_TEMP_TODO_PLANNING=0.3

# CRITICAL 2025-11-03: Reasoning stage для pre-planning analysis
MCP_MODEL_REASONING=atlas-gpt-4o-mini
MCP_MODEL_REASONING_FALLBACK=openai/gpt-4o-mini
MCP_TEMP_REASONING=0.2

MCP_MODEL_PLAN_TOOLS=atlas-gpt-4o-mini
MCP_MODEL_PLAN_TOOLS_FALLBACK=openai/gpt-4o-mini
MCP_TEMP_PLAN_TOOLS=0.1

MCP_MODEL_VERIFICATION_ELIGIBILITY=openai/gpt-4o-mini
MCP_MODEL_VERIFICATION_ELIGIBILITY_FALLBACK=openai/gpt-4o-mini
MCP_TEMP_VERIFICATION_ELIGIBILITY=0.1

MCP_MODEL_VERIFY_ITEM=atlas-gpt-4o-mini
MCP_MODEL_VERIFY_ITEM_FALLBACK=ext-mistral-codestral-2405
MCP_TEMP_VERIFY_ITEM=0.15

MCP_MODEL_ADJUST_TODO=atlas-gpt-4o-mini
MCP_MODEL_ADJUST_TODO_FALLBACK=ext-mistral-codestral-2405
MCP_TEMP_ADJUST_TODO=0.2

MCP_MODEL_REPLAN_TODO=atlas-gpt-4o-mini
MCP_MODEL_REPLAN_TODO_FALLBACK=ext-mistral-codestral-2405
MCP_TEMP_REPLAN_TODO=0.3

MCP_MODEL_FINAL_SUMMARY=atlas-gpt-4o-mini
MCP_MODEL_FINAL_SUMMARY_FALLBACK=openai/gpt-4o-mini
MCP_TEMP_FINAL_SUMMARY=0.5

# FIXED 2025-11-08: Atlas моделі потребують GitHub token - використовуємо Ollama
MCP_MODEL_VISION=ext-ollama-llama3.2-vision:latest
MCP_MODEL_VISION_FALLBACK=ext-ollama-llama3.2-vision:latest
MCP_TEMP_VISION=0.2

MCP_MODEL_DEV_ANALYSIS=atlas-gpt-4o-mini
MCP_MODEL_DEV_ANALYSIS_FALLBACK=openai/gpt-4o-mini
MCP_TEMP_DEV_ANALYSIS=0.2

MCP_MODEL_TTS_OPT=atlas-jamba-1.5-mini
MCP_MODEL_TTS_OPT_FALLBACK=atlas-jamba-1.5-mini
MCP_TEMP_TTS_OPT=0.3


# === CHAT MEMORY ===
# FIXED 2025-11-03: Невалідна назва моделі виправлена
MCP_MODEL_CHAT_MEMORY_ELIGIBILITY=atlas-jamba-1.5-mini
MCP_MODEL_CHAT_MEMORY_ELIGIBILITY_FALLBACK=atlas-jamba-1.5-mini
MCP_TEMP_CHAT_MEMORY_ELIGIBILITY=0.1


# Intent Detection (NEW 2025-11-03)
INTENT_DETECTION_MODEL=atlas-jamba-1.5-mini
INTENT_DETECTION_MODEL_FALLBACK=atlas-jamba-1.5-mini
INTENT_DETECTION_TEMPERATURE=0.1
INTENT_DETECTION_MAX_TOKENS=150


# === MCP LLM VALIDATOR ===
MCP_LLM_MODEL=ext-mistral-codestral-2405
MCP_LLM_MODEL_FALLBACK=atlas-mistral-medium-2505
MCP_LLM_TEMPERATURE=0.1


# === SECURITY ===
SECURITY_LLM_VALIDATOR_ENABLED=true
SECURITY_VALIDATOR_FALLBACK=allow
SECURITY_REPETITION_CHECK_ENABLED=true
SECURITY_MAX_CONSECUTIVE_REPETITIONS=3
SECURITY_MAX_TOTAL_CALLS=10
SECURITY_AUTO_BLOCK_CRITICAL=true
SECURITY_AUTO_BLOCK_HIGH=true


# === AUTO-CORRECTION ===
AUTO_CORRECTION_ENABLED=true
AUTO_CORRECTION_INTERVAL=300000
AUTO_CORRECTION_MAX_FIXES=5
AUTO_CORRECTION_NOTIFY=subtle
MCP_PYTHON_SDK_ENABLED=true
MCP_JAVA_SDK_ENABLED=true


# === MCP RETRY ===
MCP_MAX_ATTEMPTS=3
MCP_CIRCUIT_BREAKER_THRESHOLD=3
MCP_CIRCUIT_BREAKER_RESET_MS=60000
MCP_TIMEOUT_MS=30000
MCP_EXPONENTIAL_BACKOFF=true


# === TTS & VOICE ===
REAL_TTS_MODE=true
TTS_DEVICE=mps
TTS_PORT=3001
ATLAS_TTS_MAX_CHUNK_SIZE=400


# === WHISPER ===
WHISPER_BACKEND=cpp
WHISPER_DEVICE=metal
WHISPER_PORT=3002
WHISPER_CPP_BIN=/Users/dev/Documents/GitHub/atlas4/third_party/whisper.cpp.upstream/build/bin/whisper-cli
WHISPER_CPP_MODEL=/Users/dev/Documents/GitHub/atlas4/models/whisper/ggml-large-v3.bin
WHISPER_CPP_NGL=20
WHISPER_CPP_THREADS=10
WHISPER_SAMPLE_RATE=48000


# === NETWORK PORTS ===
ORCHESTRATOR_PORT=5101
WEB_PORT=5001
FRONTEND_PORT=5001


# === LOCALIZATION ===
USER_LANGUAGE=uk
SHOW_SYSTEM_MESSAGES=false
SYSTEM_MESSAGE_LEVEL=1


# ===================================
# CASCADE (CODE ANALYSIS) INTEGRATION
# ===================================

# NEXUS 2025-11-05: Вимкнено Cascade для прямого використання localhost:4000
CASCADE_ENABLED=false

# NEXUS 2025-11-08: Виключення Ollama моделей з модуля самовдосконалення
# При true - Ollama моделі (ollama/*) не будуть використовуватись для self-improvement
# але працюватимуть для звичайних завдань (TASK/CHAT mode)
NEXUS_EXCLUDE_OLLAMA=true

CASCADE_API_ENDPOINT=http://localhost:5101/api/cascade/self-analysis
CASCADE_ETERNITY_ENDPOINT=http://localhost:5101/api/eternity
CASCADE_API_TIMEOUT=120000
CASCADE_ETERNITY_TIMEOUT=180000

CASCADE_SELF_ANALYSIS_ENABLED=false
CASCADE_ETERNITY_ENABLED=false
CASCADE_SELF_IMPROVEMENT_ENABLED=false
CASCADE_CODESTRAL_ENABLED=true

CASCADE_SELF_MODIFICATION_ENABLED=true
CASCADE_REQUIRE_APPROVAL=false
CASCADE_WRITE_CODE=true
CASCADE_WRITE_CONFIG=true
CASCADE_EXECUTE_MODIFICATIONS=true

CASCADE_CODESTRAL_MODEL=ext-mistral-codestral-2405
CASCADE_CODESTRAL_TEMP=0.2
CASCADE_CODESTRAL_MAX_TOKENS=4000

CASCADE_MAX_FILES_PER_CHANGE=5
CASCADE_REQUIRE_BACKUP=true
CASCADE_VALIDATE_BEFORE_APPLY=true

CASCADE_AUDIT_ENABLED=true
CASCADE_REPORT_TO_OLEG=true
CASCADE_NOTIFY_SUCCESS=true

CASCADE_AUTONOMOUS_MODE=true
CASCADE_OPERATION_MODE=continuous


# ===================================
# WINDSURF IDE INTEGRATION (MCP)
# ===================================
# NEXUS 2025-11-05: Тимчасово вимкнено через 500 помилки, використовуємо localhost:4000
WINDSURF_CODE_EDITOR_ENABLED=false

CASCADE_PRIMARY_MODEL=ext-mistral-codestral-2405
CASCADE_FALLBACK_MODEL=ext-mistral-codestral-2405
CASCADE_CODE_ANALYSIS_MODEL=ext-mistral-codestral-2405


# === FEATURES ===
USE_METAL_GPU=true
OPTIMIZE_FOR_M1_MAX=true


# ===================================
# WINDSURF API
# ===================================
WINDSURF_API_KEY=sk-ws-01-rFDnsZFp9w4c2SidKLwAiC87WydkFWo3Jln3vH9ceNhZy3P6sJ7TSFHMXacmOt6xmhMK6ZtSydW5sR9_jGSmV1hA67XLlA
WINDSURF_API_ENDPOINT=https://api.windsurf.ai/v1
