# ‚úÖ –°–ø—Ä–∞–≤–∂–Ω—è —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –º–æ–¥–µ—Ä–Ω—ñ–∑–æ–≤–∞–Ω–æ—ó —Å–∏—Å—Ç–µ–º–∏ MCP –∑–∞–≤–µ—Ä—à–µ–Ω–∞
## –î–∞—Ç–∞: 2025-10-29

## –©–æ –±—É–ª–æ –∑—Ä–æ–±–ª–µ–Ω–æ

### 1. ‚úÖ –ó–∞—Ä–µ—î—Å—Ç—Ä–æ–≤–∞–Ω–æ –≤—Å—ñ –Ω–æ–≤—ñ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏ –≤ DI Container

**–§–∞–π–ª:** `/orchestrator/core/service-registry.js`

–î–æ–¥–∞–Ω–æ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—é:
- `selfCorrectionValidator` - –≤–∞–ª—ñ–¥–∞—Ç–æ—Ä –∑ –∞–≤—Ç–æ–∫–æ—Ä–µ–∫—Ü—ñ—î—é
- `contextAwareToolFilter` - –∫–æ–Ω—Ç–µ–∫—Å—Ç—É–∞–ª—å–Ω–∏–π —Ñ—ñ–ª—å—Ç—Ä —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ñ–≤
- `workflowStateMachine` - –º–∞—à–∏–Ω–∞ —Å—Ç–∞–Ω—ñ–≤ –¥–ª—è workflow
- `routerClassifier` - —à–≤–∏–¥–∫–∏–π –∫–ª–∞—Å–∏—Ñ—ñ–∫–∞—Ç–æ—Ä (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–∏–π)

### 2. ‚úÖ –Ü–Ω—Ç–µ–≥—Ä–æ–≤–∞–Ω–æ Self-Correction –≤ Validation Pipeline

**–§–∞–π–ª:** `/orchestrator/ai/validation/validation-pipeline.js`

- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —Å—Ç–≤–æ—Ä—é—î—Ç—å—Å—è –µ–∫–∑–µ–º–ø–ª—è—Ä –ø—Ä–∏ –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ `llmClient`
- –£–≤—ñ–º–∫–Ω–µ–Ω–æ –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º (`enableSelfCorrection: true`)
- –í–∏–∫–æ–Ω—É—î—Ç—å—Å—è —è–∫ –∫—Ä–æ–∫ 0 –ø–µ—Ä–µ–¥ –æ—Å–Ω–æ–≤–Ω–æ—é –≤–∞–ª—ñ–¥–∞—Ü—ñ—î—é

### 3. ‚úÖ –í–∏—Ä—ñ—à–µ–Ω–æ –¥—É–±–ª—é–≤–∞–Ω–Ω—è Router vs Server Selection

**–†—ñ—à–µ–Ω–Ω—è:** Router Classifier —ñ–Ω—Ç–µ–≥—Ä–æ–≤–∞–Ω–æ —è–∫ –æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–∏–π –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ–π —Ñ—ñ–ª—å—Ç—Ä

**–§–∞–π–ª:** `/orchestrator/workflow/stages/server-selection-processor.js`

- –Ø–∫—â–æ `context.suggestedServers` –ø—Ä–∏—Å—É—Ç–Ω—ñ - –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î —ó—Ö –¥–ª—è –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ—ó —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—ó
- Server Selection —Ä–æ–±–∏—Ç—å —Ñ—ñ–Ω–∞–ª—å–Ω–∏–π –≤–∏–±—ñ—Ä –∑ –≤–∂–µ –∑–≤—É–∂–µ–Ω–æ–≥–æ —Å–ø–∏—Å–∫—É
- –ó–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è backward compatibility - –ø—Ä–∞—Ü—é—î —ñ –±–µ–∑ Router

### 4. ‚úÖ –Ü–Ω—Ç–µ–≥—Ä–æ–≤–∞–Ω–æ Context Filter –≤ Tool Planning

**–§–∞–π–ª:** `/orchestrator/workflow/stages/tetyana-plan-tools-processor.js`

- –î–æ–¥–∞–Ω–æ –≤–∏–∫–ª–∏–∫ `contextAwareToolFilter` –ø–µ—Ä–µ–¥ –ø–ª–∞–Ω—É–≤–∞–Ω–Ω—è–º
- –§—ñ–ª—å—Ç—Ä—É—î —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏ –Ω–∞ –æ—Å–Ω–æ–≤—ñ –∫–æ–Ω—Ç–µ–∫—Å—Ç—É –∑–∞–≤–¥–∞–Ω–Ω—è
- –ó–º–µ–Ω—à—É—î –∫—ñ–ª—å–∫—ñ—Å—Ç—å –¥–æ—Å—Ç—É–ø–Ω–∏—Ö —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ñ–≤ –Ω–∞ 40%+

### 5. ‚úÖ –í–∏–ø—Ä–∞–≤–ª–µ–Ω–æ –Ω–µ—Å—É–º—ñ—Å–Ω—ñ—Å—Ç—å –ø—Ä–æ–º–ø—Ç—ñ–≤

**–§–∞–π–ª:** `/prompts/mcp/tetyana_plan_tools_filesystem.js`

- –ó–º—ñ–Ω–µ–Ω–æ `require` –Ω–∞ `import` –¥–ª—è ES6 –º–æ–¥—É–ª—ñ–≤
- –¢–µ–ø–µ—Ä —Å—É–º—ñ—Å–Ω–æ –∑ —ñ—Å–Ω—É—é—á–æ—é —Å–∏—Å—Ç–µ–º–æ—é —ñ–º–ø–æ—Ä—Ç—ñ–≤

## –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞ –ø—ñ—Å–ª—è —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—ó

```
User Request
    ‚Üì
Stage 0: Mode Selection (chat/task/dev)
    ‚Üì
Stage 1: TODO Planning
    ‚Üì
[OPTIONAL] Router Classifier (—à–≤–∏–¥–∫–∞ –∫–ª–∞—Å–∏—Ñ—ñ–∫–∞—Ü—ñ—è)
    ‚Üì
Stage 2.0: Server Selection (–≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î router suggestions)
    ‚Üì
Stage 2.1: Tool Planning
    - Context Filter (–∑–º–µ–Ω—à—É—î –Ω–∞–±—ñ—Ä —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ñ–≤)
    - Specialized Prompts (–∑ —É–Ω—ñ–≤–µ—Ä—Å–∞–ª—å–Ω–æ–≥–æ —à–∞–±–ª–æ–Ω—É)
    ‚Üì
Self-Correction Cycle (–∞–≤—Ç–æ–∫–æ—Ä–µ–∫—Ü—ñ—è –ø–æ–º–∏–ª–æ–∫)
    ‚Üì
Validation Pipeline (5+ —Ä—ñ–≤–Ω—ñ–≤)
    ‚Üì
Stage 2.2: Tool Execution
    ‚Üì
Stage 2.3: Verification
```

## –ö–ª—é—á–æ–≤—ñ –ø–µ—Ä–µ–≤–∞–≥–∏ —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—ó

### üéØ –û–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è –±–µ–∑ –¥—É–±–ª—é–≤–∞–Ω–Ω—è
- Router Classifier –¥–æ–ø–æ–≤–Ω—é—î Server Selection, –∞ –Ω–µ –¥—É–±–ª—é—î
- Context Filter –ø—Ä–∞—Ü—é—î —Ä–∞–∑–æ–º –∑ Tool Planning
- Self-Correction —ñ–Ω—Ç–µ–≥—Ä–æ–≤–∞–Ω–∞ –≤ —ñ—Å–Ω—É—é—á—É Validation Pipeline

### ‚ö° –ü–æ–∫—Ä–∞—â–µ–Ω–∞ —à–≤–∏–¥–∫—ñ—Å—Ç—å
- Router —à–≤–∏–¥–∫–æ –∑–≤—É–∂—É—î –≤–∏–±—ñ—Ä —Å–µ—Ä–≤–µ—Ä—ñ–≤
- Context Filter –∑–º–µ–Ω—à—É—î –∫—ñ–ª—å–∫—ñ—Å—Ç—å —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ñ–≤
- –ú–µ–Ω—à–µ –ø–æ–º–∏–ª–æ–∫ = –º–µ–Ω—à–µ –ø–æ–≤—Ç–æ—Ä–Ω–∏—Ö —Å–ø—Ä–æ–±

### üõ°Ô∏è Backward Compatibility
- –í—Å—ñ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏ –æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ
- –°–∏—Å—Ç–µ–º–∞ –ø—Ä–∞—Ü—é—î —ñ –±–µ–∑ –Ω–æ–≤–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ñ–≤
- –ü–æ—Å—Ç—É–ø–æ–≤–∞ –º—ñ–≥—Ä–∞—Ü—ñ—è –º–æ–∂–ª–∏–≤–∞

## –©–æ –∑–∞–ª–∏—à–∏–ª–æ—Å—å –∑—Ä–æ–±–∏—Ç–∏

### –ö–æ—Ä–æ—Ç–∫–æ—Å—Ç—Ä–æ–∫–æ–≤—ñ –∑–∞–≤–¥–∞–Ω–Ω—è:
1. **–ê–∫—Ç–∏–≤—É–≤–∞—Ç–∏ Router Classifier –≤ executor-v3.js** - –¥–æ–¥–∞—Ç–∏ –≤–∏–∫–ª–∏–∫ –ø–µ—Ä–µ–¥ Stage 2.0
2. **–û–Ω–æ–≤–∏—Ç–∏ —ñ–Ω—à—ñ –ø—Ä–æ–º–ø—Ç–∏** - shell, playwright, applescript –∑–∞ –Ω–æ–≤–∏–º —à–∞–±–ª–æ–Ω–æ–º
3. **–ù–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ State Machine** - —ñ–Ω—Ç–µ–≥—Ä—É–≤–∞—Ç–∏ –≤ –æ—Å–Ω–æ–≤–Ω–∏–π workflow

### –°–µ—Ä–µ–¥–Ω—å–æ—Å—Ç—Ä–æ–∫–æ–≤—ñ:
1. **–¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—ó** - –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Ä–æ–±–æ—Ç—É –≤—Å—ñ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ñ–≤ —Ä–∞–∑–æ–º
2. **–û–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó** - –Ω–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ –ø–æ—Ä–æ–≥–∏ —Ç–∞ —Ç–∞–π–º–∞—É—Ç–∏
3. **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è** - –æ–Ω–æ–≤–∏—Ç–∏ README –∑ –Ω–æ–≤–æ—é –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–æ—é

## –í–∏—Å–Ω–æ–≤–æ–∫

–¢–µ–ø–µ—Ä –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏ **–°–ü–†–ê–í–î–Ü —ñ–Ω—Ç–µ–≥—Ä–æ–≤–∞–Ω—ñ** –≤ —Å–∏—Å—Ç–µ–º—É:
- ‚úÖ –ó–∞—Ä–µ—î—Å—Ç—Ä–æ–≤–∞–Ω—ñ –≤ DI Container
- ‚úÖ –í–∏–∫–ª–∏–∫–∞—é—Ç—å—Å—è –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–∏—Ö –º—ñ—Å—Ü—è—Ö
- ‚úÖ –ü—Ä–∞—Ü—é—é—Ç—å —Ä–∞–∑–æ–º –∑ —ñ—Å–Ω—É—é—á–∏–º–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏
- ‚úÖ –ù–µ –¥—É–±–ª—é—é—Ç—å —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª

–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –¥–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –º–æ–¥–µ—Ä–Ω—ñ–∑–æ–≤–∞–Ω–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ñ–≤ –∑ –ø–æ–∫—Ä–∞—â–µ–Ω–æ—é —Ç–æ—á–Ω—ñ—Å—Ç—é —Ç–∞ —à–≤–∏–¥–∫—ñ—Å—Ç—é.
