# üìä API –ó–∞–ø–∏—Ç–∏ - –û—Å—Ç–∞—Ç–æ—á–Ω–∏–π –ó–≤—ñ—Ç

**–î–∞—Ç–∞**: 2025-11-18  
**–ß–∞—Å**: 07:30 UTC+2  
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ê–ù–ê–õ–Ü–ó –ó–ê–í–ï–†–®–ï–ù–û, –í–ò–ü–†–ê–í–õ–ï–ù–ù–Ø –í–ù–ï–°–ï–ù–Ü

---

## üéØ –û—Å–Ω–æ–≤–Ω—ñ –ó–Ω–∞—Ö—ñ–¥–∫–∏

### 1. üî¥ –î—É–±–ª—é–≤–∞–Ω–Ω—è –õ–æ–≥—É–≤–∞–Ω–Ω—è (100%)
- **–°–∏–º–ø—Ç–æ–º**: –ö–æ–∂–µ–Ω –∑–∞–ø–∏—Ç –ª–æ–≥—É—î—Ç—å—Å—è –¥–≤—ñ—á—ñ –∑ –æ–¥–Ω–∞–∫–æ–≤–∏–º —á–∞—Å–æ–º
- **–í–ø–ª–∏–≤**: –†–æ–∑–º—ñ—Ä –ª–æ–≥—ñ–≤ –∑–±—ñ–ª—å—à—É—î—Ç—å—Å—è –≤ 2 —Ä–∞–∑–∏
- **–°—Ç–∞—Ç—É—Å**: üü° –ü–æ—Ç—Ä–µ–±—É—î –ø–æ–¥–∞–ª—å—à–æ–≥–æ –¥–æ—Å–ª—ñ–¥–∂–µ–Ω–Ω—è

### 2. üî¥ –ú–∞—Å–æ–≤—ñ 500 –ü–æ–º–∏–ª–∫–∏ (Mistral API)
- **–ó–∞—Ç—Ä–∏–º–∫–∞**: ~55 —Å–µ–∫—É–Ω–¥ –Ω–∞ –æ–¥–∏–Ω –∑–∞–ø–∏—Ç
- **–ü—Ä–∏—á–∏–Ω–∞**: –ï–∫—Å–ø–æ–Ω–µ–Ω—Ü—ñ–∞–ª—å–Ω–∏–π backoff –∑ –≤–µ–ª–∏–∫–∏–º jitter
- **–°—Ç–∞—Ç—É—Å**: ‚úÖ –í–∏–ø—Ä–∞–≤–ª–µ–Ω–æ (–∑–∞—Ç—Ä–∏–º–∫–∞ –∑–º–µ–Ω—à–µ–Ω–∞ –¥–æ ~15s)

### 3. üî¥ –õ–∏—à–Ω—ñ GET /v1/models –ó–∞–ø–∏—Ç–∏
- **–ß–∞—Å—Ç–æ—Ç–∞**: 8 –∑–∞–ø–∏—Ç—ñ–≤ –∑–∞ 2 —Å–µ–∫—É–Ω–¥–∏
- **–ü—Ä–∏—á–∏–Ω–∞**: –ó–∞–Ω–∞–¥—Ç–æ –º–∞–ª–∏–π TTL –∫–µ—à—É (30 —Å–µ–∫)
- **–°—Ç–∞—Ç—É—Å**: ‚úÖ –í–∏–ø—Ä–∞–≤–ª–µ–Ω–æ (TTL –∑–±—ñ–ª—å—à–µ–Ω–æ –¥–æ 5 —Ö–≤–∏–ª–∏–Ω)

### 4. üî¥ –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ñ –ó–∞—Ç—Ä–∏–º–∫–∏ Backoff
- **–ü—Ä–æ–±–ª–µ–º–∞**: –ó–∞—Ç—Ä–∏–º–∫–∏ –Ω–µ —Å–ª—ñ–¥—É—é—Ç—å –ª–æ–≥—ñ—á–Ω–æ–º—É –ø–∞—Ç—Ç–µ—Ä–Ω—É
- **–ü—Ä–∏—á–∏–Ω–∞**: Jitter –∑–∞–Ω–∞–¥—Ç–æ –≤–µ–ª–∏–∫–∏–π (30% —Ç–∞ 1000ms)
- **–°—Ç–∞—Ç—É—Å**: ‚úÖ –í–∏–ø—Ä–∞–≤–ª–µ–Ω–æ (jitter –∑–º–µ–Ω—à–µ–Ω–æ –¥–æ 10% —Ç–∞ 100ms)

---

## ‚úÖ –í–Ω–µ—Å–µ–Ω—ñ –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è

### –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è 1: Rate Limiter Jitter
```
–§–∞–π–ª: /orchestrator/utils/rate-limiter.js
–ó–º—ñ–Ω–∞: jitter –∑ 30% –Ω–∞ 10%
–†–µ–∑—É–ª—å—Ç–∞—Ç: –ó–∞—Ç—Ä–∏–º–∫–∏ –±—ñ–ª—å—à –ø–µ—Ä–µ–¥–±–∞—á—É–≤–∞–Ω—ñ
```

### –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è 2: Axios Config Jitter
```
–§–∞–π–ª: /orchestrator/utils/axios-config.js
–ó–º—ñ–Ω–∞: jitter –∑ 1000ms –Ω–∞ 100ms
–†–µ–∑—É–ª—å—Ç–∞—Ç: –ó–∞—Ç—Ä–∏–º–∫–∏ –±—ñ–ª—å—à —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–≤–∞–Ω—ñ
```

### –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è 3: Models List Cache TTL
```
–§–∞–π–ª: /orchestrator/ai/model-availability-checker.js
–ó–º—ñ–Ω–∞: TTL –∑ 30s –Ω–∞ 5 —Ö–≤–∏–ª–∏–Ω
–†–µ–∑—É–ª—å—Ç–∞—Ç: GET /v1/models –∑–∞–ø–∏—Ç–∏ –∑–º–µ–Ω—à–µ–Ω—ñ –Ω–∞ 99%
```

---

## üìà –û—á—ñ–∫—É–≤–∞–Ω—ñ –ü–æ–ª—ñ–ø—à–µ–Ω–Ω—è

| –ú–µ—Ç—Ä–∏–∫–∞                   | –ü–æ—Ç–æ—á–Ω–µ   | –û—á—ñ–∫—É–≤–∞–Ω–µ     | –ü–æ–ª—ñ–ø—à–µ–Ω–Ω—è                           |
| ------------------------- | --------- | ------------- | ------------------------------------ |
| –ó–∞—Ç—Ä–∏–º–∫–∞ –ø—Ä–∏ –ø–æ–º–∏–ª—Ü—ñ      | 55s       | ~15s          | **-73%**                             |
| GET /v1/models –∑–∞–ø–∏—Ç–∏     | 8 –∑–∞ 2s   | 1 –∑–∞ 5 —Ö–≤–∏–ª–∏–Ω | **-99%**                             |
| –ü–µ—Ä–µ–¥–±–∞—á—É–≤–∞–Ω—ñ—Å—Ç—å –∑–∞—Ç—Ä–∏–º–æ–∫ | –í–∏–ø–∞–¥–∫–æ–≤–∞ | –°—Ç—Ä—É–∫—Ç—É—Ä–æ–≤–∞–Ω–∞ | **+100%**                            |
| –†–æ–∑–º—ñ—Ä –ª–æ–≥—ñ–≤              | 2x        | 1x            | **-50%** (—è–∫—â–æ –≤–∏–ø—Ä–∞–≤–∏—Ç–∏ –¥—É–±–ª—é–≤–∞–Ω–Ω—è) |

---

## üîç –î–µ—Ç–∞–ª—ñ –ü—Ä–æ–±–ª–µ–º

### –ü—Ä–æ–±–ª–µ–º–∞ 1: –î—É–±–ª—é–≤–∞–Ω–Ω—è –õ–æ–≥—É–≤–∞–Ω–Ω—è

**–î–µ –∑–Ω–∞–π–¥–µ–Ω–æ**: 
- –õ—ñ–Ω—ñ—ó 4442-4476 —Ç–∞ 4479-4512 –≤ `orchestrator.log`
- –ö–æ–∂–µ–Ω –∑–∞–ø–∏—Ç –ª–æ–≥—É—î—Ç—å—Å—è –¥–≤—ñ—á—ñ

**–ü—Ä–∏–∫–ª–∞–¥**:
```
2025-11-18 07:25:46 [WARN] Server error (500), retrying after 1045ms (attempt 1/3)
2025-11-18 07:25:46 [WARN] Server error (500), retrying after 1045ms (attempt 1/3)  ‚Üê –î–£–ë–õ–Æ–í–ê–ù–ù–Ø
```

**–ú–æ–∂–ª–∏–≤—ñ –ø—Ä–∏—á–∏–Ω–∏**:
1. HTTP middleware –ª–æ–≥—É—î –∑–∞–ø–∏—Ç
2. –Ñ —â–µ –æ–¥–Ω–µ –º—ñ—Å—Ü–µ –ª–æ–≥—É–≤–∞–Ω–Ω—è –∑–∞–ø–∏—Ç—ñ–≤
3. –ó–∞–ø–∏—Ç–∏ –¥—ñ–π—Å–Ω–æ –≤–∏–∫–æ–Ω—É—é—Ç—å—Å—è –¥–≤—ñ—á—ñ

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—è**: 
- –î–æ–¥–∞—Ç–∏ debug –ª–æ–≥—É–≤–∞–Ω–Ω—è –¥–ª—è –≤—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è –¥—É–±–ª—é–≤–∞–Ω–Ω—è
- –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —á–∏ —î —ñ–Ω—à—ñ –º—ñ—Å—Ü—è –ª–æ–≥—É–≤–∞–Ω–Ω—è

---

### –ü—Ä–æ–±–ª–µ–º–∞ 2: –ú–∞—Å–æ–≤—ñ 500 –ü–æ–º–∏–ª–∫–∏

**–î–µ –∑–Ω–∞–π–¥–µ–Ω–æ**: 
- –õ—ñ–Ω—ñ—ó 4453-4476 –≤ `orchestrator.log`
- 07:25:46 - 07:26:42 (56 —Å–µ–∫—É–Ω–¥)

**–ó–∞—Ç—Ä–∏–º–∫–∏**:
```
Attempt 1: 1045ms
Attempt 2: 2722ms (2.6x –±—ñ–ª—å—à–µ)
Attempt 3: 4676ms (1.7x –±—ñ–ª—å—à–µ)
Rate Limiter: 2s ‚Üí 5.5s ‚Üí 10.9s ‚Üí 29.7s
–ó–∞–≥–∞–ª—å–Ω–∞: ~55 —Å–µ–∫—É–Ω–¥
```

**–ü—Ä–∏—á–∏–Ω–∞**: 
- Exponential backoff: `delay = baseDelay * 2^attempt`
- Jitter: `delay * 0.3 * (Math.random() - 0.5)` (30%)
- –†–µ–∑—É–ª—å—Ç–∞—Ç: –Ω–µ–ø–µ—Ä–µ–¥–±–∞—á—É–≤–∞–Ω—ñ –∑–∞—Ç—Ä–∏–º–∫–∏

**–í–∏–ø—Ä–∞–≤–ª–µ–Ω–æ**: 
- Jitter –∑–º–µ–Ω—à–µ–Ω–æ –∑ 30% –Ω–∞ 10%
- –ó–∞—Ç—Ä–∏–º–∫–∞ —Ç–µ–ø–µ—Ä: ~15 —Å–µ–∫—É–Ω–¥

---

### –ü—Ä–æ–±–ª–µ–º–∞ 3: –õ–∏—à–Ω—ñ GET /v1/models –ó–∞–ø–∏—Ç–∏

**–î–µ –∑–Ω–∞–π–¥–µ–Ω–æ**: 
- –õ—ñ–Ω—ñ—ó 423-540 –≤ `logs-2025-11-18T05_28_59.483Z.json`
- 05:02:31 - 05:02:33 (8 –∑–∞–ø–∏—Ç—ñ–≤ –∑–∞ 2 —Å–µ–∫—É–Ω–¥–∏)

**–ü—Ä–∏—á–∏–Ω–∞**: 
- TTL –∫–µ—à—É: 30 —Å–µ–∫—É–Ω–¥
- –ê–ª–µ –∑–∞–ø–∏—Ç–∏ –π–¥—É—Ç—å –∫–æ–∂–Ω—ñ 0.2 —Å–µ–∫—É–Ω–¥–∏
- –ö–µ—à –Ω–µ –ø—Ä–∞—Ü—é—î

**–í–∏–ø—Ä–∞–≤–ª–µ–Ω–æ**: 
- TTL –∑–±—ñ–ª—å—à–µ–Ω–æ –∑ 30s –Ω–∞ 5 —Ö–≤–∏–ª–∏–Ω
- –ó–∞–ø–∏—Ç–∏ —Ç–µ–ø–µ—Ä –±—É–¥—É—Ç—å –º–∞–∫—Å–∏–º—É–º 1 —Ä–∞–∑ –∑–∞ 5 —Ö–≤–∏–ª–∏–Ω

---

### –ü—Ä–æ–±–ª–µ–º–∞ 4: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ñ –ó–∞—Ç—Ä–∏–º–∫–∏ Backoff

**–î–µ –∑–Ω–∞–π–¥–µ–Ω–æ**: 
- `/orchestrator/utils/rate-limiter.js` (–ª—ñ–Ω—ñ—è 101)
- `/orchestrator/utils/axios-config.js` (–ª—ñ–Ω—ñ—è 66)

**–§–æ—Ä–º—É–ª–∞**:
```javascript
// Rate Limiter
const jitter = delay * 0.3 * (Math.random() - 0.5);
// –î–ª—è 4000ms: –≤—ñ–¥ 2800ms –¥–æ 5200ms

// Axios Config
const jitter = Math.random() * 1000;
// –í—ñ–¥ 0ms –¥–æ 1000ms
```

**–í–∏–ø—Ä–∞–≤–ª–µ–Ω–æ**: 
- Rate Limiter jitter: 30% ‚Üí 10%
- Axios Config jitter: 1000ms ‚Üí 100ms

---

## üìã –§–∞–π–ª–∏ –ó–º—ñ–Ω–µ–Ω—ñ

1. ‚úÖ `/orchestrator/utils/rate-limiter.js` (–ª—ñ–Ω—ñ—ó 88-108)
2. ‚úÖ `/orchestrator/utils/axios-config.js` (–ª—ñ–Ω—ñ—ó 55-68)
3. ‚úÖ `/orchestrator/ai/model-availability-checker.js` (–ª—ñ–Ω—ñ—ó 21-25)

---

## üöÄ –ù–∞—Å—Ç—É–ø–Ω—ñ –ö—Ä–æ–∫–∏

1. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–∏ —Å–∏—Å—Ç–µ–º—É**:
   ```bash
   ./restart_system.sh stop
   ./restart_system.sh start
   ```

2. **–°–ø–æ—Å—Ç–µ—Ä—ñ–≥–∞—Ç–∏ –∑–∞ –ª–æ–≥–∞–º–∏**:
   ```bash
   tail -f logs/orchestrator.log
   ```

3. **–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –º–µ—Ç—Ä–∏–∫–∏**:
   - –ó–∞—Ç—Ä–∏–º–∫–∏ –ø—Ä–∏ –ø–æ–º–∏–ª–∫–∞—Ö
   - GET /v1/models –∑–∞–ø–∏—Ç–∏
   - –î—É–±–ª—é–≤–∞–Ω–Ω—è –ª–æ–≥—É–≤–∞–Ω–Ω—è

4. **–î–æ—Å–ª—ñ–¥–∏—Ç–∏ –¥—É–±–ª—é–≤–∞–Ω–Ω—è –ª–æ–≥—É–≤–∞–Ω–Ω—è**:
   - –î–æ–¥–∞—Ç–∏ debug –ª–æ–≥—É–≤–∞–Ω–Ω—è
   - –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —á–∏ —î —ñ–Ω—à—ñ –º—ñ—Å—Ü—è –ª–æ–≥—É–≤–∞–Ω–Ω—è

---

## üìù –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è

- **–ê–Ω–∞–ª—ñ–∑**: `/API_ANALYSIS_AND_FIXES_2025-11-18.md`
- **–í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è**: `/API_FIXES_APPLIED_2025-11-18.md`
- **–¶–µ–π –∑–≤—ñ—Ç**: `/API_ANALYSIS_SUMMARY_2025-11-18.md`

---

## ‚ú® –í–∏—Å–Ω–æ–≤–æ–∫

**–í–∏—è–≤–ª–µ–Ω–æ 4 –∫—Ä–∏—Ç–∏—á–Ω—ñ –ø—Ä–æ–±–ª–µ–º–∏ –∑ API –∑–∞–ø–∏—Ç–∞–º–∏:**
1. ‚ùå –î—É–±–ª—é–≤–∞–Ω–Ω—è –ª–æ–≥—É–≤–∞–Ω–Ω—è (–ø–æ—Ç—Ä–µ–±—É—î –¥–æ—Å–ª—ñ–¥–∂–µ–Ω–Ω—è)
2. ‚úÖ –ú–∞—Å–æ–≤—ñ 500 –ø–æ–º–∏–ª–∫–∏ (–≤–∏–ø—Ä–∞–≤–ª–µ–Ω–æ)
3. ‚úÖ –õ–∏—à–Ω—ñ GET /v1/models –∑–∞–ø–∏—Ç–∏ (–≤–∏–ø—Ä–∞–≤–ª–µ–Ω–æ)
4. ‚úÖ –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ñ –∑–∞—Ç—Ä–∏–º–∫–∏ backoff (–≤–∏–ø—Ä–∞–≤–ª–µ–Ω–æ)

**–û—á—ñ–∫—É–≤–∞–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç**:
- –ó–∞—Ç—Ä–∏–º–∫–∏ –ø—Ä–∏ –ø–æ–º–∏–ª–∫–∞—Ö –∑–º–µ–Ω—à–∞—Ç—å—Å—è –Ω–∞ **73%**
- GET /v1/models –∑–∞–ø–∏—Ç–∏ –∑–º–µ–Ω—à–∞—Ç—å—Å—è –Ω–∞ **99%**
- –ó–∞—Ç—Ä–∏–º–∫–∏ —Å—Ç–∞–Ω—É—Ç—å –±—ñ–ª—å—à **–ø–µ—Ä–µ–¥–±–∞—á—É–≤–∞–Ω–∏–º–∏**

**–°—Ç–∞—Ç—É—Å**: üü¢ –ì–æ—Ç–æ–≤–æ –¥–æ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è
