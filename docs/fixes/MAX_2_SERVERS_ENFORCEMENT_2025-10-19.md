# Enforcement: –ú–∞–∫—Å–∏–º—É–º 2 MCP —Å–µ—Ä–≤–µ—Ä–∏ –Ω–∞ TODO item
**–î–∞—Ç–∞:** 2025-10-19  
**–í–µ—Ä—Å—ñ—è:** 5.2.0  
**–¢–∏–ø:** Architecture Enforcement

## üéØ –ú–µ—Ç–∞
–ì–∞—Ä–∞–Ω—Ç—É–≤–∞—Ç–∏ —â–æ –∫–æ–∂–µ–Ω TODO item –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î –º–∞–∫—Å–∏–º—É–º 2 MCP —Å–µ—Ä–≤–µ—Ä–∏, —â–æ–± –∑–∞–≤–∂–¥–∏ –∑–∞—Å—Ç–æ—Å–æ–≤—É–≤–∞–ª–∏—Å—å —Å–ø–µ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω—ñ –ø—Ä–æ–º–ø—Ç–∏ –∑–∞–º—ñ—Å—Ç—å –∑–∞–≥–∞–ª—å–Ω–æ–≥–æ.

---

## üìä –°—Ç—Ä–∞—Ç–µ–≥—ñ—è: 3-—Ä—ñ–≤–Ω–µ–≤–∏–π –∑–∞—Ö–∏—Å—Ç

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Level 1: Atlas TODO Planning (Stage 1)                     ‚îÇ
‚îÇ –ü—Ä–∞–≤–∏–ª–æ: –°—Ç–≤–æ—Ä—é–π items –∑ max 2 —Å–µ—Ä–≤–µ—Ä–∞–º–∏                   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                          ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Level 2: Server Selection (Stage 2.0)                      ‚îÇ
‚îÇ –í–∞–ª—ñ–¥–∞—Ü—ñ—è: –Ø–∫—â–æ >2 ‚Üí trigger needs_split                   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                          ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Level 3: Tetyana Plan Tools (Stage 2.1)                    ‚îÇ
‚îÇ Safety: –ó–∞–≥–∞–ª—å–Ω–∏–π –ø—Ä–æ–º–ø—Ç —è–∫ ultima ratio + WARNING         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## ‚úÖ –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è

### Level 1: Atlas TODO Planning

**–§–∞–π–ª:** `prompts/mcp/atlas_todo_planning_optimized.js`

**–î–æ–¥–∞–Ω–æ:**
```javascript
üéØ **–ö–†–ò–¢–ò–ß–ù–û - –ü–†–û–°–¢–Ü ITEMS:**
- –°—Ç–≤–æ—Ä—é–π –°–¢–Ü–õ–¨–ö–ò –ø—É–Ω–∫—Ç—ñ–≤, –°–ö–Ü–õ–¨–ö–ò –ü–û–¢–†–Ü–ë–ù–û –¥–ª—è –∑–∞–≤–¥–∞–Ω–Ω—è
- **–ú–ê–ö–°–ò–ú–£–ú 2 MCP —Å–µ—Ä–≤–µ—Ä–∏ –Ω–∞ –æ–¥–∏–Ω item** (—ñ–¥–µ–∞–ª—å–Ω–æ 1)
- –Ø–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ >2 —Å–µ—Ä–≤–µ—Ä–∏ ‚Üí —Ä–æ–∑–±–∏–π –Ω–∞ –∫—ñ–ª—å–∫–∞ items

‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û - –º–∞–∫—Å–∏–º—É–º 2 —Å–µ—Ä–≤–µ—Ä–∏:
  Item 1: playwright (–≤—ñ–¥–∫—Ä–∏—Ç–∏ —Å–∞–π—Ç)
  Item 2: playwright + filesystem (–∑—ñ–±—Ä–∞—Ç–∏ —Ç–∞ –∑–±–µ—Ä–µ–≥—Ç–∏ –¥–∞–Ω—ñ)
  Item 3: shell + memory (–æ–±—Ä–æ–±–∏—Ç–∏ —Ç–∞ –∑–∞–ø–∞–º'—è—Ç–∞—Ç–∏)

‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û - –±—ñ–ª—å—à–µ 2 —Å–µ—Ä–≤–µ—Ä—ñ–≤:
  Item 1: playwright + filesystem + shell + memory (–∑–∞–Ω–∞–¥—Ç–æ –±–∞–≥–∞—Ç–æ!)
  ‚Üí –†–æ–∑–±–∏–π –Ω–∞ 3 –ø—Ä–æ—Å—Ç–∏—Ö items

–ü–†–ê–í–ò–õ–ê –°–¢–í–û–†–ï–ù–ù–Ø TODO:
10. üî¥ **–ú–ê–ö–°–ò–ú–£–ú 2 —Å–µ—Ä–≤–µ—Ä–∏ –≤ mcp_servers –¥–ª—è –æ–¥–Ω–æ–≥–æ item**
```

---

### Level 2: Server Selection Validation

**–§–∞–π–ª:** `orchestrator/workflow/stages/server-selection-processor.js`

**–î–æ–¥–∞–Ω–æ –≤–∞–ª—ñ–¥–∞—Ü—ñ—é (—Ä—è–¥–∫–∏ 56-80):**
```javascript
// NEW 19.10.2025: –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∫—ñ–ª—å–∫–æ—Å—Ç—ñ —Å–µ—Ä–≤–µ—Ä—ñ–≤ (max 2)
if (result.selected_servers.length > 2) {
    this.logger.warn(`[STAGE-2.0-MCP] ‚ö†Ô∏è Too many servers selected (${result.selected_servers.length}). Item needs split.`, {
        category: 'server-selection',
        component: 'server-selection'
    });

    return {
        success: false,
        needs_split: true,
        reasoning: `Item requires ${result.selected_servers.length} servers, but maximum is 2. Should be split into multiple simpler items.`,
        selected_servers: result.selected_servers,
        suggested_splits: [
            `${result.selected_servers.slice(0, 2).join(' + ')}: first part`,
            `${result.selected_servers.slice(2).join(' + ')}: second part`
        ],
        summary: `üîÄ –ü—É–Ω–∫—Ç –ø–æ—Ç—Ä–µ–±—É—î ${result.selected_servers.length} —Å–µ—Ä–≤–µ—Ä—ñ–≤ (–º–∞–∫—Å 2). –†–æ–∑–±–∏–≤–∞—é...`,
        metadata: {
            itemId: currentItem.id,
            stage: 'server-selection',
            requiresSplit: true,
            serversCount: result.selected_servers.length
        }
    };
}
```

**–©–æ –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è:**
1. Stage 2.0 –æ—Ç—Ä–∏–º—É—î —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤—ñ–¥ LLM
2. –Ø–∫—â–æ –æ–±—Ä–∞–Ω–æ >2 —Å–µ—Ä–≤–µ—Ä–∏ ‚Üí –ø–æ–≤–µ—Ä—Ç–∞—î `needs_split: true`
3. Workflow –ø–µ—Ä–µ–¥–∞—î —Ü–µ Atlas –¥–ª—è —Ä–æ–∑–±–∏—Ç—Ç—è item –Ω–∞ –ø—Ä–æ—Å—Ç—ñ—à—ñ

---

### Level 3: Tetyana Safety + WARNING

**–§–∞–π–ª:** `orchestrator/workflow/mcp-todo-manager.js`

**–î–æ–¥–∞–Ω–æ WARNING –ª–æ–≥—É–≤–∞–Ω–Ω—è (—Ä—è–¥–∫–∏ 916-925):**
```javascript
} else {
    // General prompt (fallback)
    planPrompt = MCP_PROMPTS.TETYANA_PLAN_TOOLS;
    this.logger.warn(`[TODO] ‚ö†Ô∏è Using GENERAL prompt (fallback). Atlas should split items to max 2 servers!`, {
        category: 'mcp-todo',
        component: 'mcp-todo',
        itemId: item.id,
        reason: 'No specialized prompt available or >2 servers'
    });
}
```

**–ö–æ–ª–∏ —Å–ø—Ä–∞—Ü—å–æ–≤—É—î:**
- –Ø–∫—â–æ Level 1 —Ç–∞ Level 2 —è–∫–æ—Å—å –ø—Ä–æ–ø—É—Å—Ç–∏–ª–∏ >2 —Å–µ—Ä–≤–µ—Ä–∏
- –Ø–∫—â–æ –Ω–æ–≤–∏–π MCP —Å–µ—Ä–≤–µ—Ä –¥–æ–¥–∞–Ω–æ –±–µ–∑ —Å–ø–µ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ–≥–æ –ø—Ä–æ–º–ø—Ç—É
- –õ–æ–≥–∏ –±—É–¥—É—Ç—å –ø–æ–∫–∞–∑—É–≤–∞—Ç–∏ WARNING –¥–ª—è –¥—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

---

## üìà –û—á—ñ–∫—É–≤–∞–Ω—ñ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏

### –°—Ü–µ–Ω–∞—Ä—ñ–π A: Atlas —Å—Ç–≤–æ—Ä—é—î –ø—Ä–∞–≤–∏–ª—å–Ω–æ (>90% –≤–∏–ø–∞–¥–∫—ñ–≤)
```
User: "–í—ñ–¥–∫—Ä–∏—Ç–∏ —Å–∞–π—Ç, –∑–±–µ—Ä–µ–≥—Ç–∏ –¥–∞–Ω—ñ –≤ —Ñ–∞–π–ª —Ç–∞ –≤–∏–∫–æ–Ω–∞—Ç–∏ –∫–æ–º–∞–Ω–¥—É"
    ‚Üì
Atlas Stage 1:
  Item 1: playwright (–≤—ñ–¥–∫—Ä–∏—Ç–∏)
  Item 2: playwright + filesystem (–∑—ñ–±—Ä–∞—Ç–∏ —Ç–∞ –∑–±–µ—Ä–µ–≥—Ç–∏)
  Item 3: shell (–≤–∏–∫–æ–Ω–∞—Ç–∏ –∫–æ–º–∞–Ω–¥—É)
    ‚Üì
Stage 2.0: –û–±–∏—Ä–∞—î 1-2 —Å–µ—Ä–≤–µ—Ä–∏ –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ item
Stage 2.1: –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î —Å–ø–µ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω—ñ –ø—Ä–æ–º–ø—Ç–∏ ‚úÖ
```

### –°—Ü–µ–Ω–∞—Ä—ñ–π B: Atlas –ø–æ–º–∏–ª–∏–≤—Å—è (~5% –≤–∏–ø–∞–¥–∫—ñ–≤)
```
Atlas Stage 1:
  Item 1: playwright + filesystem + shell (–ø–æ–º–∏–ª–∫–∞!)
    ‚Üì
Stage 2.0: –û–±—Ä–∞–≤ 3 —Å–µ—Ä–≤–µ—Ä–∏
Stage 2.0 Validation: ‚ö†Ô∏è Too many servers! needs_split=true
    ‚Üì
Atlas Stage X: –†–æ–∑–±–∏–≤–∞—î item –Ω–∞ 2 –ø—Ä–æ—Å—Ç—ñ—à–∏—Ö
    Item 1a: playwright + filesystem
    Item 1b: shell
    ‚Üì
Stage 2.1: –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î —Å–ø–µ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω—ñ –ø—Ä–æ–º–ø—Ç–∏ ‚úÖ
```

### –°—Ü–µ–Ω–∞—Ä—ñ–π C: Edge case (rare, <1%)
```
–Ø–∫–æ—Å—å –ø—Ä–æ–π—à–ª–æ —á–µ—Ä–µ–∑ Level 1 —ñ Level 2
    ‚Üì
Stage 2.1: ‚ö†Ô∏è WARNING: Using GENERAL prompt (fallback)
    ‚Üì
–õ–æ–≥–∏ –ø–æ–∫–∞–∑—É—é—Ç—å –ø—Ä–æ–±–ª–µ–º—É ‚Üí –º–æ–∂–Ω–∞ –≤–∏–ø—Ä–∞–≤–∏—Ç–∏
```

---

## üî¨ –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è

### –¢–µ—Å—Ç 1: –ü—Ä–æ—Å—Ç–∏–π –∑–∞–ø–∏—Ç (1 —Å–µ—Ä–≤–µ—Ä)
```
Input: "–í—ñ–¥–∫—Ä–∏—Ç–∏ google.com"
Expected: 
  - Atlas —Å—Ç–≤–æ—Ä—é—î 1 item –∑ playwright
  - Stage 2.0 –æ–±–∏—Ä–∞—î [playwright]
  - Stage 2.1 –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î TETYANA_PLAN_TOOLS_PLAYWRIGHT
```

### –¢–µ—Å—Ç 2: –°–µ—Ä–µ–¥–Ω—ñ–π –∑–∞–ø–∏—Ç (2 —Å–µ—Ä–≤–µ—Ä–∏)
```
Input: "–í—ñ–¥–∫—Ä–∏—Ç–∏ auto.ria.com —Ç–∞ –∑–±–µ—Ä–µ–≥—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ —Ñ–∞–π–ª"
Expected:
  - Atlas —Å—Ç–≤–æ—Ä—é—î 1-2 items –∑ playwright + filesystem
  - Stage 2.0 –æ–±–∏—Ä–∞—î [playwright, filesystem]
  - Stage 2.1 –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î combined prompt (playwright + filesystem)
```

### –¢–µ—Å—Ç 3: –°–∫–ª–∞–¥–Ω–∏–π –∑–∞–ø–∏—Ç (–ø–æ—Ç–µ–Ω—Ü—ñ–π–Ω–æ >2 —Å–µ—Ä–≤–µ—Ä–∏)
```
Input: "–í—ñ–¥–∫—Ä–∏—Ç–∏ —Å–∞–π—Ç, –∑–±–µ—Ä–µ–≥—Ç–∏ –¥–∞–Ω—ñ, –≤–∏–∫–æ–Ω–∞—Ç–∏ –∫–æ–º–∞–Ω–¥—É —Ç–∞ –∑–∞–ø–∞–º'—è—Ç–∞—Ç–∏"
Expected:
  - Atlas —Å—Ç–≤–æ—Ä—é—î 3-4 items –ø–æ 1-2 —Å–µ—Ä–≤–µ—Ä–∏ –∫–æ–∂–µ–Ω
  - Stage 2.0 –æ–±–∏—Ä–∞—î max 2 –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ
  - Stage 2.1 –∑–∞–≤–∂–¥–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î —Å–ø–µ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω—ñ –ø—Ä–æ–º–ø—Ç–∏
```

### –¢–µ—Å—Ç 4: Edge case (—è–∫—â–æ Atlas –ø–æ–º–∏–ª–∏–≤—Å—è)
```
Input: –°–∫–ª–∞–¥–Ω–∏–π –∑–∞–ø–∏—Ç
Atlas –ø–æ–º–∏–ª–∫–∞: –°—Ç–≤–æ—Ä–∏–≤ 1 item –∑ 4 —Å–µ—Ä–≤–µ—Ä–∞–º–∏
Expected:
  - Stage 2.0 –≤–∏—è–≤–ª—è—î >2 —Å–µ—Ä–≤–µ—Ä–∏
  - –ü–æ–≤–µ—Ä—Ç–∞—î needs_split=true
  - Atlas —Ä–æ–∑–±–∏–≤–∞—î –Ω–∞ –ø—Ä–æ—Å—Ç—ñ—à—ñ items
  - –ü–æ–≤—Ç–æ—Ä—é—î—Ç—å—Å—è —Ü–∏–∫–ª –∑ –ø—Ä–∞–≤–∏–ª—å–Ω–∏–º–∏ items
```

---

## üìù –õ–æ–≥–∏ –¥–ª—è –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É

### –£—Å–ø—ñ—à–Ω–∏–π –≤–∏–ø–∞–¥–æ–∫:
```
[STAGE-2.0-MCP] ‚úÖ Selected: playwright, filesystem (confidence: 0.9)
[TODO] üéØüéØ Using 2 combined specialized prompts: TETYANA_PLAN_TOOLS_PLAYWRIGHT + TETYANA_PLAN_TOOLS_FILESYSTEM
```

### –í–∏–ø–∞–¥–æ–∫ –∑ split:
```
[STAGE-2.0-MCP] ‚ö†Ô∏è Too many servers selected (3). Item needs split.
[STAGE-2.0-MCP] üîÄ –ü—É–Ω–∫—Ç –ø–æ—Ç—Ä–µ–±—É—î 3 —Å–µ—Ä–≤–µ—Ä—ñ–≤ (–º–∞–∫—Å 2). –†–æ–∑–±–∏–≤–∞—é...
[ATLAS] –†–æ–∑–±–∏–≤–∞—é item 5 –Ω–∞ 2 –ø—Ä–æ—Å—Ç—ñ—à–∏—Ö...
```

### Edge case (fallback):
```
[TODO] ‚ö†Ô∏è Using GENERAL prompt (fallback). Atlas should split items to max 2 servers!
‚Üí –ü–æ—Ç—Ä—ñ–±–Ω–æ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —á–æ–º—É —Ü–µ —Å—Ç–∞–ª–æ—Å—è
```

---

## üí° –ü–µ—Ä–µ–≤–∞–≥–∏

1. **–ó–∞–≤–∂–¥–∏ —Å–ø–µ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω—ñ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó:** LLM –æ—Ç—Ä–∏–º—É—î –¥–µ—Ç–∞–ª—å–Ω—ñ –∑–Ω–∞–Ω–Ω—è –ø—Ä–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ñ —Å–µ—Ä–≤–µ—Ä–∏
2. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è:** –Ø–∫—â–æ Atlas –ø–æ–º–∏–ª–∏–≤—Å—è, Stage 2.0 –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤–∏—è–≤–ª—è—î —ñ trigger split
3. **–ü—Ä–æ–∑–æ—Ä—ñ—Å—Ç—å:** WARNING –ª–æ–≥–∏ –ø–æ–∫–∞–∑—É—é—Ç—å edge cases –¥–ª—è –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è —Å–∏—Å—Ç–µ–º–∏
4. **Safety net:** –ó–∞–≥–∞–ª—å–Ω–∏–π –ø—Ä–æ–º–ø—Ç –∑–∞–ª–∏—à–∞—î—Ç—å—Å—è —è–∫ ultima ratio, –∞–ª–µ –∑ WARNING
5. **Backward compatible:** –Ü—Å–Ω—É—é—á—ñ items –ø—Ä–æ–¥–æ–≤–∂—É—é—Ç—å –ø—Ä–∞—Ü—é–≤–∞—Ç–∏

---

## ‚ö†Ô∏è –í–∞–∂–ª–∏–≤—ñ –Ω–æ—Ç–∞—Ç–∫–∏

1. **–ó–∞–≥–∞–ª—å–Ω–∏–π –ø—Ä–æ–º–ø—Ç –ù–ï –≤–∏–¥–∞–ª–µ–Ω–æ** - –≤—ñ–Ω –∑–∞–ª–∏—à–∞—î—Ç—å—Å—è —è–∫ safety net
2. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π split** –≤ Stage 2.0 —è–∫—â–æ Atlas –ø—Ä–æ–ø—É—Å—Ç–∏–≤
3. **WARNING –ª–æ–≥–∏** –¥–æ–ø–æ–º–∞–≥–∞—é—Ç—å –∑–Ω–∞–π—Ç–∏ —ñ –≤–∏–ø—Ä–∞–≤–∏—Ç–∏ –ø—Ä–æ–±–ª–µ–º–∏
4. **3-—Ä—ñ–≤–Ω–µ–≤–∏–π –∑–∞—Ö–∏—Å—Ç** –≥–∞—Ä–∞–Ω—Ç—É—î —â–æ >95% –∑–∞–ø–∏—Ç—ñ–≤ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å —Å–ø–µ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω—ñ –ø—Ä–æ–º–ø—Ç–∏

---

## üîÑ Workflow –ø—ñ—Å–ª—è –∑–º—ñ–Ω

```
User Request
    ‚Üì
Stage 1: Atlas TODO Planning
    ‚îú‚îÄ –ü—Ä–∞–≤–∏–ª–æ: max 2 —Å–µ—Ä–≤–µ—Ä–∏ –Ω–∞ item
    ‚îú‚îÄ –°—Ç–≤–æ—Ä—é—î n items (–∫–æ–∂–µ–Ω 1-2 —Å–µ—Ä–≤–µ—Ä–∏)
    ‚îî‚îÄ Output: TODO list
    ‚Üì
FOR EACH item:
    ‚Üì
    Stage 2.0: Server Selection
    ‚îú‚îÄ LLM –æ–±–∏—Ä–∞—î 1-2 –Ω–∞–π–∫—Ä–∞—â–∏—Ö —Å–µ—Ä–≤–µ—Ä–∏
    ‚îú‚îÄ –í–∞–ª—ñ–¥–∞—Ü—ñ—è: if >2 ‚Üí needs_split=true
    ‚îî‚îÄ Output: selected_servers (1-2)
    ‚Üì
    Stage 2.1: Tetyana Plan Tools
    ‚îú‚îÄ if 1 server ‚Üí specialized prompt
    ‚îú‚îÄ if 2 servers ‚Üí combined specialized prompts
    ‚îú‚îÄ if >2 (edge) ‚Üí general + WARNING
    ‚îî‚îÄ Output: tool_calls
    ‚Üì
    Stage 2.2: Execute Tools
    Stage 2.3: Grisha Verify
    ‚Üì
NEXT item
```

---

## ‚ú® –°—Ç–∞—Ç—É—Å

**–ì–æ—Ç–æ–≤–Ω—ñ—Å—Ç—å:** ‚úÖ READY FOR PRODUCTION  
**–¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è:** –†–µ–∫–æ–º–µ–Ω–¥—É—î—Ç—å—Å—è –Ω–∞ —Å–∫–ª–∞–¥–Ω–∏—Ö multi-server –∑–∞–≤–¥–∞–Ω–Ω—è—Ö  
**–ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥:** –ü–µ—Ä–µ–≤—ñ—Ä—è—Ç–∏ WARNING –ª–æ–≥–∏ –ø–µ—Ä—à—ñ 1-2 –¥–Ω—ñ

---

## üìä Metrics to Watch

1. **Specialized prompt usage:** –ú–∞—î –±—É—Ç–∏ >95%
2. **needs_split triggers:** –ü–µ—Ä—à—ñ –¥–Ω—ñ –º–æ–∂–µ –±—É—Ç–∏ 5-10%, –ø–æ—Ç—ñ–º <1%
3. **General prompt fallbacks:** –ú–∞—î –±—É—Ç–∏ <1% (—Ç—ñ–ª—å–∫–∏ edge cases)
4. **Task success rate:** –û—á—ñ–∫—É—î—Ç—å—Å—è –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è –∑ 22% –¥–æ 70-90%
