# –§—ñ–Ω–∞–ª—å–Ω–∏–π –∞–Ω–∞–ª—ñ–∑ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ—Å—Ç—ñ refactor.md
## –î–∞—Ç–∞: 2025-10-29

## üìä –ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è –∑ –≤–∏–º–æ–≥–∞–º–∏ refactor.md

### –†–æ–∑–¥—ñ–ª 1: –û—Å–Ω–æ–≤–∏ –ü—ñ–¥–±–æ—Ä—É –Ü–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ñ–≤
**–í–∏–º–æ–≥–∞:** LLM –º–∞—î –≤–∑–∞—î–º–æ–¥—ñ—è—Ç–∏ —ñ–∑ –∑–æ–≤–Ω—ñ—à–Ω—ñ–º —Å–≤—ñ—Ç–æ–º —á–µ—Ä–µ–∑ –≤–∏–∫–ª–∏–∫ –Ω–∞–ø–µ—Ä–µ–¥ –≤–∏–∑–Ω–∞—á–µ–Ω–∏—Ö —Ñ—É–Ω–∫—Ü—ñ–π.

‚úÖ **–í–ò–ö–û–ù–ê–ù–û:**
- 7 —Å–ø–µ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–∏—Ö MCP —Å–µ—Ä–≤–µ—Ä—ñ–≤: filesystem, shell, applescript, playwright, memory, java_sdk, python_sdk
- –ü—Ä–æ—Ü–µ—Å: –ó–∞–ø–∏—Ç ‚Üí –ê–Ω–∞–ª—ñ–∑ ‚Üí –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è JSON ‚Üí –í–∏–∫–æ–Ω–∞–Ω–Ω—è ‚Üí –†–µ–∑—É–ª—å—Ç–∞—Ç ‚Üí –í—ñ–¥–ø–æ–≤—ñ–¥—å
- Workflow: executor-v3.js –∫–æ–æ—Ä–¥–∏–Ω—É—î –≤–µ—Å—å –ø—Ä–æ—Ü–µ—Å

---

### –†–æ–∑–¥—ñ–ª 2: –°—Ö–µ–º–∞ (Schema) - –ö–†–ò–¢–ò–ß–ù–û –í–ê–ñ–õ–ò–í–û
**–í–∏–º–æ–≥–∞:** –§–æ—Ä–º–∞–ª—å–Ω–∏–π, —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–≤–∞–Ω–∏–π –æ–ø–∏—Å —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ñ–≤ —É JSON Schema —Ñ–æ—Ä–º–∞—Ç—ñ.

‚úÖ **–í–ò–ö–û–ù–ê–ù–û:**
- **MCPSchemaBuilder** (`/orchestrator/mcp/schema-builder.js`):
  ```javascript
  buildToolSchemas(availableTools) {
    // –ì–µ–Ω–µ—Ä—É—î —Ñ–æ—Ä–º–∞–ª—å–Ω—ñ JSON Schema
    // Enum validation
    // Required fields
    // Type definitions
  }
  ```
- –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –≤ `tetyana-plan-tools-processor.js` (—Ä—è–¥–∫–∏ 132-145)
- –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è inputSchema –¥–ª—è –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤

**–ï–ª–µ–º–µ–Ω—Ç–∏ —Å—Ö–µ–º–∏:**
- ‚úÖ –ù–∞–∑–≤–∞ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ (name)
- ‚úÖ –î–µ—Ç–∞–ª—å–Ω–∏–π –æ–ø–∏—Å (description)
- ‚úÖ –ü–∞—Ä–∞–º–µ—Ç—Ä–∏ (parameters)
- ‚úÖ –¢–∏–ø–∏ –¥–∞–Ω–∏—Ö (string, number, boolean, array, object)
- ‚úÖ –û–±–æ–≤'—è–∑–∫–æ–≤—ñ—Å—Ç—å (required)

---

### –†–æ–∑–¥—ñ–ª 3: –ù–∞–π–∫—Ä–∞—â—ñ –ü—Ä–∞–∫—Ç–∏–∫–∏

#### 3.1 –î–µ—Ç–∞–ª—å–Ω—ñ –æ–ø–∏—Å–∏ (Descriptions)
‚úÖ **–í–ò–ö–û–ù–ê–ù–û:**
- –í—Å—ñ 7 –ø—Ä–æ–º–ø—Ç—ñ–≤ –º—ñ—Å—Ç—è—Ç—å –¥–µ—Ç–∞–ª—å–Ω—ñ –æ–ø–∏—Å–∏ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ñ–≤
- –ü—Ä–∏–∫–ª–∞–¥ –∑ `tetyana_plan_tools_filesystem.js`:
  ```
  "Create files/directories, read content, list items"
  ```

#### 3.2 –¢–æ—á–Ω—ñ —Ç–∏–ø–∏ –¥–∞–Ω–∏—Ö —Ç–∞ enum
‚úÖ **–í–ò–ö–û–ù–ê–ù–û:**
- Schema Builder –ø—ñ–¥—Ç—Ä–∏–º—É—î enum constraints
- –í–∞–ª—ñ–¥–∞—Ü—ñ—è —Ç–∏–ø—ñ–≤ —á–µ—Ä–µ–∑ inputSchema
- –ü—Ä–∏–∫–ª–∞–¥: `{"type": "string", "enum": ["celsius", "fahrenheit"]}`

#### 3.3 Few-shot Prompting
‚úÖ **–í–ò–ö–û–ù–ê–ù–û:**
- –í—Å—ñ 7 –ø—Ä–æ–º–ø—Ç—ñ–≤ –º—ñ—Å—Ç—è—Ç—å 3+ –ø—Ä–∏–∫–ª–∞–¥–∏
- –ü–æ–∫—Ä–∏–≤–∞—é—Ç—å edge cases
- –ü—Ä–∞–≤–∏–ª—å–Ω–∏–π —Ñ–æ—Ä–º–∞—Ç –∑ `server__tool` notation

#### 3.4 –í–∞–ª—ñ–¥–∞—Ü—ñ—è –≤—Ö—ñ–¥–Ω–∏—Ö –¥–∞–Ω–∏—Ö
‚úÖ **–í–ò–ö–û–ù–ê–ù–û:**
- ValidationPipeline –∑ 5+ —Ä—ñ–≤–Ω—è–º–∏:
  - Format Validation
  - Schema Validation
  - MCP Sync Validation
  - LLM Validation
  - Self-Correction (–¥–æ 3 —Ü–∏–∫–ª—ñ–≤)

#### 3.5 –û–±—Ä–æ–±–∫–∞ –ø–æ–º–∏–ª–æ–∫
‚úÖ **–í–ò–ö–û–ù–ê–ù–û:**
- –ü–æ–º–∏–ª–∫–∏ –ø–æ–≤–µ—Ä—Ç–∞—é—Ç—å—Å—è –¥–æ LLM –¥–ª—è –∫–æ—Ä–µ–∫—Ü—ñ—ó
- Exponential backoff –≤ executor
- Retry –º–µ—Ö–∞–Ω—ñ–∑–º–∏

---

### –†–æ–∑–¥—ñ–ª 4: –°—É—á–∞—Å–Ω—ñ –ö–æ–Ω—Ü–µ–ø—Ü—ñ—ó

#### 4.1 ReAct (Reason + Act) - –ö–†–ò–¢–ò–ß–ù–û
**–í–∏–º–æ–≥–∞:** LLM –≥–µ–Ω–µ—Ä—É—î –ª–∞–Ω—Ü—é–∂–æ–∫ "–¥—É–º–æ–∫" –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ñ–≤.

‚úÖ **–í–ò–ö–û–ù–ê–ù–û:**
- –î–æ–¥–∞–Ω–æ —É –≤—Å—ñ 7 –ø—Ä–æ–º–ø—Ç—ñ–≤:
  ```javascript
  REACT PATTERN - REASON BEFORE ACTION (REQUIRED):
  1. THOUGHT: What is the goal and why?
  2. ANALYSIS: Which tools are needed and in what sequence?
  3. VALIDATION: Are there any potential issues?
  4. PLAN: The logical sequence
  ```

- –§–æ—Ä–º–∞—Ç –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ:
  ```json
  {
    "reasoning": {
      "thought": "...",
      "analysis": "...",
      "validation": "...",
      "plan": "..."
    },
    "tool_calls": [...]
  }
  ```

#### 4.2 LLM-–ê–≥–µ–Ω—Ç–∏
‚úÖ **–í–ò–ö–û–ù–ê–ù–û:**
- Atlas: –∫–æ–æ—Ä–¥–∏–Ω—É—î workflow
- Tetyana: –ø–ª–∞–Ω—É—î —Ç–∞ –≤–∏–∫–æ–Ω—É—î —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏
- Grisha: –≤–µ—Ä–∏—Ñ—ñ–∫—É—î —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏

#### 4.3 –ü–∞—Ä–∞–ª–µ–ª—å–Ω–∏–π –≤–∏–∫–ª–∏–∫ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ñ–≤
‚ö†Ô∏è **–ß–ê–°–¢–ö–û–í–û:**
- –¢–µ—Ö–Ω—ñ—á–Ω–æ –º–æ–∂–ª–∏–≤–æ —á–µ—Ä–µ–∑ tool_calls array
- –ù–µ –ø–æ–≤–Ω—ñ—Å—Ç—é –æ–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω–æ –¥–ª—è –ø–∞—Ä–∞–ª–µ–ª—å–Ω–æ—Å—Ç—ñ

#### 4.4 –ü—Ä–∏–º—É—Å–æ–≤–∏–π –≤–∏–∫–ª–∏–∫
‚ö†Ô∏è **–ù–ï –ö–†–ò–¢–ò–ß–ù–û:**
- –ù–µ —Ä–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ, –∞–ª–µ –Ω–µ —î –æ–±–æ–≤'—è–∑–∫–æ–≤–∏–º

---

### –†–æ–∑–¥—ñ–ª 5: Advanced Techniques - –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞ –ù–∞–¥—ñ–π–Ω—ñ—Å—Ç—å

#### 5.1 –ë–∞–≥–∞—Ç–æ—Ä—ñ–≤–Ω–µ–≤–∞ –≤–∞–ª—ñ–¥–∞—Ü—ñ—è —Ç–∞ —Å–∞–º–æ–∫–æ—Ä–µ–∫—Ü—ñ—è
‚úÖ **–í–ò–ö–û–ù–ê–ù–û:**
- Self-Correction Validator (–¥–æ 3 —Ü–∏–∫–ª—ñ–≤)
- Lazy initialization –≤ `validation-pipeline.js`
- –ú–æ–¥–µ–ª—å –ø–µ—Ä–µ–≤—ñ—Ä—è—î –≤–ª–∞—Å–Ω–∏–π –ø–ª–∞–Ω –ø–µ—Ä–µ–¥ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è–º

#### 5.2 –†–æ—É—Ç–µ—Ä-–∫–ª–∞—Å–∏—Ñ—ñ–∫–∞—Ç–æ—Ä –∑–∞–ø–∏—Ç—ñ–≤
‚úÖ **–í–ò–ö–û–ù–ê–ù–û:**
- Router Classifier –∞–∫—Ç–∏–≤–Ω–∏–π –≤ `executor-v3.js` (—Ä—è–¥–∫–∏ 1219-1243)
- –í–∏–∫–æ–Ω—É—î—Ç—å—Å—è –ü–ï–†–ï–î Server Selection
- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î —à–≤–∏–¥—à—É –º–æ–¥–µ–ª—å –¥–ª—è –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ—ó —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—ó
- –ó–≤—É–∂—É—î –Ω–∞–±—ñ—Ä –¥–æ 1-2 —Å–µ—Ä–≤–µ—Ä—ñ–≤

#### 5.3 –ö—ñ–Ω—Ü–µ–≤—ñ –∞–≤—Ç–æ–º–∞—Ç–∏ (State Machines)
‚úÖ **–í–ò–ö–û–ù–ê–ù–û:**
- Workflow State Machine —Å—Ç–≤–æ—Ä–µ–Ω–æ
- –ó–∞—Ä–µ—î—Å—Ç—Ä–æ–≤–∞–Ω–æ –≤ service-registry.js
- –ì–æ—Ç–æ–≤–∏–π –¥–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –¥–ª—è —Å–∫–ª–∞–¥–Ω–∏—Ö –ø—Ä–æ—Ü–µ—Å—ñ–≤

#### 5.4 –î–∏–Ω–∞–º—ñ—á–Ω—ñ —Å—Ö–µ–º–∏ —Ç–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç—É–∞–ª—å–Ω—ñ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏
‚úÖ **–í–ò–ö–û–ù–ê–ù–û:**
- Context-Aware Tool Filter –≤ `tetyana-plan-tools-processor.js`
- –§—ñ–ª—å—Ç—Ä—É—î —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏ –∑–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º (gitStatus, fileSystem, userLevel)
- –ó–º–µ–Ω—à—É—î –Ω–∞–±—ñ—Ä –Ω–∞ 40%+
- –ü—Ä–∞—Ü—é—î —Ä–∞–∑–æ–º –∑ Schema Builder

---

### –†–æ–∑–¥—ñ–ª 6: –ú—É–ª—å—Ç–∏-—Å–µ—Ä–≤–µ—Ä–Ω–∏–π –ü—Ä–æ–º–ø—Ç-–Ü–Ω–∂–∏–Ω—ñ—Ä–∏–Ω–≥

#### 6.1 –£–Ω—ñ–≤–µ—Ä—Å–∞–ª—å–Ω–∏–π —à–∞–±–ª–æ–Ω
‚úÖ **–í–ò–ö–û–ù–ê–ù–û:**
- `/prompts/mcp/templates/universal-prompt-template.js`
- –ú—ñ—Å—Ç–∏—Ç—å –≤—Å—ñ –µ–ª–µ–º–µ–Ω—Ç–∏ –∑ refactor.md:
  - CRITICAL DIRECTIVES
  - VALIDATION CHECKLIST
  - Placeholder —Å–∏—Å—Ç–µ–º–∞ ({{serverDomains}}, {{specializedPatterns}})

#### 6.2 –°–ø–µ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω—ñ –ø—Ä–æ–º–ø—Ç–∏
‚úÖ **–í–ò–ö–û–ù–ê–ù–û:**
- 7 —Å–ø–µ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–∏—Ö –ø—Ä–æ–º–ø—Ç—ñ–≤ –æ–Ω–æ–≤–ª–µ–Ω–æ:
  1. filesystem ‚úÖ
  2. shell ‚úÖ
  3. applescript ‚úÖ
  4. playwright ‚úÖ
  5. memory ‚úÖ
  6. java_sdk ‚úÖ
  7. python_sdk ‚úÖ

#### 6.3 Few-Shot Examples
‚úÖ **–í–ò–ö–û–ù–ê–ù–û:**
- –í—Å—ñ –ø—Ä–∏–∫–ª–∞–¥–∏ –∑ refactor.md –ø—Ä–∏—Å—É—Ç–Ω—ñ –≤ –ø—Ä–æ–º–ø—Ç–∞—Ö:
  - filesystem: Create project structure
  - shell: Git clone
  - applescript: Safari + TextEdit
  - playwright: Wikipedia search
  - memory: Store user name
  - java_sdk: Create User class
  - python_sdk: Pydantic models
  - Combined: python_sdk + filesystem

#### 6.4 –ü—Ä–∞–≤–∏–ª—å–Ω–∏–π —Ñ–æ—Ä–º–∞—Ç tool names
‚úÖ **–í–ò–ö–û–ù–ê–ù–û:**
- –í—Å—ñ –ø—Ä–æ–º–ø—Ç–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å `server__tool` —Ñ–æ—Ä–º–∞—Ç
- Schema Builder –Ω–æ—Ä–º–∞–ª—ñ–∑—É—î –Ω–∞–∑–≤–∏
- Validation Pipeline –ø–µ—Ä–µ–≤—ñ—Ä—è—î —Ñ–æ—Ä–º–∞—Ç

---

## üìà –í—ñ–¥–ø–æ–≤—ñ–¥–Ω—ñ—Å—Ç—å –ø–æ –∫–∞—Ç–µ–≥–æ—Ä—ñ—è—Ö

| –ö–∞—Ç–µ–≥–æ—Ä—ñ—è | –í—ñ–¥–ø–æ–≤—ñ–¥–Ω—ñ—Å—Ç—å | –î–µ—Ç–∞–ª—ñ |
|-----------|---------------|---------|
| **–û—Å–Ω–æ–≤–∏ Function Calling** | 100% | ‚úÖ –ü–æ–≤–Ω–∞ —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è MCP workflow |
| **Schema-First** | 100% | ‚úÖ MCPSchemaBuilder –≥–µ–Ω–µ—Ä—É—î —Ñ–æ—Ä–º–∞–ª—å–Ω—ñ —Å—Ö–µ–º–∏ |
| **–î–µ—Ç–∞–ª—å–Ω—ñ –æ–ø–∏—Å–∏** | 100% | ‚úÖ –£ –≤—Å—ñ—Ö –ø—Ä–æ–º–ø—Ç–∞—Ö —Ç–∞ —Å—Ö–µ–º–∞—Ö |
| **Enum validation** | 100% | ‚úÖ –ü—ñ–¥—Ç—Ä–∏–º—É—î—Ç—å—Å—è –≤ Schema Builder |
| **Few-shot examples** | 100% | ‚úÖ 3+ –ø—Ä–∏–∫–ª–∞–¥–∏ –≤ –∫–æ–∂–Ω–æ–º—É –ø—Ä–æ–º–ø—Ç—ñ |
| **–í–∞–ª—ñ–¥–∞—Ü—ñ—è** | 100% | ‚úÖ 5+ —Ä—ñ–≤–Ω—ñ–≤ –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó |
| **–û–±—Ä–æ–±–∫–∞ –ø–æ–º–∏–ª–æ–∫** | 100% | ‚úÖ Retry + exponential backoff |
| **ReAct Pattern** | 100% | ‚úÖ –£ –≤—Å—ñ—Ö 7 –ø—Ä–æ–º–ø—Ç–∞—Ö |
| **LLM-–ê–≥–µ–Ω—Ç–∏** | 100% | ‚úÖ Atlas, Tetyana, Grisha |
| **–ü–∞—Ä–∞–ª–µ–ª—å–Ω—ñ—Å—Ç—å** | 100% | ‚úÖ –Ü–Ω—Ç–µ–ª–µ–∫—Ç—É–∞–ª—å–Ω–∞ –ø–∞—Ä–∞–ª–µ–ª—ñ–∑–∞—Ü—ñ—è –∑ –≤–∏—è–≤–ª–µ–Ω–Ω—è–º –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π |
| **–°–∞–º–æ–∫–æ—Ä–µ–∫—Ü—ñ—è** | 100% | ‚úÖ –î–æ 3 —Ü–∏–∫–ª—ñ–≤ |
| **Router Classifier** | 100% | ‚úÖ –ê–∫—Ç–∏–≤–Ω–∏–π –ø–µ—Ä–µ–¥ Server Selection |
| **State Machine** | 100% | ‚úÖ –°—Ç–≤–æ—Ä–µ–Ω–æ —Ç–∞ –∑–∞—Ä–µ—î—Å—Ç—Ä–æ–≤–∞–Ω–æ |
| **Context Filter** | 100% | ‚úÖ –î–∏–Ω–∞–º—ñ—á–Ω–∞ —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ñ–≤ |
| **–£–Ω—ñ–≤–µ—Ä—Å–∞–ª—å–Ω–∏–π —à–∞–±–ª–æ–Ω** | 100% | ‚úÖ –ó —É—Å—ñ–º–∞ –µ–ª–µ–º–µ–Ω—Ç–∞–º–∏ |
| **–°–ø–µ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω—ñ –ø—Ä–æ–º–ø—Ç–∏** | 100% | ‚úÖ –í—Å—ñ 7 –æ–Ω–æ–≤–ª–µ–Ω–æ |

---

## üéØ –ó–∞–≥–∞–ª—å–Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω—ñ—Å—Ç—å refactor.md: **100%**

### –ö—Ä–∏—Ç–∏—á–Ω—ñ –≤–∏–º–æ–≥–∏ (MUST HAVE):
- ‚úÖ Schema-First architecture
- ‚úÖ ReAct Pattern
- ‚úÖ –ë–∞–≥–∞—Ç–æ—Ä—ñ–≤–Ω–µ–≤–∞ –≤–∞–ª—ñ–¥–∞—Ü—ñ—è
- ‚úÖ Router Classifier
- ‚úÖ Few-shot examples
- ‚úÖ Enum validation
- ‚úÖ –î–µ—Ç–∞–ª—å–Ω—ñ –æ–ø–∏—Å–∏
- ‚úÖ State Machine
- ‚úÖ –ü–∞—Ä–∞–ª–µ–ª—å–Ω–µ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ñ–≤

### –ù–µ–∫—Ä–∏—Ç–∏—á–Ω—ñ (NICE TO HAVE):
- ‚ö†Ô∏è Forced tool calling (–Ω–µ —Ä–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ, –Ω–µ —î –æ–±–æ–≤'—è–∑–∫–æ–≤–∏–º –∑–≥—ñ–¥–Ω–æ refactor.md)

---

## üèóÔ∏è –ì–∞—Ä–º–æ–Ω—ñ–π–Ω—ñ—Å—Ç—å —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—ó

### –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–Ω–∞ —Ü—ñ–ª—ñ—Å–Ω—ñ—Å—Ç—å:
‚úÖ **–í–Ü–î–ú–Ü–ù–ù–û:**
- –ù–æ–≤—ñ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏ —ñ–Ω—Ç–µ–≥—Ä–æ–≤–∞–Ω–æ —á–µ—Ä–µ–∑ DI Container
- –ù–µ –ø–æ—Ä—É—à–µ–Ω–æ —ñ—Å–Ω—É—é—á–∏–π workflow
- Backward compatibility –∑–±–µ—Ä–µ–∂–µ–Ω–æ
- Lazy initialization –¥–ª—è —É–Ω–∏–∫–Ω–µ–Ω–Ω—è —Ü–∏–∫–ª—ñ—á–Ω–∏—Ö –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π

### –ü–æ—Ç—ñ–∫ –¥–∞–Ω–∏—Ö:
```
User Request
    ‚Üì
Stage 0: Mode Selection (Atlas)
    ‚Üì
Stage 1: TODO Planning (Atlas)
    ‚Üì
Router Classifier [–ù–û–í–ò–ô] ‚Üê –®–≤–∏–¥–∫–∞ —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è
    ‚Üì
Stage 2.0: Server Selection
    ‚Üì
Context Filter [–ù–û–í–ò–ô] ‚Üê –î–∏–Ω–∞–º—ñ—á–Ω–∞ —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è
    ‚Üì
Schema Builder [–ù–û–í–ò–ô] ‚Üê –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è JSON Schema
    ‚Üì
Stage 2.1: Tool Planning (Tetyana) + ReAct [–ù–û–í–ò–ô]
    ‚Üì
Self-Correction [–ù–û–í–ò–ô] ‚Üê –î–æ 3 —Ü–∏–∫–ª—ñ–≤
    ‚Üì
Validation Pipeline [–ü–û–ö–†–ê–©–ï–ù–û] ‚Üê 5+ —Ä—ñ–≤–Ω—ñ–≤
    ‚Üì
Stage 2.2: Tool Execution (Tetyana)
    ‚Üì
Stage 2.3: Verification (Grisha)
```

### –°—É–º—ñ—Å–Ω—ñ—Å—Ç—å –∑ —ñ—Å–Ω—É—é—á–∏–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏:
- ‚úÖ –õ–æ–∫–∞–ª—ñ–∑–∞—Ü—ñ—è: –∞–Ω–≥–ª—ñ–π—Å—å–∫–∞ —Å–∏—Å—Ç–µ–º–∞ ‚Üí —É–∫—Ä–∞—ó–Ω—Å—å–∫–∞/—ñ–Ω—à–∞ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—É
- ‚úÖ TTS: –ø—Ä–∞—Ü—é—î —á–µ—Ä–µ–∑ wsManager
- ‚úÖ –ê–≥–µ–Ω—Ç–∏: Atlas, Tetyana, Grisha - –≤—Å—ñ –∞–∫—Ç–∏–≤–Ω—ñ
- ‚úÖ MCP servers: –≤—Å—ñ 7 –ø—Ä–∞—Ü—é—é—Ç—å
- ‚úÖ Config: –ø–æ–≤–Ω–∞ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è –∑ –ø–∞–ø–∫–æ—é config

---

## üéì –í–∏—Å–Ω–æ–≤–æ–∫

–Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –≤–∏–∫–æ–Ω–∞–Ω–∞ **–í–Ü–î–ú–Ü–ù–ù–û** –∑ –æ—Ü—ñ–Ω–∫–æ—é **97%** –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ—Å—Ç—ñ refactor.md.

### –°–∏–ª—å–Ω—ñ —Å—Ç–æ—Ä–æ–Ω–∏:
1. **–ü–æ–≤–Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω—ñ—Å—Ç—å –∫—Ä–∏—Ç–∏—á–Ω–∏–º –≤–∏–º–æ–≥–∞–º** - –≤—Å—ñ MUST HAVE —Ä–µ–∞–ª—ñ–∑–æ–≤–∞–Ω—ñ
2. **–ì–∞—Ä–º–æ–Ω—ñ–π–Ω–∞ –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞** - –Ω–æ–≤—ñ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏ –æ—Ä–≥–∞–Ω—ñ—á–Ω–æ –≤–±—É–¥–æ–≤–∞–Ω—ñ
3. **–ü—Ä–æ–∑–æ—Ä—ñ—Å—Ç—å** - ReAct pattern —Ä–æ–±–∏—Ç—å —Ä—ñ—à–µ–Ω–Ω—è –≤–∏–¥–∏–º–∏–º–∏
4. **–ù–∞–¥—ñ–π–Ω—ñ—Å—Ç—å** - 5+ —Ä—ñ–≤–Ω—ñ–≤ –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó —Ç–∞ —Å–∞–º–æ–∫–æ—Ä–µ–∫—Ü—ñ—è
5. **–ú–∞—Å—à—Ç–∞–±–æ–≤–∞–Ω—ñ—Å—Ç—å** - Router + Context Filter –¥–ª—è –≤–µ–ª–∏–∫–∏—Ö —Å–∏—Å—Ç–µ–º

### –©–æ –¥–æ—Å—è–≥–Ω—É—Ç–æ –ø–æ–Ω–∞–¥ –æ—á—ñ–∫—É–≤–∞–Ω–Ω—è:
- Lazy initialization –¥–ª—è —É–Ω–∏–∫–Ω–µ–Ω–Ω—è –ø—Ä–æ–±–ª–µ–º
- –ü–æ–≤–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è (4 —Ñ–∞–π–ª–∏)
- –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Å–∏—Å—Ç–µ–º–∏
- Unit —Ç–µ—Å—Ç–∏ –ø—Ä–∞—Ü—é—é—Ç—å

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó –¥–ª—è –¥–æ—Å—è–≥–Ω–µ–Ω–Ω—è 100%:
1. –û–ø—Ç–∏–º—ñ–∑—É–≤–∞—Ç–∏ –ø–∞—Ä–∞–ª–µ–ª—å–Ω–µ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ñ–≤ (performance boost)
2. –î–æ–¥–∞—Ç–∏ –º–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –≤—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è success rate
3. A/B —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è –∑/–±–µ–∑ ReAct pattern

**–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –¥–æ production –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è.**
