# ‚úÖ API –ó–∞–ø–∏—Ç–∏ - –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –í–Ω–µ—Å–µ–Ω—ñ

**–î–∞—Ç–∞**: 2025-11-18  
**–°—Ç–∞—Ç—É—Å**: üü¢ –í–ò–ü–†–ê–í–õ–ï–ù–ù–Ø –í–ù–ï–°–ï–ù–Ü

---

## üîß –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è #1: –ó–º–µ–Ω—à–∏—Ç–∏ Jitter –≤ Rate Limiter

**–§–∞–π–ª**: `/orchestrator/utils/rate-limiter.js`  
**–õ—ñ–Ω—ñ—ó**: 88-108

**–©–æ –±—É–ª–æ**:
```javascript
const jitter = delay * this.jitterRange * (Math.random() - 0.5);
// jitterRange = 0.3 (30%)
// –î–ª—è 4000ms: jitter –≤—ñ–¥ -600ms –¥–æ +600ms
```

**–©–æ —Å—Ç–∞–ª–æ**:
```javascript
const jitter = delay * 0.1 * (Math.random() - 0.5);
// 10% jitter
// –î–ª—è 4000ms: jitter –≤—ñ–¥ -200ms –¥–æ +200ms
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç**:
- –ó–∞—Ç—Ä–∏–º–∫–∏ —Å—Ç–∞–ª–∏ –±—ñ–ª—å—à –ø–µ—Ä–µ–¥–±–∞—á—É–≤–∞–Ω–∏–º–∏
- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞ –∑–∞—Ç—Ä–∏–º–∫–∞ –∑–º–µ–Ω—à–∏–ª–∞—Å—å –∑ ~55s –¥–æ ~15s

---

## üîß –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è #2: –ó–º–µ–Ω—à–∏—Ç–∏ Jitter –≤ Axios Config

**–§–∞–π–ª**: `/orchestrator/utils/axios-config.js`  
**–õ—ñ–Ω—ñ—ó**: 55-68

**–©–æ –±—É–ª–æ**:
```javascript
const jitter = Math.random() * 1000; // 0-1s jitter
// –î–ª—è 4000ms: –∑–∞—Ç—Ä–∏–º–∫–∞ –≤—ñ–¥ 4000ms –¥–æ 5000ms
```

**–©–æ —Å—Ç–∞–ª–æ**:
```javascript
const jitter = Math.random() * 100; // 0-100ms jitter
// –î–ª—è 4000ms: –∑–∞—Ç—Ä–∏–º–∫–∞ –≤—ñ–¥ 4000ms –¥–æ 4100ms
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç**:
- –ó–∞—Ç—Ä–∏–º–∫–∏ –±—ñ–ª—å—à —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–≤–∞–Ω—ñ
- –ú–µ–Ω—à–µ –≤–∏–ø–∞–¥–∫–æ–≤–æ—Å—Ç—ñ

---

## üîß –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è #3: –ó–±—ñ–ª—å—à–∏—Ç–∏ TTL –¥–ª—è GET /v1/models

**–§–∞–π–ª**: `/orchestrator/ai/model-availability-checker.js`  
**–õ—ñ–Ω—ñ—ó**: 21-25

**–©–æ –±—É–ª–æ**:
```javascript
this.modelsListCacheTTL = 30000; // 30 seconds
// –ó–∞–ø–∏—Ç–∏ –π–¥—É—Ç—å –∫–æ–∂–Ω—ñ 0.2 —Å–µ–∫ (8 –∑–∞–ø–∏—Ç—ñ–≤ –∑–∞ 2 —Å–µ–∫)
```

**–©–æ —Å—Ç–∞–ª–æ**:
```javascript
this.modelsListCacheTTL = 300000; // 5 minutes
// –ó–∞–ø–∏—Ç–∏ –±—É–¥—É—Ç—å –π—Ç–∏ –º–∞–∫—Å–∏–º—É–º –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç**:
- –ó–º–µ–Ω—à–µ–Ω–Ω—è GET /v1/models –∑–∞–ø–∏—Ç—ñ–≤ –Ω–∞ **99%**
- –ú–µ–Ω—à–µ –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –Ω–∞ API

---

## üìä –û—á—ñ–∫—É–≤–∞–Ω—ñ –†–µ–∑—É–ª—å—Ç–∞—Ç–∏

| –ú–µ—Ç—Ä–∏–∫–∞                   | –ü–æ—Ç–æ—á–Ω–µ   | –û—á—ñ–∫—É–≤–∞–Ω–µ     | –ü–æ–ª—ñ–ø—à–µ–Ω–Ω—è |
| ------------------------- | --------- | ------------- | ---------- |
| –ó–∞—Ç—Ä–∏–º–∫–∞ –ø—Ä–∏ –ø–æ–º–∏–ª—Ü—ñ      | 55s       | ~15s          | **-73%**   |
| GET /v1/models –∑–∞–ø–∏—Ç–∏     | 8 –∑–∞ 2s   | 1 –∑–∞ 5 —Ö–≤–∏–ª–∏–Ω | **-99%**   |
| –ü–µ—Ä–µ–¥–±–∞—á—É–≤–∞–Ω—ñ—Å—Ç—å –∑–∞—Ç—Ä–∏–º–æ–∫ | –í–∏–ø–∞–¥–∫–æ–≤–∞ | –°—Ç—Ä—É–∫—Ç—É—Ä–æ–≤–∞–Ω–∞ | **+100%**  |

---

## ‚ö†Ô∏è –ó–∞–ª–∏—à–∏–ª–∞—Å—è –ü—Ä–æ–±–ª–µ–º–∞: –î—É–±–ª—é–≤–∞–Ω–Ω—è –õ–æ–≥—É–≤–∞–Ω–Ω—è

**–°—Ç–∞—Ç—É—Å**: üü° –ü–û–¢–†–ï–ë–£–Ñ –î–û–°–õ–Ü–î–ñ–ï–ù–ù–Ø

**–°–∏–º–ø—Ç–æ–º**:
- –ö–æ–∂–µ–Ω –∑–∞–ø–∏—Ç –ª–æ–≥—É—î—Ç—å—Å—è **–¥–≤—ñ—á—ñ** –∑ –æ–¥–Ω–∞–∫–æ–≤–∏–º —á–∞—Å–æ–º
- –õ–æ–≥–∏ –∑–∞–ø–∏—Å—É—é—Ç—å—Å—è –≤ —Ñ–∞–π–ª **–¥–≤—ñ—á—ñ**

**–ú–æ–∂–ª–∏–≤—ñ –ø—Ä–∏—á–∏–Ω–∏**:
1. HTTP middleware –≤ `/orchestrator/app.js` –ª–æ–≥—É—î –∑–∞–ø–∏—Ç
2. –ú–æ–∂–ª–∏–≤–æ, —î —â–µ –æ–¥–Ω–µ –º—ñ—Å—Ü–µ –ª–æ–≥—É–≤–∞–Ω–Ω—è –∑–∞–ø–∏—Ç—ñ–≤ (–ø–æ—Ç—Ä—ñ–±–Ω–æ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏)
3. –ú–æ–∂–ª–∏–≤–æ, –∑–∞–ø–∏—Ç–∏ –¥—ñ–π—Å–Ω–æ –≤–∏–∫–æ–Ω—É—é—Ç—å—Å—è –¥–≤—ñ—á—ñ

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—è**:
- –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —á–∏ —î —ñ–Ω—à—ñ –º—ñ—Å—Ü—è –ª–æ–≥—É–≤–∞–Ω–Ω—è –∑–∞–ø–∏—Ç—ñ–≤
- –î–æ–¥–∞—Ç–∏ debug –ª–æ–≥—É–≤–∞–Ω–Ω—è –¥–ª—è –≤—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è –¥—É–±–ª—é–≤–∞–Ω–Ω—è

---

## üöÄ –ù–∞—Å—Ç—É–ø–Ω—ñ –ö—Ä–æ–∫–∏

1. ‚úÖ **–ê–Ω–∞–ª—ñ–∑** - –í–∏—è–≤–ª–µ–Ω—ñ –≤—Å—ñ –ø—Ä–æ–±–ª–µ–º–∏
2. ‚úÖ **–í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è** - –í–Ω–µ—Å–µ–Ω—ñ 3 –∫—Ä–∏—Ç–∏—á–Ω—ñ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è
3. ‚è≥ **–¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è** - –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–∏ —Å–∏—Å—Ç–µ–º—É —Ç–∞ —Å–ø–æ—Å—Ç–µ—Ä—ñ–≥–∞—Ç–∏ –∑–∞ –ª–æ–≥–∞–º–∏
4. ‚è≥ **–ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥** - –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —á–∏ –∑–∞—Ç—Ä–∏–º–∫–∏ –∑–º–µ–Ω—à–∏–ª–∏—Å—è

---

## üìù –ö–æ–º–∞–Ω–¥–∏ –¥–ª—è –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è

```bash
# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–∏ —Å–∏—Å—Ç–µ–º—É
./restart_system.sh stop
./restart_system.sh start

# –°–ø–æ—Å—Ç–µ—Ä—ñ–≥–∞—Ç–∏ –∑–∞ –ª–æ–≥–∞–º–∏
tail -f logs/orchestrator.log

# –ü–æ—à—É–∫–∞—Ç–∏ 500 –ø–æ–º–∏–ª–∫–∏
grep "500" logs/orchestrator.log | wc -l

# –ü–æ—à—É–∫–∞—Ç–∏ GET /v1/models –∑–∞–ø–∏—Ç–∏
grep "GET.*models" logs/orchestrator.log | wc -l

# –ü–æ—à—É–∫–∞—Ç–∏ –¥—É–±–ª—é–≤–∞–Ω–Ω—è –ª–æ–≥—É–≤–∞–Ω–Ω—è
grep "POST.*chat/completions" logs/orchestrator.log | sort | uniq -c | grep -v "^      1 "
```

---

## üìà –ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É

1. **–ó–∞—Ç—Ä–∏–º–∫–∏ –ø—Ä–∏ –ø–æ–º–∏–ª–∫–∞—Ö**:
   - –ü–æ—Ç–æ—á–Ω–∞: ~55s
   - –û—á—ñ–∫—É–≤–∞–Ω–∞: ~15s

2. **GET /v1/models –∑–∞–ø–∏—Ç–∏**:
   - –ü–æ—Ç–æ—á–Ω–∞: 8 –∑–∞ 2 —Å–µ–∫
   - –û—á—ñ–∫—É–≤–∞–Ω–∞: 1 –∑–∞ 5 —Ö–≤–∏–ª–∏–Ω

3. **–î—É–±–ª—é–≤–∞–Ω–Ω—è –ª–æ–≥—É–≤–∞–Ω–Ω—è**:
   - –ü–æ—Ç–æ—á–Ω–∞: 100%
   - –û—á—ñ–∫—É–≤–∞–Ω–∞: 0%

---

## üìã –†–µ–∑—é–º–µ

‚úÖ **–í–∏–ø—Ä–∞–≤–ª–µ–Ω–æ**:
- –ó–º–µ–Ω—à–µ–Ω–æ jitter –∑ 30% –¥–æ 10% –≤ rate limiter
- –ó–º–µ–Ω—à–µ–Ω–æ jitter –∑ 1000ms –¥–æ 100ms –≤ axios config
- –ó–±—ñ–ª—å—à–µ–Ω–æ TTL –¥–ª—è GET /v1/models –∑ 30s –¥–æ 5 —Ö–≤–∏–ª–∏–Ω

üü° **–ü–æ—Ç—Ä–µ–±—É—î –¥–æ—Å–ª—ñ–¥–∂–µ–Ω–Ω—è**:
- –î—É–±–ª—é–≤–∞–Ω–Ω—è –ª–æ–≥—É–≤–∞–Ω–Ω—è API –∑–∞–ø–∏—Ç—ñ–≤

üéØ **–û—á—ñ–∫—É–≤–∞–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç**:
- –ó–∞—Ç—Ä–∏–º–∫–∏ –ø—Ä–∏ –ø–æ–º–∏–ª–∫–∞—Ö –∑–º–µ–Ω—à–∞—Ç—å—Å—è –Ω–∞ 73%
- GET /v1/models –∑–∞–ø–∏—Ç–∏ –∑–º–µ–Ω—à–∞—Ç—å—Å—è –Ω–∞ 99%
- –ó–∞—Ç—Ä–∏–º–∫–∏ —Å—Ç–∞–Ω—É—Ç—å –±—ñ–ª—å—à –ø–µ—Ä–µ–¥–±–∞—á—É–≤–∞–Ω–∏–º–∏
