# ===================================
# ATLAS v5.0 - Environment Configuration
# ===================================
# Copy this file to .env and configure your settings
# Last Updated: 2025-10-16 (v5.0 - Pure MCP Edition)

# === SYSTEM ===
NODE_ENV=production
BUILD_NUMBER=dev
LOG_LEVEL=info
FORCE_FREE_PORTS=true

# === LLM API CONFIGURATION (NEW v5.0) ===
# Primary LLM API endpoint (local)
LLM_API_ENDPOINT=http://localhost:4000/v1/chat/completions

# Fallback LLM API endpoint (ngrok tunnel for remote access)
# Example: https://bdd80b70a92d.ngrok-free.app/v1/chat/completions
LLM_API_FALLBACK_ENDPOINT=

# Enable fallback to remote API when local unavailable
LLM_API_USE_FALLBACK=true

# API timeout in milliseconds
LLM_API_TIMEOUT=60000

# === AI BACKEND CONFIGURATION ===
# v5.0: Pure MCP mode only
# Backend mode: 'mcp' (recommended)
AI_BACKEND_MODE=mcp

# Primary backend for task execution
AI_BACKEND_PRIMARY=mcp

# Disable fallback (strict mode for development/testing)
# - true: System will throw errors on failures (no fallback)
# - false: System will attempt fallback (production safe)
AI_BACKEND_DISABLE_FALLBACK=false

# === MCP LLM CONFIGURATION (NEW 21.10.2025) ===
# LLM model for MCP Tool Validator (safety and validation)
# Default: atlas-gpt-4o-mini (fast reasoning, low temperature for consistency)
# Options: atlas-gpt-4o-mini | atlas-ministral-3b | atlas-mistral-small-2503
MCP_LLM_MODEL=atlas-gpt-4o-mini

# Temperature for LLM Tool Validator (0.0-1.0)
# Default: 0.1 (low temperature for consistent validation)
MCP_LLM_TEMPERATURE=0.1

# === SECURITY CONFIGURATION (NEW 21.10.2025) ===
# Enable/disable LLM Tool Validator
# Default: true (always validate for safety)
SECURITY_LLM_VALIDATOR_ENABLED=true

# Fallback behavior when validation fails
# Options: 'allow' (default) | 'deny'
SECURITY_VALIDATOR_FALLBACK=allow

# Enable/disable repetition checking
SECURITY_REPETITION_CHECK_ENABLED=true

# Maximum consecutive repetitions before blocking
SECURITY_MAX_CONSECUTIVE_REPETITIONS=3

# Maximum total calls per tool
SECURITY_MAX_TOTAL_CALLS=10

# Auto-block critical risk operations
SECURITY_AUTO_BLOCK_CRITICAL=true

# Auto-block high risk operations
SECURITY_AUTO_BLOCK_HIGH=true

# Show warnings for medium risk operations
SECURITY_WARN_ON_MEDIUM=true

# Log all validation attempts (for debugging)
SECURITY_LOG_ALL_VALIDATIONS=false

# Verbose logging for blocked operations
SECURITY_VERBOSE_BLOCKING=true

# Tool history configuration
SECURITY_TOOL_HISTORY_ENABLED=true
SECURITY_HISTORY_MAX_SIZE=100
SECURITY_HISTORY_CONTEXT_SIZE=5
SECURITY_HISTORY_PERSISTENT=false

# === MCP RETRY CONFIGURATION (NEW 18.10.2025) ===
# Maximum number of retry attempts for MCP operations
# Default: 3 (allows retries for transient failures)
MCP_MAX_ATTEMPTS=3

# Maximum retry attempts specifically for TODO item execution
# Default: 3 (allows Tetyana to retry tool planning on validation errors)
MCP_ITEM_MAX_ATTEMPTS=3

# Circuit breaker threshold (failures before opening circuit)
# Default: 3 (after 3 consecutive failures, circuit opens)
MCP_CIRCUIT_BREAKER_THRESHOLD=3

# Circuit breaker reset timeout in milliseconds
# Default: 60000 (60 seconds before attempting to close circuit)
MCP_CIRCUIT_BREAKER_RESET_MS=60000

# MCP operation timeout in milliseconds
# Default: 30000 (30 seconds per operation)
MCP_TIMEOUT_MS=30000

# Enable/disable exponential backoff for retries
# Default: true (enabled)
MCP_EXPONENTIAL_BACKOFF=true

# === TTS & VOICE ===
REAL_TTS_MODE=true
TTS_DEVICE=mps
TTS_PORT=3001

# === WHISPER CONFIGURATION ===
# Optimized for Mac Studio M1 MAX (Metal GPU)
WHISPER_BACKEND=cpp
WHISPER_DEVICE=metal
WHISPER_PORT=3002
WHISPER_CPP_BIN=/Users/dev/Documents/GitHub/atlas4/third_party/whisper.cpp.upstream/build/bin/whisper-cli
WHISPER_CPP_MODEL=/Users/dev/Documents/GitHub/atlas4/models/whisper/ggml-large-v3.bin
# Mac Studio M1 MAX optimizations:
WHISPER_CPP_NGL=20              # GPU layers (Metal acceleration)
WHISPER_CPP_THREADS=10          # M1 Max has 10 performance cores
WHISPER_CPP_DISABLE_GPU=false   # Keep Metal GPU enabled
WHISPER_SAMPLE_RATE=48000       # High quality audio (v5.0)

# === NETWORK PORTS ===
ORCHESTRATOR_PORT=5101
WEB_PORT=5001
FRONTEND_PORT=5001

# === FEATURES ===
# Mac Studio M1 MAX optimizations
USE_METAL_GPU=true              # Metal GPU for Whisper and TTS
OPTIMIZE_FOR_M1_MAX=true        # Enable M1 MAX specific optimizations
