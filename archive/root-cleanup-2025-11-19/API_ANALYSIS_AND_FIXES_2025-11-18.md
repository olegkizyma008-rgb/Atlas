# üîç API –ó–∞–ø–∏—Ç–∏ - –ê–Ω–∞–ª—ñ–∑ —Ç–∞ –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è

**–î–∞—Ç–∞**: 2025-11-18  
**–°—Ç–∞—Ç—É—Å**: üî¥ –ö–†–ò–¢–ò–ß–ù–Ü –ü–†–û–ë–õ–ï–ú–ò –í–ò–Ø–í–õ–ï–ù–Ü

---

## üìä –í–∏—è–≤–ª–µ–Ω—ñ –ü—Ä–æ–±–ª–µ–º–∏

### 1. ‚ùå **–î–£–ë–õ–Æ–í–ê–ù–ù–Ø –õ–û–ì–£–í–ê–ù–ù–Ø API –ó–ê–ü–ò–¢–Ü–í (100%)**

**–°–∏–º–ø—Ç–æ–º –≤ –ª–æ–≥–∞—Ö**:
```
Timestamp: 2025-11-18T04:58:15.625Z ‚Üí POST /v1/chat/completions [mistral] ‚Üí 200 (8094ms)
Timestamp: 2025-11-18T04:58:15.625Z ‚Üí POST /v1/chat/completions ‚Üí 200 (8094ms)
```

**–ü—Ä–∏—á–∏–Ω–∞**: 
- –ö–æ–∂–µ–Ω –∑–∞–ø–∏—Ç –ª–æ–≥—É—î—Ç—å—Å—è **–¥–≤—ñ—á—ñ** –∑ –æ–¥–Ω–∞–∫–æ–≤–∏–º —á–∞—Å–æ–º —ñ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º
- –õ–æ–≥–∏ –∑–∞–ø–∏—Å—É—é—Ç—å—Å—è –≤ —Ñ–∞–π–ª **–¥–≤—ñ—á—ñ** (–ª—ñ–Ω—ñ—ó 4442-4476 –¥—É–±–ª—é—é—Ç—å—Å—è –≤ 4479-4512)

**–î–∂–µ—Ä–µ–ª–æ –ø—Ä–æ–±–ª–µ–º–∏**:
- `/orchestrator/app.js` (–ª—ñ–Ω—ñ—ó 31-54): HTTP middleware –ª–æ–≥—É—î –∑–∞–ø–∏—Ç
- –ú–æ–∂–ª–∏–≤–æ, —î —â–µ –æ–¥–Ω–µ –º—ñ—Å—Ü–µ –ª–æ–≥—É–≤–∞–Ω–Ω—è –∑–∞–ø–∏—Ç—ñ–≤

**–í–ø–ª–∏–≤**:
- –†–æ–∑–º—ñ—Ä –ª–æ–≥—ñ–≤ –∑–±—ñ–ª—å—à—É—î—Ç—å—Å—è –≤ **2 —Ä–∞–∑–∏**
- –í–∞–∂—á–µ –∞–Ω–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –ª–æ–≥–∏ —á–µ—Ä–µ–∑ –¥—É–±–ª—é–≤–∞–Ω–Ω—è
- –ú–æ–∂–ª–∏–≤–æ, –∑–∞–ø–∏—Ç–∏ –≤–∏–∫–æ–Ω—É—é—Ç—å—Å—è –¥–≤—ñ—á—ñ

---

### 2. ‚ùå **–ú–ê–°–û–í–Ü 500 –ü–û–ú–ò–õ–ö–ò (Mistral API)**

**–°–∏–º–ø—Ç–æ–º –≤ –ª–æ–≥–∞—Ö** (07:25:46 - 07:26:42):
```
2025-11-18 07:25:46 [WARN] Server error (500), retrying after 1045ms (attempt 1/3)
2025-11-18 07:25:47 [WARN] Server error (500), retrying after 2722ms (attempt 2/3)
2025-11-18 07:25:50 [WARN] Server error (500), retrying after 4676ms (attempt 3/3)
2025-11-18 07:25:55 [ERROR] Request failed after 3 attempts (status: 500)
```

**–ó–∞—Ç—Ä–∏–º–∫–∏**:
- Attempt 1: 1045ms
- Attempt 2: 2722ms (2.6x –±—ñ–ª—å—à–µ)
- Attempt 3: 4676ms (1.7x –±—ñ–ª—å—à–µ)
- **–ó–∞–≥–∞–ª—å–Ω–∞ –∑–∞—Ç—Ä–∏–º–∫–∞: ~9.4 —Å–µ–∫** –¥–ª—è –æ–¥–Ω–æ–≥–æ –∑–∞–ø–∏—Ç—É

**Rate Limiter –∑–∞—Ç—Ä–∏–º–∫–∏**:
```
2025-11-18 07:25:55 [WARN] [RATE-LIMITER] Retryable error, attempt 1/5 (delay: 2000ms)
2025-11-18 07:26:07 [WARN] [RATE-LIMITER] Retryable error, attempt 2/5 (delay: 5561ms)
2025-11-18 07:26:21 [WARN] [RATE-LIMITER] Retryable error, attempt 3/5 (delay: 10984ms)
2025-11-18 07:26:42 [WARN] [RATE-LIMITER] Retryable error, attempt 4/5 (delay: 29706ms)
```

**–ó–∞–≥–∞–ª—å–Ω–∞ –∑–∞—Ç—Ä–∏–º–∫–∞**: ~55 —Å–µ–∫—É–Ω–¥ –¥–ª—è –æ–¥–Ω–æ–≥–æ –∑–∞–ø–∏—Ç—É!

**–ü—Ä–∏—á–∏–Ω–∞**:
- Exponential backoff –∑–∞—Ç—Ä–∏–º–∫–∏ **–≤–∏–ø–∞–¥–∫–æ–≤—ñ** –∑–∞–º—ñ—Å—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–≤–∞–Ω–∏—Ö
- –§–æ—Ä–º—É–ª–∞: `delay = baseDelay * Math.pow(2, attempt)` + **jitter**
- Jitter –¥–æ–¥–∞—î –≤–∏–ø–∞–¥–∫–æ–≤—ñ—Å—Ç—å: `jitter = delay * 0.3 * (Math.random() - 0.5)`

**–î–∂–µ—Ä–µ–ª–æ –ø—Ä–æ–±–ª–µ–º–∏**:
- `/orchestrator/utils/rate-limiter.js` (–ª—ñ–Ω—ñ—ó 91-106): `calculateBackoff()`
- `/orchestrator/utils/axios-config.js` (–ª—ñ–Ω—ñ—ó 60-66): `getExponentialBackoff()`

**–í–ø–ª–∏–≤**:
- –°–∏—Å—Ç–µ–º–∞ –∑–∞–≤–∏—Å–∞—î –Ω–∞ 55 —Å–µ–∫—É–Ω–¥ –ø—Ä–∏ –ø–æ–º–∏–ª—Ü—ñ API
- –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á —á–µ–∫–∞—î –¥—É–∂–µ –¥–æ–≤–≥–æ
- –ú–æ–∂–ª–∏–≤–æ, timeout —Å–ø—Ä–∞—Ü—å–æ–≤—É—î —Ä–∞–Ω—ñ—à–µ, –Ω—ñ–∂ retry –∑–∞–≤–µ—Ä—à—É—î—Ç—å—Å—è

---

### 3. ‚ùå **–õ–ò–®–ù–Ü GET /v1/models –ó–ê–ü–ò–¢–ò**

**–°–∏–º–ø—Ç–æ–º –≤ –ª–æ–≥–∞—Ö** (05:02:31 - 05:02:33):
```
2025-11-18T05:02:31.647Z ‚Üí GET /v1/models ‚Üí 200 (5ms)
2025-11-18T05:02:31.652Z ‚Üí GET /v1/models ‚Üí 200 (2ms)
2025-11-18T05:02:33.430Z ‚Üí GET /v1/models ‚Üí 200 (4ms)
... (8 –∑–∞–ø–∏—Ç—ñ–≤ –∑–∞ 2 —Å–µ–∫—É–Ω–¥–∏)
```

**–ü—Ä–∏—á–∏–Ω–∞**:
- `ModelAvailabilityChecker.fetchAvailableModels()` –ø–µ—Ä–µ–≤—ñ—Ä—è—î –º–æ–¥–µ–ª—ñ –∑–∞–Ω–∞–¥—Ç–æ —á–∞—Å—Ç–æ
- –ö–µ—à TTL: 30 —Å–µ–∫ (–ª—ñ–Ω—ñ—è 24 –≤ `model-availability-checker.js`)
- –ê–ª–µ –∑–∞–ø–∏—Ç–∏ –π–¥—É—Ç—å –∫–æ–∂–Ω—ñ 0.2 —Å–µ–∫!

**–î–∂–µ—Ä–µ–ª–æ –ø—Ä–æ–±–ª–µ–º–∏**:
- `/orchestrator/ai/model-availability-checker.js` (–ª—ñ–Ω—ñ—ó 21-24): –ì–ª–æ–±–∞–ª—å–Ω–∏–π –∫–µ—à –Ω–µ –ø—Ä–∞—Ü—é—î

**–í–ø–ª–∏–≤**:
- –ù–µ–ø–æ—Ç—Ä—ñ–±–Ω—ñ –∑–∞–ø–∏—Ç–∏ –¥–æ API
- –ú–æ–∂–ª–∏–≤–æ, rate limit –≤—ñ–¥ API
- –ú–∞—Ä–Ω—É—î –ø—Ä–æ–ø—É—Å–∫–Ω—É –∑–¥–∞—Ç–Ω—ñ—Å—Ç—å

---

### 4. ‚ùå **–ù–ï–ü–†–ê–í–ò–õ–¨–ù–Ü –ó–ê–¢–†–ò–ú–ö–ò BACKOFF**

**–ü—Ä–æ–±–ª–µ–º–∞**:
- –ó–∞—Ç—Ä–∏–º–∫–∏ –Ω–µ —Å–ª—ñ–¥—É—é—Ç—å –ª–æ–≥—ñ—á–Ω–æ–º—É –ø–∞—Ç—Ç–µ—Ä–Ω—É
- Jitter –¥–æ–¥–∞—î –∑–∞–Ω–∞–¥—Ç–æ –±–∞–≥–∞—Ç–æ –≤–∏–ø–∞–¥–∫–æ–≤–æ—Å—Ç—ñ

**–ü—Ä–∏–∫–ª–∞–¥**:
```
Attempt 1: 1045ms (–±–∞–∑–æ–≤–∞ –∑–∞—Ç—Ä–∏–º–∫–∞ 1000ms + jitter ~45ms)
Attempt 2: 2722ms (–æ—á—ñ–∫—É—î—Ç—å—Å—è ~2000ms, –∞–ª–µ 2722ms)
Attempt 3: 4676ms (–æ—á—ñ–∫—É—î—Ç—å—Å—è ~4000ms, –∞–ª–µ 4676ms)
```

**–ü—Ä–∏—á–∏–Ω–∞**:
- Jitter: `jitter = delay * 0.3 * (Math.random() - 0.5)`
- –¶–µ –º–æ–∂–µ –¥–æ–¥–∞—Ç–∏ –≤—ñ–¥ -15% –¥–æ +15% –¥–æ –∑–∞—Ç—Ä–∏–º–∫–∏
- –î–ª—è 4000ms: –≤—ñ–¥ 3400ms –¥–æ 4600ms

**–î–∂–µ—Ä–µ–ª–æ –ø—Ä–æ–±–ª–µ–º–∏**:
- `/orchestrator/utils/rate-limiter.js` (–ª—ñ–Ω—ñ—è 101): Jitter –∑–∞–Ω–∞–¥—Ç–æ –≤–µ–ª–∏–∫–∏–π

---

## üîß –†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω—ñ –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è

### –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è 1: –í–∏–¥–∞–ª–∏—Ç–∏ –¥—É–±–ª—é–≤–∞–Ω–Ω—è –ª–æ–≥—É–≤–∞–Ω–Ω—è

**–§–∞–π–ª**: `/orchestrator/app.js`

**–ü—Ä–æ–±–ª–µ–º–∞**: HTTP middleware –ª–æ–≥—É—î –∑–∞–ø–∏—Ç, –∞–ª–µ –º–æ–∂–ª–∏–≤–æ —î —â–µ –æ–¥–Ω–µ –º—ñ—Å—Ü–µ –ª–æ–≥—É–≤–∞–Ω–Ω—è

**–†—ñ—à–µ–Ω–Ω—è**:
1. –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —á–∏ —î —ñ–Ω—à—ñ –º—ñ—Å—Ü—è –ª–æ–≥—É–≤–∞–Ω–Ω—è –∑–∞–ø–∏—Ç—ñ–≤
2. –ó–∞–ª–∏—à–∏—Ç–∏ —Ç—ñ–ª—å–∫–∏ –æ–¥–Ω–µ –º—ñ—Å—Ü–µ –ª–æ–≥—É–≤–∞–Ω–Ω—è –≤ middleware

---

### –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è 2: –û–ø—Ç–∏–º—ñ–∑—É–≤–∞—Ç–∏ exponential backoff

**–§–∞–π–ª**: `/orchestrator/utils/rate-limiter.js`

**–ü–æ—Ç–æ—á–Ω–∞ —Ñ–æ—Ä–º—É–ª–∞**:
```javascript
let delay = this.baseDelay * Math.pow(this.backoffMultiplier, attempt - 1);
const jitter = delay * this.jitterRange * (Math.random() - 0.5);
delay = Math.max(this.baseDelay, delay + jitter);
```

**–ù–æ–≤–∞ —Ñ–æ—Ä–º—É–ª–∞** (–±—ñ–ª—å—à –ø–µ—Ä–µ–¥–±–∞—á—É–≤–∞–Ω–∞):
```javascript
// Exponential backoff –±–µ–∑ jitter –¥–ª—è –±—ñ–ª—å—à–æ—ó –ø–µ—Ä–µ–¥–±–∞—á—É–≤–∞–Ω–æ—Å—Ç—ñ
let delay = this.baseDelay * Math.pow(this.backoffMultiplier, attempt - 1);

// –î–æ–¥–∞–≤–∞—Ç–∏ jitter –¢–Ü–õ–¨–ö–ò —è–∫—â–æ —Ü–µ –ø–æ—Ç—Ä—ñ–±–Ω–æ –¥–ª—è thundering herd
// –ó–º–µ–Ω—à–∏—Ç–∏ jitter –∑ 30% –¥–æ 10%
const jitter = delay * 0.1 * (Math.random() - 0.5);
delay = Math.max(this.baseDelay, delay + jitter);

// –û–±–º–µ–∂–∏—Ç–∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É –∑–∞—Ç—Ä–∏–º–∫—É
return Math.min(delay, this.maxDelay);
```

**–û—á—ñ–∫—É–≤–∞–Ω—ñ –∑–∞—Ç—Ä–∏–º–∫–∏**:
- Attempt 1: 1000ms ¬± 50ms
- Attempt 2: 2000ms ¬± 100ms
- Attempt 3: 4000ms ¬± 200ms
- Attempt 4: 8000ms ¬± 400ms
- Attempt 5: 16000ms ¬± 800ms (–æ–±–º–µ–∂–µ–Ω–æ –¥–æ 60000ms)

---

### –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è 3: –û–±–º–µ–∂–∏—Ç–∏ GET /v1/models –∑–∞–ø–∏—Ç–∏

**–§–∞–π–ª**: `/orchestrator/ai/model-availability-checker.js`

**–ü–æ—Ç–æ—á–Ω–∞ –ª–æ–≥—ñ–∫–∞**:
```javascript
// –ö–µ—à TTL: 30 —Å–µ–∫
this.modelsListCacheTTL = 30000;

// –ê–ª–µ –∑–∞–ø–∏—Ç–∏ –π–¥—É—Ç—å –∫–æ–∂–Ω—ñ 0.2 —Å–µ–∫!
```

**–ù–æ–≤–∞ –ª–æ–≥—ñ–∫–∞**:
```javascript
// –ó–±—ñ–ª—å—à–∏—Ç–∏ TTL –∑ 30 —Å–µ–∫ –¥–æ 5 —Ö–≤–∏–ª–∏–Ω
this.modelsListCacheTTL = 300000;

// –î–æ–¥–∞—Ç–∏ –º—ñ–Ω—ñ–º–∞–ª—å–Ω—É –∑–∞—Ç—Ä–∏–º–∫—É –º—ñ–∂ –∑–∞–ø–∏—Ç–∞–º–∏
this.minDelayBetweenFetches = 5000; // 5 —Å–µ–∫—É–Ω–¥

// –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —á–∏ –¥–æ—Å—Ç–∞—Ç–Ω—å–æ —á–∞—Å—É –ø—Ä–æ–π—à–ª–æ
const timeSinceLastFetch = Date.now() - this.lastFetchTimestamp;
if (timeSinceLastFetch < this.minDelayBetweenFetches) {
    return this.modelsListCache; // –ü–æ–≤–µ—Ä–Ω—É—Ç–∏ –∫–µ—à
}
```

---

### –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è 4: –ó–º–µ–Ω—à–∏—Ç–∏ jitter –¥–ª—è –±—ñ–ª—å—à–æ—ó –ø–µ—Ä–µ–¥–±–∞—á—É–≤–∞–Ω–æ—Å—Ç—ñ

**–§–∞–π–ª**: `/orchestrator/utils/axios-config.js`

**–ü–æ—Ç–æ—á–Ω–∞ —Ñ–æ—Ä–º—É–ª–∞** (–ª—ñ–Ω—ñ—è 64):
```javascript
const jitter = Math.random() * 1000; // 0-1s jitter
```

**–ù–æ–≤–∞ —Ñ–æ—Ä–º—É–ª–∞**:
```javascript
// –ó–º–µ–Ω—à–∏—Ç–∏ jitter –∑ 1000ms –¥–æ 100ms (10%)
const jitter = Math.random() * 100;
```

---

## üìà –û—á—ñ–∫—É–≤–∞–Ω—ñ –†–µ–∑—É–ª—å—Ç–∞—Ç–∏

| –ú–µ—Ç—Ä–∏–∫–∞                   | –ü–æ—Ç–æ—á–Ω–µ   | –û—á—ñ–∫—É–≤–∞–Ω–µ     | –ü–æ–ª—ñ–ø—à–µ–Ω–Ω—è |
| ------------------------- | --------- | ------------- | ---------- |
| –†–æ–∑–º—ñ—Ä –ª–æ–≥—ñ–≤              | 2x        | 1x            | -50%       |
| –ó–∞—Ç—Ä–∏–º–∫–∞ –ø—Ä–∏ –ø–æ–º–∏–ª—Ü—ñ      | 55s       | ~15s          | -73%       |
| GET /v1/models –∑–∞–ø–∏—Ç–∏     | 8 –∑–∞ 2s   | 1 –∑–∞ 5 —Ö–≤–∏–ª–∏–Ω | -99%       |
| –ü–µ—Ä–µ–¥–±–∞—á—É–≤–∞–Ω—ñ—Å—Ç—å –∑–∞—Ç—Ä–∏–º–æ–∫ | –í–∏–ø–∞–¥–∫–æ–≤–∞ | –°—Ç—Ä—É–∫—Ç—É—Ä–æ–≤–∞–Ω–∞ | +100%      |

---

## üöÄ –ü–ª–∞–Ω –í–∏–ø—Ä–∞–≤–ª–µ–Ω—å

1. ‚úÖ **–ê–Ω–∞–ª—ñ–∑** - –í–∏—è–≤–ª–µ–Ω—ñ –≤—Å—ñ –ø—Ä–æ–±–ª–µ–º–∏
2. ‚è≥ **–í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è** - –ü–æ—Ç—Ä—ñ–±–Ω–æ –≤–Ω–µ—Å—Ç–∏ –∑–º—ñ–Ω–∏ –≤ –∫–æ–¥
3. ‚è≥ **–¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è** - –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –Ω–∞ –Ω–æ–≤–æ–º—É –∑–∞–ø—É—Å–∫—É
4. ‚è≥ **–ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥** - –°–ø–æ—Å—Ç–µ—Ä—ñ–≥–∞—Ç–∏ –∑–∞ –ª–æ–≥–∞–º–∏

---

## üìù –ü—Ä–∏–º—ñ—Ç–∫–∏

- –î—É–±–ª—é–≤–∞–Ω–Ω—è –ª–æ–≥—É–≤–∞–Ω–Ω—è –º–æ–∂–µ –±—É—Ç–∏ –ø—Ä–∏—á–∏–Ω–æ—é —Ç–æ–≥–æ, —â–æ –∑–∞–ø–∏—Ç–∏ –≤–∏–∫–æ–Ω—É—é—Ç—å—Å—è –¥–≤—ñ—á—ñ
- –ú–∞—Å–æ–≤—ñ 500 –ø–æ–º–∏–ª–∫–∏ –º–æ–∂—É—Ç—å –±—É—Ç–∏ –≤—ñ–¥ Mistral API –∞–±–æ –≤—ñ–¥ –ø–µ—Ä–µ–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è
- GET /v1/models –∑–∞–ø–∏—Ç–∏ –º–æ–∂—É—Ç—å —Å–ø—Ä–æ–≤–æ–∫—É–≤–∞—Ç–∏ rate limit –≤—ñ–¥ API
- –ó–∞—Ç—Ä–∏–º–∫–∏ backoff –º–æ–∂—É—Ç—å —Å–ø—Ä–æ–≤–æ–∫—É–≤–∞—Ç–∏ timeout –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
