# ‚öôÔ∏è ATLAS Configuration System Refactoring Plan
**–î–∞—Ç–∞:** 2025-10-20  
**–°—Ç–∞—Ç—É—Å:** Draft  
**–ê–≤—Ç–æ—Ä:** Cascade AI

---

## üéØ –ú–µ—Ç–∞
–ü—Ä–∏–≤–µ—Å—Ç–∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—é `config/` —É –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω—ñ—Å—Ç—å –¥–æ –Ω–æ–≤–æ—ó –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∏ MCP + Tetyana, –ø—Ä–∏–±—Ä–∞—Ç–∏ legacy-–∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ (–æ—Å–æ–±–ª–∏–≤–æ prompt registry), —É—Å—É–Ω—É—Ç–∏ –¥—É–±–ª—é–≤–∞–Ω–Ω—è —Ç–∞ –∑—Ä–æ–±–∏—Ç–∏ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ–π–Ω—É —Å–∏—Å—Ç–µ–º—É –ø–µ—Ä–µ–¥–±–∞—á—É–≤–∞–Ω–æ—é, –ø—Ä–æ—Å—Ç–æ—é –¥–ª—è –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è —Ç–∞ —Å—É–ø—Ä–æ–≤–æ–¥—É.

---

## üîç –ü–æ—Ç–æ—á–Ω–∏–π —Å—Ç–∞–Ω (2025-10-20)

```
config/
‚îú‚îÄ‚îÄ README.md                 # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è (–∑–∞—Å—Ç–∞—Ä—ñ–ª–∞, –æ–ø–∏—Å—É—î —Å—Ç–∞—Ä—É —Å–∏—Å—Ç–µ–º—É —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó)
‚îú‚îÄ‚îÄ agents-config.js          # –û–∫—Ä–µ–º–∞ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è –∞–≥–µ–Ω—Ç—ñ–≤ (–≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –≤ global-config)
‚îú‚îÄ‚îÄ ai-models-config.sh       # Shell-—Å–∫—Ä–∏–ø—Ç –¥–ª—è –º–æ–¥–µ–ª–µ–π (legacy)
‚îú‚îÄ‚îÄ api-config.js             # Network/TTS/Voice –∫–æ–Ω—Ñ—ñ–≥, –µ–∫—Å–ø–æ—Ä—Ç—É—î utility
‚îú‚îÄ‚îÄ backups/                  # –ü–æ—Ä–æ–∂–Ω—è –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—è
‚îú‚îÄ‚îÄ config-cli.js             # CLI –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó (–∑–∞–ª–µ–∂–∏—Ç—å –≤—ñ–¥ config-manager)
‚îú‚îÄ‚îÄ config-manager.js         # –í–µ–ª–∏—á–µ–∑–Ω–∏–π –º–µ–Ω–µ–¥–∂–µ—Ä —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó (811 LOC)
‚îú‚îÄ‚îÄ config.yaml               # YAML-–∫–æ–Ω—Ñ—ñ–≥ (–Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è)
‚îú‚îÄ‚îÄ global-config.js          # –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∏–π —Ñ–∞–π–ª (829 LOC, —ñ–º–ø–æ—Ä—Ç—É—î prompt-registry)
‚îú‚îÄ‚îÄ node_modules/             # –î–ª—è config CLI (–ø–æ—Ç—Ä—ñ–±–Ω–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞/–æ—á–∏—â–µ–Ω–Ω—è)
‚îú‚îÄ‚îÄ package.json              # –ó–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ CLI
‚îú‚îÄ‚îÄ package-lock.json
‚îú‚îÄ‚îÄ recovery_bridge.py        # Legacy (–Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è)
‚îú‚îÄ‚îÄ shared-config.js          # –ê–≤—Ç–æ–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–∏–π legacy —Ñ–∞–π–ª (–ø–µ—Ä–µ–∫–ª–∏–∫–∞—î—Ç—å—Å—è –∑ Frontend)
‚îú‚îÄ‚îÄ sync-configs.js           # –°—Ü–µ–Ω–∞—Ä—ñ–π —Å–∏–Ω–∫—É (–≤–∏–∫–ª–∏–∫–∞—î config-manager)
‚îú‚îÄ‚îÄ test-config.js            # –¢–µ—Å—Ç–∏ –¥–ª—è –º–µ–Ω–µ–¥–∂–µ—Ä—É (–∑–∞–ª–µ–∂–Ω—ñ –≤—ñ–¥ prompts)
‚îî‚îÄ‚îÄ workflow-config.js        # –û–ø–∏—Å workflow stages + CONDITIONS (–≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –≥–ª–æ–±–∞–ª—å–Ω–æ)
```

### –û—Å–Ω–æ–≤–Ω—ñ –ø—Ä–æ–±–ª–µ–º–∏
* **prompt registry coupling**: `global-config.js` —ñ–º–ø–æ—Ä—Ç—É—î `../prompts/prompt-registry.js`, —è–∫–∏–π –≤–∂–µ –∞—Ä—Ö—ñ–≤–æ–≤–∞–Ω–æ. –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è –Ω–µ –ø–æ–≤–∏–Ω–Ω–∞ —Ç—è–≥–Ω—É—Ç–∏ –ø—Ä–æ–º–ø—Ç–∏.
* **–î—É–±–ª—é–≤–∞–Ω–Ω—è / legacy sync**: `config-manager.js` –≥–µ–Ω–µ—Ä—É—î —Ñ–∞–π–ª–∏ (`shared-config.js`, `orchestrator/config.js`, voice-config–∏). Orchestrator –≤–∂–µ —ñ–º–ø–æ—Ä—Ç—É—î `global-config.js` –Ω–∞–ø—Ä—è–º—É, —Ç–æ–∂ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è –∑–∞–π–≤–∞.
* **–ù–µ–≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω—ñ —Ñ–∞–π–ª–∏**: `config/config.js` (–≤–∂–µ –∞—Ä—Ö—ñ–≤–æ–≤–∞–Ω–∏–π), `shared-config.js` (legacy), `ai-models-config.sh`, `recovery_bridge.py`, –ø–æ—Ä–æ–∂–Ω—ñ `backups/`.
* **Node modules –≤ config/**: –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ñ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ —Ç—ñ–ª—å–∫–∏ –¥–ª—è sync CLI, –±–µ–∑ –Ω–µ–æ–±—Ö—ñ–¥–Ω–æ—Å—Ç—ñ –ø—ñ—Å–ª—è –ø–µ—Ä–µ—Ö–æ–¥—É –Ω–∞ —Ü–µ–Ω—Ç—Ä–∞–ª—ñ–∑–æ–≤–∞–Ω—É –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—é.
* **WORKFLOW_CONDITIONS duplication**: `workflow-config.js` –º—ñ—Å—Ç–∏—Ç—å —É–º–æ–≤–Ω—É –ª–æ–≥—ñ–∫—É, –∞–ª–µ MCP workflow –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î –≤–ª–∞—Å–Ω—ñ processors. –ë—ñ–ª—å—à—ñ—Å—Ç—å —É–º–æ–≤ legacy —ñ –Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å—Å—è.

---

## üõ†Ô∏è –ü–ª–∞–Ω –¥—ñ–π

### –§–∞–∑–∞ 1. –î–µ–∫–æ–º–ø–æ–∑–∏—Ü—ñ—è –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó
1. **–í–∏–¥–∞–ª–∏—Ç–∏ prompt-–∑–∞–ª–µ–∂–Ω—ñ—Å—Ç—å** –∑ `global-config.js` (–ø—Ä–∏–±—Ä–∞—Ç–∏ —ñ–º–ø–æ—Ä—Ç `prompt-registry`, `getStagePrompt`, etc.).
2. **–°—Ç–≤–æ—Ä–∏—Ç–∏ –º–æ–¥—É–ª—å–Ω—É —Å—Ç—Ä—É–∫—Ç—É—Ä—É**:
   * `config/global/` ‚Äì –±–∞–∑–æ–≤—ñ –∫–æ–Ω—Ñ—ñ–≥–∏ (agents, workflow, api, models, tts, voice).
   * `config/index.js` ‚Äì —Ü–µ–Ω—Ç—Ä–∞–ª—ñ–∑–æ–≤–∞–Ω–∏–π –µ–∫—Å–ø–æ—Ä—Ç (–∑–∞–º—ñ—Å—Ç—å –º–æ–Ω–æ–ª—ñ—Ç–Ω–æ–≥–æ `global-config.js`).
   * `config/types/` (–æ–ø—Ü—ñ–π–Ω–æ) ‚Äì TypeScript/JSDoc —Ç–∏–ø–∏ –¥–ª—è –≤–∞–ª—ñ–¥–∞—Ç–æ—Ä–∞.
3. **–ó–∞–ª–∏—à–∏—Ç–∏ –ª–∏—à–µ –ø–æ—Ç—Ä—ñ–±–Ω—ñ —É—Ç–∏–ª—ñ—Ç–∏** –≤ API (`getApiUrl`, `getServiceConfig`, etc.) —Ç–∞ –ø–µ—Ä–µ–∫–æ–Ω–∞—Ç–∏—Å—è, —â–æ –≤–æ–Ω–∏ –Ω–µ —ñ–º–ø–æ—Ä—Ç—É—é—Ç—å legacy-–º–æ–¥—É–ª—ñ.

### –§–∞–∑–∞ 2. –û—á–∏—â–µ–Ω–Ω—è legacy sync —Å–∏—Å—Ç–µ–º–∏
1. **–ê—Ä—Ö—ñ–≤—É–≤–∞—Ç–∏**:
   * `config/config-manager.js`
   * `config/config-cli.js`
   * `config/sync-configs.js`
   * `config/shared-config.js`
   * `config/test-config.js`
   * `config/ai-models-config.sh`
   * `config/recovery_bridge.py`
   * `config/config.yaml`
   * `config/backups/` (–ø–æ—Ä–æ–∂–Ω—è)
   * `config/node_modules/`, `package.json`, `package-lock.json`
2. **–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ**: –ø–µ—Ä–µ–∫–æ–Ω–∞—Ç–∏—Å—è, —â–æ –∂–æ–¥–µ–Ω –∞–∫—Ç–∏–≤–Ω–∏–π –∫–æ–¥ –Ω–µ –≤–∏–∫–ª–∏–∫–∞—î —Ü—ñ —Å–∫—Ä–∏–ø—Ç–∏ (grep –ø–æ `atlas-config`, `sync-configs`, `shared-config`).

### –§–∞–∑–∞ 3. –ù–æ–≤–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ–π
1. **–°—Ç–≤–æ—Ä–∏—Ç–∏ —Ñ–∞–π–ª** `config/atlas-config.js` (–∞–±–æ `config/index.js`), —è–∫–∏–π –µ–∫—Å–ø–æ—Ä—Ç—É—î:
   * `SystemConfig` (SYSTEM_INFO, USER_CONFIG)
   * `AgentsConfig`
   * `WorkflowConfig` (—Å–ø–∏—Å–æ–∫ –µ—Ç–∞–ø—ñ–≤ –±–µ–∑ legacy conditions)
   * `ModelConfig` (AI —Ç–∞ MCP models)
   * `NetworkConfig`
   * `TTSConfig`
   * `VoiceConfig`
   * Utility functions (`getAgentConfig`, `getWorkflowStage`, `getMCPStageConfig`, etc.)
2. **–ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ workflow**: –∑–∞–ª–∏—à–∏—Ç–∏ –ª–∏—à–µ –∞–∫—Ç—É–∞–ª—å–Ω—ñ MCP stages. –í–∏–¥–∞–ª–∏—Ç–∏ legacy stages (-3, -2, 9) –∞–±–æ –ø–æ–º—ñ—Ç–∏—Ç–∏ —è–∫ optional/future (—è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω—ñ).
3. **–í–∏—Ä—ñ–≤–Ω—è—Ç–∏ Agents**: —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑—É–≤–∞—Ç–∏ –∑ –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º (–∞–∫—Ç–∏–≤–Ω—ñ –∞–≥–µ–Ω—Ç–∏: Atlas, Tetyana, Grisha, System). –†–æ–∑–≥–ª—è–Ω—É—Ç–∏ –≤–∏–¥–∞–ª–µ–Ω–Ω—è `tts-optimizer` –∑ –∫–æ–Ω—Ñ—ñ–≥—ñ–≤ (—Ç–µ–ø–µ—Ä –æ–∫—Ä–µ–º–∏–π –º–æ–¥—É–ª—å).
4. **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è**: –æ–Ω–æ–≤–∏—Ç–∏ `config/README.md` –∑ –Ω–æ–≤–æ—é —Å—Ç—Ä—É–∫—Ç—É—Ä–æ—é —Ç–∞ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è–º–∏ (–Ω–µ–º–∞—î —Å–∏–Ω–∫-CLI, —Ç—ñ–ª—å–∫–∏ –≥–ª–æ–±–∞–ª—å–Ω–∏–π import).

### –§–∞–∑–∞ 4. –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –∑—ñ —Å—Ç–µ–∫–æ–º
1. **–û–Ω–æ–≤–∏—Ç–∏ —ñ–º–ø–æ—Ä—Ç–∏**: –ø–µ—Ä–µ–∫–æ–Ω–∞—Ç–∏—Å—è, —â–æ –≤—Å—ñ –∞–∫—Ç–∏–≤–Ω—ñ —Ñ–∞–π–ª–∏ (`orchestrator`, `web`, `services`) —ñ–º–ø–æ—Ä—Ç—É—é—Ç—å –Ω–æ–≤—ñ –º–æ–¥—É–ª—ñ, –∞ –Ω–µ –∞—Ä—Ö—ñ–≤–æ–≤–∞–Ω—ñ —Ñ–∞–π–ª–∏.
2. **–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ TTS –∫–æ–Ω—Ñ—ñ–≥**: —É–∑–≥–æ–¥–∏—Ç–∏ –∑ –≤—ñ–¥–∫—Ä–∏—Ç–∏–º–∏ TTS issues (–¥–∏–≤. –ø–∞–º—è—Ç—å `ttsync`).
3. **–°—Ç–≤–æ—Ä–∏—Ç–∏ –Ω–æ–≤–∏–π —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥-–∫–æ–Ω—Ñ—ñ–≥** (—è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `web/static/js/config/atlas-config.js` –∑ read-only –¥–∞–Ω–∏–º–∏, –∞–ª–µ –±–µ–∑ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ—ó –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó ‚Äì –∑–±–∏—Ä–∞—î—Ç—å—Å—è –Ω–∞–ø—Ä—è–º—É –∑ JS (—ñ–º–ø–æ—Ä—Ç ESM).

### –§–∞–∑–∞ 5. –í–∞–ª—ñ–¥–∞—Ü—ñ—è
1. –ó–∞–ø—É—Å—Ç–∏—Ç–∏ `npm test` (—è–∫—â–æ —î —Ç–µ—Å—Ç–∏) –∞–±–æ –¥–æ–¥–∞—Ç–∏ –º—ñ–Ω—ñ–º–∞–ª—å–Ω—ñ `config` —Ç–µ—Å—Ç–∏.
2. –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –∑–∞–ø—É—Å–∫ `restart_system.sh restart` ‚Äî –ø–µ—Ä–µ–∫–æ–Ω–∞—Ç–∏—Å—è, —â–æ –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä —Å—Ç–∞—Ä—Ç—É—î –±–µ–∑ –ø–æ–º–∏–ª–æ–∫.
3. –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ (`web/static/js/shared-config.js` —ñ–º–ø–æ—Ä—Ç –Ω–æ–≤–æ—ó –º–æ–¥–µ–ª—ñ).

---

## ‚úÖ –û—á—ñ–∫—É–≤–∞–Ω—ñ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏
* **–ñ–æ–¥–Ω–∏—Ö prompt-–∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π** —É –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó.
* **–ñ–æ–¥–Ω–∏—Ö –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä—ñ–≤ —Ñ–∞–π–ª—ñ–≤** ‚Äì –ø—Ä–æ–µ–∫—Ç–∏ —ñ–º–ø–æ—Ä—Ç—É—é—Ç—å –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó –Ω–∞–ø—Ä—è–º—É.
* **–ú–µ–Ω—à–µ —Ñ–∞–π–ª—ñ–≤** —É `config/` (–∑ ~15 –¥–æ ~6 –∞–∫—Ç–∏–≤–Ω–∏—Ö).
* **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è** –≤—ñ–¥–æ–±—Ä–∞–∂–∞—î –Ω–æ–≤—É –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä—É (–±–µ–∑ CLI).
* **–ö–æ–¥** —É `orchestrator/` –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î –Ω–æ–≤—ñ –º–æ–¥—É–ª—ñ (–ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ `global-config.js` –ø–µ—Ä–µ–≤—ñ—Ä–µ–Ω—ñ).

---

## üìé –î–æ–¥–∞—Ç–∫–æ–≤—ñ —Ä–µ—Å—É—Ä—Å–∏
* `docs/REFACTORING_PLAN_2025-10-20.md` ‚Äì –∑–∞–≥–∞–ª—å–Ω–∏–π –ø–ª–∞–Ω
* `docs/ORCHESTRATOR_STRUCTURE.md` ‚Äì —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ orchestrator (–¥–ª—è –ø–µ—Ä–µ—Ö—Ä–µ—Å–Ω–∏—Ö –ø–æ—Å–∏–ª–∞–Ω—å)
* `docs/REFACTORING_SUMMARY.md` ‚Äì –ø—ñ–¥—Å—É–º–æ–∫ –≤–∏–∫–æ–Ω–∞–Ω–∏—Ö –∑–º—ñ–Ω (–æ–Ω–æ–≤–∏—Ç–∏ –ø—ñ—Å–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è)

---

**–ù–∞—Å—Ç—É–ø–Ω—ñ –∫—Ä–æ–∫–∏:**
1. –ü—ñ–¥–≥–æ—Ç—É–≤–∞—Ç–∏ —Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª—ñ–≤ –¥–ª—è –∞—Ä—Ö—ñ–≤–∞—Ü—ñ—ó (TODO #6).
2. –í–Ω–µ—Å—Ç–∏ –∑–º—ñ–Ω–∏ —É –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ–π–Ω—ñ –º–æ–¥—É–ª—ñ (TODO #9, TODO #10).
3. –û–Ω–æ–≤–∏—Ç–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—é (TODO #8, #11).
4. –ü—Ä–æ–≤–µ—Å—Ç–∏ –≤–∞–ª—ñ–¥–∞—Ü—ñ—é —Ç–∞ –æ–Ω–æ–≤–∏—Ç–∏ `REFACTORING_SUMMARY.md`.
