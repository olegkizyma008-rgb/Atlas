#!/bin/bash

# üßπ –°–∫—Ä–∏–ø—Ç –æ—á–∏—â–µ–Ω–Ω—è codemap-system –≤—ñ–¥ –¥—É–±–ª—é–≤–∞–Ω–Ω—è
# –î–∞—Ç–∞: 22 –ª–∏—Å—Ç–æ–ø–∞–¥–∞ 2025
# –°—Ç–∞—Ç—É—Å: –ì–æ—Ç–æ–≤–æ –¥–æ –∑–∞–ø—É—Å–∫—É

set -e

CODEMAP_DIR="/Users/dev/Documents/GitHub/atlas4/codemap-system"

echo "üßπ –û—á–∏—â–µ–Ω–Ω—è codemap-system –≤—ñ–¥ –¥—É–±–ª—é–≤–∞–Ω–Ω—è..."
echo "=================================================="
echo ""

# –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞, —á–∏ —ñ—Å–Ω—É—î –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—è
if [ ! -d "$CODEMAP_DIR" ]; then
    echo "‚ùå –î–∏—Ä–µ–∫—Ç–æ—Ä—ñ—è $CODEMAP_DIR –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–∞"
    exit 1
fi

cd "$CODEMAP_DIR"

# ============================================
# 1. –í–ò–î–ê–õ–ò–¢–ò –î–£–ë–õ–Æ–í–ê–ù–ù–Ø MCP –°–ï–†–í–ï–†–ò
# ============================================
echo "1Ô∏è‚É£  –í–∏–¥–∞–ª–µ–Ω–Ω—è –¥—É–±–ª—é–≤–∞–Ω–Ω—è MCP —Å–µ—Ä–≤–µ—Ä–∏..."

if [ -f "mcp_server.py" ]; then
    echo "   ‚ùå –í–∏–¥–∞–ª–µ–Ω–Ω—è: mcp_server.py (–±–∞–∑–æ–≤–∏–π MCP)"
    rm -f mcp_server.py
fi

if [ -f "mcp_enhanced_server.py" ]; then
    echo "   ‚ùå –í–∏–¥–∞–ª–µ–Ω–Ω—è: mcp_enhanced_server.py (—Ä–æ–∑—à–∏—Ä–µ–Ω–∏–π MCP)"
    rm -f mcp_enhanced_server.py
fi

echo "   ‚úÖ –ó–∞–ª–∏—à–µ–Ω–æ: mcp_architecture_server.py (–ø–æ—Ä—Ç–∞—Ç–∏–≤–Ω–∏–π MCP)"
echo ""

# ============================================
# 2. –í–ò–î–ê–õ–ò–¢–ò –î–£–ë–õ–Æ–í–ê–ù–ù–Ø –ê–ù–ê–õ–Ü–ó–ê–¢–û–†–ò
# ============================================
echo "2Ô∏è‚É£  –í–∏–¥–∞–ª–µ–Ω–Ω—è –¥—É–±–ª—é–≤–∞–Ω–Ω—è –∞–Ω–∞–ª—ñ–∑–∞—Ç–æ—Ä–∏..."

if [ -f "mcp_enhanced_analyzer.py" ]; then
    echo "   ‚ùå –í–∏–¥–∞–ª–µ–Ω–Ω—è: mcp_enhanced_analyzer.py"
    rm -f mcp_enhanced_analyzer.py
fi

echo "   ‚úÖ –ó–∞–ª–∏—à–µ–Ω–æ: architecture_mapper.py (–æ—Å–Ω–æ–≤–Ω–∏–π –∞–Ω–∞–ª—ñ–∑–∞—Ç–æ—Ä)"
echo ""

# ============================================
# 3. –í–ò–î–ê–õ–ò–¢–ò –ü–ê–ü–ö–£ analyzers (—è–∫—â–æ –Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è)
# ============================================
echo "3Ô∏è‚É£  –í–∏–¥–∞–ª–µ–Ω–Ω—è –ø–∞–ø–∫–∏ analyzers..."

if [ -d "analyzers" ]; then
    echo "   ‚ùå –í–∏–¥–∞–ª–µ–Ω–Ω—è: analyzers/ (–¥—É–±–ª—é–≤–∞–Ω–Ω—è)"
    rm -rf analyzers/
fi

echo ""

# ============================================
# 4. –í–ò–î–ê–õ–ò–¢–ò –°–¢–ê–†–Ü –î–û–ö–£–ú–ï–ù–¢–ò
# ============================================
echo "4Ô∏è‚É£  –í–∏–¥–∞–ª–µ–Ω–Ω—è —Å—Ç–∞—Ä–æ—ó –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—ó..."

if [ -f "README.md" ]; then
    echo "   ‚ùå –í–∏–¥–∞–ª–µ–Ω–Ω—è: README.md (—Å—Ç–∞—Ä–∏–π)"
    rm -f README.md
fi

if [ -f "MCP_README.md" ]; then
    echo "   ‚ùå –í–∏–¥–∞–ª–µ–Ω–Ω—è: MCP_README.md (—Å—Ç–∞—Ä–∏–π)"
    rm -f MCP_README.md
fi

if [ -f "MCP_READY.md" ]; then
    echo "   ‚ùå –í–∏–¥–∞–ª–µ–Ω–Ω—è: MCP_READY.md (—Å—Ç–∞—Ä–∏–π)"
    rm -f MCP_READY.md
fi

if [ -f "MCP_SETUP_GUIDE.md" ]; then
    echo "   ‚ùå –í–∏–¥–∞–ª–µ–Ω–Ω—è: MCP_SETUP_GUIDE.md (—Å—Ç–∞—Ä–∏–π)"
    rm -f MCP_SETUP_GUIDE.md
fi

echo ""

# ============================================
# 5. –í–ò–î–ê–õ–ò–¢–ò –¢–ï–°–¢–û–í–Ü –§–ê–ô–õ–ò
# ============================================
echo "5Ô∏è‚É£  –í–∏–¥–∞–ª–µ–Ω–Ω—è —Ç–µ—Å—Ç–æ–≤–∏—Ö —Ñ–∞–π–ª—ñ–≤..."

if [ -f "test_mcp_server.sh" ]; then
    echo "   ‚ùå –í–∏–¥–∞–ª–µ–Ω–Ω—è: test_mcp_server.sh"
    rm -f test_mcp_server.sh
fi

if [ -f ".pre-commit-config.yaml" ]; then
    echo "   ‚ùå –í–∏–¥–∞–ª–µ–Ω–Ω—è: .pre-commit-config.yaml"
    rm -f .pre-commit-config.yaml
fi

if [ -f "analyze.py" ]; then
    echo "   ‚ùå –í–∏–¥–∞–ª–µ–Ω–Ω—è: analyze.py (–Ω–µ–∑–∞–≤–µ—Ä—à–µ–Ω–∏–π)"
    rm -f analyze.py
fi

echo ""

# ============================================
# 6. –í–ò–î–ê–õ–ò–¢–ò –ü–û–†–û–ñ–ù–Ü –ü–ê–ü–ö–ò
# ============================================
echo "6Ô∏è‚É£  –í–∏–¥–∞–ª–µ–Ω–Ω—è –ø–æ—Ä–æ–∂–Ω—ñ—Ö –ø–∞–ø–æ–∫..."

if [ -d "core" ] && [ -z "$(ls -A core 2>/dev/null)" ]; then
    echo "   ‚ùå –í–∏–¥–∞–ª–µ–Ω–Ω—è: core/ (–ø—É—Å—Ç–∞)"
    rm -rf core/
fi

if [ -d "tools" ] && [ -z "$(ls -A tools 2>/dev/null)" ]; then
    echo "   ‚ùå –í–∏–¥–∞–ª–µ–Ω–Ω—è: tools/ (–ø—É—Å—Ç–∞)"
    rm -rf tools/
fi

if [ -d "codemap-system" ] && [ -z "$(ls -A codemap-system 2>/dev/null)" ]; then
    echo "   ‚ùå –í–∏–¥–∞–ª–µ–Ω–Ω—è: codemap-system/ (–ø—É—Å—Ç–∞, –¥—É–±–ª—é–≤–∞–Ω–Ω—è)"
    rm -rf codemap-system/
fi

if [ -d "js_parser" ]; then
    echo "   ‚ùå –í–∏–¥–∞–ª–µ–Ω–Ω—è: js_parser/ (–Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è)"
    rm -rf js_parser/
fi

echo ""

# ============================================
# 7. –í–ò–î–ê–õ–ò–¢–ò –°–ò–°–¢–ï–ú–ù–Ü –§–ê–ô–õ–ò
# ============================================
echo "7Ô∏è‚É£  –í–∏–¥–∞–ª–µ–Ω–Ω—è —Å–∏—Å—Ç–µ–º–Ω–∏—Ö —Ñ–∞–π–ª—ñ–≤..."

if [ -f ".analyzer.pid" ]; then
    echo "   ‚ùå –í–∏–¥–∞–ª–µ–Ω–Ω—è: .analyzer.pid"
    rm -f .analyzer.pid
fi

if [ -f ".server.pid" ]; then
    echo "   ‚ùå –í–∏–¥–∞–ª–µ–Ω–Ω—è: .server.pid"
    rm -f .server.pid
fi

if [ -f ".codemap_version" ]; then
    echo "   ‚ùå –í–∏–¥–∞–ª–µ–Ω–Ω—è: .codemap_version"
    rm -f .codemap_version
fi

echo ""

# ============================================
# 8. –í–ò–î–ê–õ–ò–¢–ò –ü–ê–ü–ö–£ scripts (—è–∫—â–æ –Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è)
# ============================================
echo "8Ô∏è‚É£  –í–∏–¥–∞–ª–µ–Ω–Ω—è –ø–∞–ø–∫–∏ scripts..."

if [ -d "scripts" ]; then
    echo "   ‚ö†Ô∏è  –ü–∞–ø–∫–∞ scripts –∑–Ω–∞–π–¥–µ–Ω–∞"
    echo "   –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —á–∏ –≤–æ–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –ø–µ—Ä–µ–¥ –≤–∏–¥–∞–ª–µ–Ω–Ω—è–º"
    # –†–æ–∑–∫–æ–º–º–µ–Ω—Ç—É–π—Ç–µ, —è–∫—â–æ –≤–ø–µ–≤–Ω–µ–Ω—ñ:
    # rm -rf scripts/
fi

echo ""

# ============================================
# –†–ï–ó–£–õ–¨–¢–ê–¢
# ============================================
echo "=================================================="
echo "‚úÖ –û—á–∏—â–µ–Ω–Ω—è –∑–∞–≤–µ—Ä—à–µ–Ω–æ!"
echo ""
echo "üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—ñ—Å–ª—è –æ—á–∏—â–µ–Ω–Ω—è:"
ls -la | grep -E "^d|^-" | awk '{print "   " $NF}'
echo ""
echo "üìÅ –ü–∞–ø–∫–∏:"
ls -d */ 2>/dev/null | awk '{print "   " $0}' || echo "   (–Ω–µ–º–∞—î –ø–∞–ø–æ–∫)"
echo ""
echo "üéâ –°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –¥–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è!"
echo ""
